(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{299:function(e,t,a){},420:function(e,t,a){e.exports=a(609)},609:function(e,t,a){"use strict";a.r(t);var n=a(11),r=a(0),i=a.n(r),c=a(94),l=a.n(c),o=(a(299),a(24)),s=a(35),m=a(41),u=a.n(m),d=a(62),f=a(5),p=a(9),E=a(655),g=a(84),b=a(392),h=a(656),O=a(135),v=a(286),y=a(409),S=a(657),C=a(20);function j(){var e=Object(C.a)(["\n  query fetchStation($id: String!){\n    getStation(id: $id) {\n      costumers {\n        contract\n        aircrafts {\n          id\n          registration\n        }\n        name\n        id\n      }\n      shifts {\n        id\n        name\n        startTime\n      }\n      location\n      id\n      address {\n        country\n        postcode\n        city\n        street\n      }\n      phone\n      email\n      staffList{\n        id\n        name\n        lastActive{\n          activeAt\n        }\n      }\n      procedures{\n        title\n        description\n      }\n      mailingList\n\n    }\n  }\n\n"]);return j=function(){return e},e}function w(){var e=Object(C.a)(["\n query ($detailed: Boolean = false ){\n  allStations (detailed: $detailed){\n    id\n    location\n    shifts @skip(if: $detailed){\n      name\n      startTime\n    }\n    address @include(if: $detailed){\n      country\n      postcode\n      city\n      street\n    }\n    phone @include(if: $detailed)\n    email @include(if: $detailed)\n    activeStaffs @include(if: $detailed)\n    \n  }\n}"]);return w=function(){return e},e}var k=Object(p.gql)(w()),T=Object(p.gql)(j());function I(){var e=Object(C.a)(["mutation  assignCostumers( $stationId: String! $costumers:[String!]!){\n    assignCostumers(\n      stationId: $stationId,\n      costumers: $costumers\n    ){\n      id\n      costumers {\n        id\n        name\n        contract\n        aircrafts{\n        id\n      }\n    }\n    }\n  }\n\n \n"]);return I=function(){return e},e}function A(){var e=Object(C.a)(["mutation deleteStation ( $stationId: String!){\n    deleteStation( stationId: $stationId){\n      status\n      message\n    }\n\n  }\n\n  "]);return A=function(){return e},e}function D(){var e=Object(C.a)(["mutation changeStationKey(\n    $stationKey:String!\n    $stationId: String!\n  ){\n    changeStationKey(\n      stationKey: $stationKey\n      stationId: $stationId\n    ){\n     status\n      message\n    }\n  }\n\n  "]);return D=function(){return e},e}function R(){var e=Object(C.a)([" mutation removeShift( $id:String! ,$stationId: String!){\n    removeShift(\n      id:$id\n      stationId: $stationId\n    ){\n      status\n      message\n    }\n  }\n  "]);return R=function(){return e},e}function F(){var e=Object(C.a)(["mutation addShifts($shifts:[ShiftInfoInput!]!, $stationId: String!){\n    addShifts(\n      shifts:$shifts\n      stationId: $stationId\n    ) {\n      id\n      name\n      startTime\n    }\n  }"]);return F=function(){return e},e}function $(){var e=Object(C.a)(["mutation removeFromMailingList($email:String! , $stationId: String!){\n    removeFromMailingList(\n      email: $email\n      stationId: $stationId\n    ){\n      status\n      message\n    }\n  }"]);return $=function(){return e},e}function N(){var e=Object(C.a)([" mutation addToMailingList($emails:[String!]! , $stationId: String!){\n    addToMailingList(\n      email: $emails\n      stationId: $stationId\n    ){\n      status\n      message\n    }\n  }\n\n  "]);return N=function(){return e},e}function P(){var e=Object(C.a)(["\n  mutation addStation ($location:String! , $address: AddressInput! , $phone: String! ,$email: String!, $shifts: [ShiftInfoInput!]!, $costumers: [String], $stationKey:String! ){\n    addStation(\n      location:$location\n      address:$address\n      phone:$phone\n      email:$email\n      shifts:$shifts\n      costumers:$costumers\n      stationKey: $stationKey\n    ){\n      id\n    }\n  }"]);return P=function(){return e},e}function x(){var e=Object(C.a)(["\n  mutation stationLogin($id: String!, $password:String!){\n    loginToStation(id: $id, password: $password) \n  }\n"]);return x=function(){return e},e}var M=Object(p.gql)(x()),H=Object(p.gql)(P()),L=Object(p.gql)(N()),q=Object(p.gql)($()),_=Object(p.gql)(F()),B=Object(p.gql)(R()),K=Object(p.gql)(D()),z=Object(p.gql)(A()),U=Object(p.gql)(I()),V=a(21),Y=a(654),J=function(e){var t=e.dispatch,a=e.notification;return Object(r.useEffect)((function(){var e=setTimeout((function(){t({type:"REMOVE_NOTIFICATION",payload:{id:a.id}})}),5e3);return function(){clearTimeout(e)}}),[]),i.a.createElement(Y.a,{success:"SUCCESS"===a.type,error:"ERROR"===a.type,attached:!0,onDismiss:function(){return t({type:"REMOVE_NOTIFICATION",payload:{id:a.id}})}},a.content)},Q=function(){var e=Object(r.useContext)(G),t=Object(f.a)(e,2),a=t[0],n=t[1];return i.a.createElement(v.a,{basic:!0,style:{width:"inherit",position:"fixed",zIndex:1e3,padding:0}},a.map((function(e){return i.a.createElement(J,{key:e.id,notification:e,dispatch:n})})))},G=Object(r.createContext)(),W=[],Z=function(e,t){switch(t.type){case"ADD_NOTIFICATION":return[].concat(Object(V.a)(e),[{id:e.length+1,content:t.payload.content,type:t.payload.type}]);case"REMOVE_NOTIFICATION":return e.filter((function(e){return e.id!==t.payload.id}));default:return e}},X=function(e){var t=Object(r.useReducer)(Z,W);return i.a.createElement(G.Provider,{value:t},i.a.createElement(Q,null),e.children)},ee=function(){var e=Object(r.useContext)(G),t=Object(f.a)(e,2)[1],a=Object(s.g)(),n=Object(r.useState)({}),c=Object(f.a)(n,2),l=c[0],o=c[1],m=Object(r.useState)(""),C=Object(f.a)(m,2),j=C[0],w=C[1],T=Object(r.useState)(!1),I=Object(f.a)(T,2),A=I[0],D=I[1],R=Object(p.useQuery)(k,{notifyOnNetworkStatusChange:!0}),F=R.loading,$=R.data,N=Object(p.useMutation)(M,{onError:function(e){t({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, Cannot Login",i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}}),P=Object(f.a)(N,2),x=P[0],H=P[1];Object(r.useEffect)((function(){if(H.data){var e=H.data.loginToStation;w(e),sessionStorage.setItem("stationKey",JSON.stringify(e)),A&&localStorage.setItem("stationKey",JSON.stringify(e)),a.push("/shiftReport/station/".concat(l.value))}}),[H.data]);var L=function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),x({variables:{id:l.value,password:j}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=JSON.parse(sessionStorage.getItem("stationKey"));if(!q){var _=localStorage.getItem("stationKey");q=JSON.parse(_),sessionStorage.setItem("stationKey",JSON.stringify(_))}q&&a.push("/shiftReport/station/".concat(q.id));var B=function(){D(!A)};return i.a.createElement(b.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle"},i.a.createElement(b.a.Column,{style:{maxWidth:450}},i.a.createElement(h.a,{as:"h2",color:"blue",textAlign:"center"},i.a.createElement(O.a,{src:"/LogoMin.png"})," Please select a station"),i.a.createElement(E.a,{size:"large",style:{textAlign:"left"},onSubmit:L},i.a.createElement(v.a,{clearing:!0,stacked:!0},F&&i.a.createElement(v.a,{loading:!0,basic:!0}),!F&&$.allStations&&$.allStations.map((function(e){return i.a.createElement(E.a.Field,{style:{float:"left",clear:"none",marginRight:"10px"},key:e.id},i.a.createElement(y.a,{label:e.location,value:e.id,checked:l.value===e.id,onChange:function(e,t){return function(e,t){var a=t.value,n=t.label;o({value:a,label:n})}(0,t)}}))})),i.a.createElement("div",{style:{clear:"both"}}),l.value&&function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement(E.a.Input,{name:"stationKey",value:j,onChange:function(e){var t=e.target;return w(t.value)},label:"Enter password for ".concat(e.label),fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password",type:"password"}),i.a.createElement(E.a.Checkbox,{name:"rememberKey",label:"Remember on this computer",checked:A,onClick:B}),i.a.createElement(g.a,{fluid:!0,size:"large",color:"blue"},"Retrieve Shift Report"))}(l))),i.a.createElement(S.a,{horizontal:!0},"Or"),i.a.createElement(v.a,{clearing:!0,stacked:!0},i.a.createElement(g.a,{content:"Log in to personal page",icon:"user",size:"large",color:"teal",fluid:!0,onClick:function(){return a.push("/staffLogin")}}))))};function te(){var e=Object(C.a)(["\n  query fetchReportbyShift($station: String!, $shift: String!, $date: Date!){\n    getShiftReportByShift(station: $station, shift: $shift, date: $date) {\n      startTime,\n      endTime,\n      id,\n      shift,\n      station{\n        location\n      }\n    }\n  }\n"]);return te=function(){return e},e}function ae(){var e=Object(C.a)([" \n  query fetchReportList ( $stations: [String!]!, $filterBy: String!, $year:Int! , $number:Int!  ){\n    getReportList (stations: $stations, filterBy: $filterBy, year: $year , number:$number){\n      startTime,\n      endTime,\n      id,\n      shift\n      station{\n        location\n      }\n    }\n  }\n\n\n"]);return ae=function(){return e},e}function ne(){var e=Object(C.a)(["\nquery fetchReport($id:String, $station: String, $flag: String){\n    getShiftReport(id: $id, station: $station, flag: $flag) {\n      endTime\n      id\n      shift\n      staffAndTime {\n        id\n        staff {\n          name\n        }\n        endTime\n        startTime\n      }\n      startTime\n      station {\n        location\n        id\n      }\n      tasks {\n        id\n        aircraft {\n          registration\n          id\n          costumer {\n            name\n          }\n        }\n        taskCategory\n        description\n        status\n        updates {\n          action\n          handoverId {\n            startTime\n            id\n            shift\n            station{\n              location\n            }\n          }\n          note\n        }\n        \n      }\n    } \n}\n\n"]);return ne=function(){return e},e}var re=Object(p.gql)(ne()),ie=Object(p.gql)(ae()),ce=Object(p.gql)(te()),le=a(663),oe=a(658),se=a(393),me=function(e){var t=e.activeItem,a=e.setActiveItem,n=Object(s.g)(),c=Object(r.useState)(!1),l=Object(f.a)(c,2),o=l[0],m=l[1],u=Object(r.useState)(""),d=Object(f.a)(u,2),p=d[0],E=d[1],b=function(){return i.a.createElement(oe.a,{open:o,cancelButton:"I understand that all reporting will be lost, Continue",confirmButton:"Cancel and Continue Reporting",header:"Are You sure?",content:"You are navigationg away from from the reporting page, doing so will result in losing all the inputs on the report page. Do you want to continue?",onCancel:function(){a(p),m(!1)},onConfirm:function(){m(!1)}})},h=function(e,n){var r=n.name;if("startNewReport"===t)return E(r),void m(!0);a(r)};return i.a.createElement(i.a.Fragment,null,i.a.createElement(se.a,{inverted:!0,color:"blue",stackable:!0},i.a.createElement(se.a.Item,{header:!0},"  Shift Reporting System "),i.a.createElement(se.a.Item,{name:"lastShiftReport",active:"lastShiftReport"===t,onClick:h}),i.a.createElement(se.a.Item,{name:"browseAllReports",active:"browseAllReports"===t,onClick:h}),i.a.createElement(se.a.Item,{name:"startNewReport",active:"startNewReport"===t,onClick:h}),i.a.createElement(se.a.Item,{name:"stationInfo",active:"stationInfo"===t,onClick:h}),i.a.createElement(se.a.Menu,{position:"right"},i.a.createElement(g.a,{primary:!0,name:"Switch Station ",active:"logout"===t,onClick:function(){localStorage.removeItem("stationKey"),sessionStorage.removeItem("stationKey"),n.push("/")}},"Switch Station"))),i.a.createElement(b,null))},ue=a(210),de=a(117),fe=a(43),pe=a(13),Ee=a.n(pe),ge=a(249),be=function(e){var t=e.task;return i.a.createElement(ge.a,{open:e.open,onClose:function(){return e.setOpen(!1)}},i.a.createElement(ge.a.Header,null," Task Details "),i.a.createElement(ge.a.Content,null,"AIRCRAFT"===t.taskCategory&&i.a.createElement(v.a.Group,{horizontal:!0},i.a.createElement(v.a,{basic:!0,attached:"top",as:h.a},"Aircraft",i.a.createElement(h.a.Subheader,null,t.aircraft.registration)),i.a.createElement(v.a,{basic:!0,attached:"bottom",as:h.a},"Costumer",i.a.createElement(h.a.Subheader,null,t.aircraft.costumer.name))),i.a.createElement(v.a,null,i.a.createElement(h.a,{as:"h3"},"Status"),i.a.createElement("p",null,t.status)),i.a.createElement(v.a,null,i.a.createElement(h.a,{as:"h3"},"Description"),i.a.createElement("p",null,t.description)),i.a.createElement(v.a,null,i.a.createElement(h.a,{as:"h3"},"Action History"),i.a.createElement(v.a.Group,null,t.updates.map((function(a,n){return i.a.createElement(v.a,{clearing:!0,key:n,color:a.handoverId.id===e.viewingOnHanodover||!e.viewingOnHanodover&&t.updates.length-1===n?"green":"grey"},i.a.createElement(h.a,{as:"h5"},a.action,i.a.createElement(h.a.Subheader,null,a.handoverId.station.location," ",a.handoverId.shift," shift ",a.handoverId.startTime.split(" ")[0])),a.handoverId.id===e.viewingOnHanodover&&i.a.createElement(de.a,{color:"green",attached:"top right"}," Currently Viewing this Report"),!e.viewingOnHanodover&&t.updates.length-1===n&&i.a.createElement(de.a,{color:"green",attached:"top right"}," Last Action Performed"),a.note)}))))))},he=function(e){var t=e.task,a=e.handoverId,n=Object(r.useState)(!1),c=Object(f.a)(n,2),l=c[0],o=c[1],s=Ee.a.find(t.updates,["handoverId",{id:a}]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(v.a,null,!s.action.includes("TASK_CREATED")&&i.a.createElement(de.a,{size:"mini",basic:!0},"Tasks from previous shifts"),("DEFERRED"===s.action||"TASK_CREATED_DEFERRED"===s.action)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(de.a,{size:"mini",color:"red",basic:!0}," Deferred "),i.a.createElement(de.a,{color:"red",size:"mini",basic:!0}," Action Required ")),"CLOSED"===s.action&&i.a.createElement(de.a,{color:"green",size:"mini",basic:!0}," Completed "),"OPEN"===t.status&&s&&i.a.createElement(i.a.Fragment,null,!s.action.includes("TASK_CREATED")&&i.a.createElement(de.a,{size:"mini",basic:!0}," ",s.action," "),i.a.createElement(de.a,{color:"purple",size:"mini",basic:!0}," Open ")),!s.action.includes("TASK_CREATED")&&t.updates.length>1&&i.a.createElement(de.a,{as:"a",size:"mini",onClick:function(){o(!0)}}," ",i.a.createElement(fe.a,{name:"history"})," Action History   "),i.a.createElement(v.a,{style:{paddingTop:0,paddingLeft:0},basic:!0,compact:!0},t.description,"   ")),l&&i.a.createElement(be,{open:l,setOpen:o,task:t,viewingOnHanodover:a}," "))},Oe=function(e){var t=e.genericTasks,a=e.handoverId;return 0===t.legth?null:i.a.createElement(i.a.Fragment,null,i.a.createElement(v.a,{stacked:!0},i.a.createElement(h.a,{color:"blue",as:"h4",block:!0}," ",t[0].taskCategory," "),i.a.createElement(ue.a,null,Ee.a.map(t,(function(e){return i.a.createElement(he,{key:e.id,task:e,handoverId:a})})))))},ve=function(e){var t=e.aircraftTasks,a=e.handoverId;return 0===t.legth?null:i.a.createElement(v.a,{stacked:!0},Ee.a.map(t,(function(e,t){return i.a.createElement(ue.a,{key:t},i.a.createElement(h.a,{color:"blue",as:"h4",block:!0}," ",i.a.createElement(fe.a,{name:"plane"})," Work Performed for ",t),Ee.a.map(e,(function(e,t){return i.a.createElement(ue.a,{key:t},i.a.createElement(v.a,null,t),Ee.a.map(e,(function(e){return i.a.createElement(he,{key:e.id,task:e,handoverId:a})})))})))})))},ye=a(659),Se=function(e){var t=e.timesheets;return i.a.createElement(v.a,null,i.a.createElement(ye.a,{celled:!0},i.a.createElement(ye.a.Header,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.HeaderCell,null,"Staff"),i.a.createElement(ye.a.HeaderCell,null,"Start Time"),i.a.createElement(ye.a.HeaderCell,null,"End TIme"))),i.a.createElement(ye.a.Body,null,t.map((function(e){return i.a.createElement(ye.a.Row,{key:e.id},i.a.createElement(ye.a.Cell,null,e.staff.name),i.a.createElement(ye.a.Cell,null,e.startTime.substring(10)),i.a.createElement(ye.a.Cell,null,e.endTime.substring(10)))})))))},Ce=function(e){var t=e.reportData;if(!t)return i.a.createElement(v.a,null,"No reports found");var a=Ee.a.groupBy(t.tasks,(function(e){return e.taskCategory})),n=Ee.a.mapValues(a,(function(e,t){return"AIRCRAFT"===t?Ee.a.chain(a.AIRCRAFT).groupBy((function(e){return e.aircraft.costumer.name})).mapValues((function(e){return Ee.a.groupBy(e,(function(e){return e.aircraft.registration}))})).value():e}));return i.a.createElement(ue.a,null,i.a.createElement(v.a,{basic:!0,clearing:!0},i.a.createElement(h.a,{floated:"left"}," Shift Report from ",t.shift," shift ",i.a.createElement("span",null,i.a.createElement("h5",null,"(",t.startTime.substring(10)," - ",t.endTime.substring(10),")"))),i.a.createElement(h.a,{floated:"right",as:"h5"},"  ",t.startTime.substring(10,0),i.a.createElement("span",null,i.a.createElement("br",null),t.station.location)," ")),i.a.createElement(Se,{timesheets:t.staffAndTime}),Ee.a.map(n,(function(e,a){return"AIRCRAFT"===a?i.a.createElement(ve,{key:a,aircraftTasks:e,handoverId:t.id}):i.a.createElement(Oe,{key:a,genericTasks:e,handoverId:t.id})})))},je=Object(r.createContext)({lastShiftReport:[],station:[]}),we=function(e,t){switch(t.type){case"ADD_LASTSHIFTREPORT":return Object(n.a)(Object(n.a)({},e),{},{lastShiftReport:t.payload});case"INIT_STATION":return Object(n.a)(Object(n.a)({},e),{},{station:t.payload});default:return e}},ke=a(56),Te=a(18),Ie=a(611),Ae=a(98),De=a(134),Re=a(614),Fe=a(294),$e=function(e){var t=e.label,a=Object(Ae.a)(e,["label"]),n=Object(Te.f)(),r=n.setFieldValue,c=n.setFieldTouched,l=Object(Te.e)(a),o=Object(f.a)(l,2),s=o[0],m=o[1];return i.a.createElement(E.a.Field,{width:"4"},t&&i.a.createElement("label",null,t),i.a.createElement(De.DateTimeInput,Object.assign({error:!(!m.touched||!m.error),popupPosition:"right center"},s,a,{dateTimeFormat:"DD-MM-YYYY HH:mm",closable:!0,onBlur:function(){c(s.name,!0)},onChange:function(e,t){var a=t.value;r(s.name,a)},preserveViewMode:!1})),m.touched&&m.error?i.a.createElement(de.a,{pointing:!0,prompt:!0},m.error):"")},Ne=function(e){var t=e.label,a=Object(Ae.a)(e,["label"]),n=Object(Te.f)(),r=n.setFieldValue,c=n.setFieldTouched,l=Object(Te.e)(a),o=Object(f.a)(l,2),s=o[0],m=o[1];return i.a.createElement(E.a.Field,{width:"4"},t&&i.a.createElement("label",null,t),i.a.createElement(De.TimeInput,Object.assign({error:!(!m.touched||!m.error),popupPosition:"right center"},s,a,{closable:!0,onBlur:function(){c(s.name,!0)},onChange:function(e,t){var a=t.value;r(s.name,a)}})),m.touched&&m.error?i.a.createElement(de.a,{pointing:!0,prompt:!0},m.error):"")},Pe=function(e){var t=e.width,a=Object(Ae.a)(e,["width"]),n=Object(Te.e)(a),r=Object(f.a)(n,2),c=r[0],l=r[1];return i.a.createElement(i.a.Fragment,null,i.a.createElement(E.a.Field,{error:!(!l.touched||!l.error),width:t},i.a.createElement("label",null,a.inputlabel?a.inputlabel:""),i.a.createElement(Re.a,Object.assign({},c,a)),"hidden"!==a.type&&l.touched&&l.error&&i.a.createElement(de.a,{pointing:!0,prompt:!0},l.error)))},xe=function(e){var t=e.label,a=e.children,n=e.checked,r=Object(Ae.a)(e,["label","children","checked"]);return i.a.createElement(v.a,{style:{display:n?"block":"inline-block"}},i.a.createElement(Fe.a,Object.assign({checked:n},r,{toggle:!0})),i.a.createElement("label",{style:{display:"inline-block",marginLeft:"5px",verticalAlign:"super"}}," ",t.toUpperCase()," "),a)},Me=function(e){e.label;var t=Object(Ae.a)(e,["label"]),a=Object(Te.e)(t),n=Object(f.a)(a,2),r=n[0],c=n[1];return i.a.createElement(E.a.TextArea,Object.assign({error:c.touched&&c.error},r,t))},He=function(e){if(!e)return null;if(isNaN(e)){switch([/^(-?(?:[1-9][0-9]*)?[0-9]{4})-(1[0-2]|0[1-9])-(3[01]|0[1-9]|[12][0-9])T(2[0-3]|[01][0-9]):([0-5][0-9]):([0-5][0-9])(\.[0-9]+)?(Z)?$/].findIndex((function(t){return!!e.match(t)}))){case 0:var t=e.split("T"),a=t[0],n=t[1],r=a.split("-"),i=n.split(".")[0].split(":");return r[2]+"-"+r[1]+"-"+r[0]+" "+i[0]+":"+i[1];default:return null}}var c=new Date(e);return"".concat(c.getDate().toString().padStart(2,0),"-").concat((c.getMonth()+1).toString().padStart(2,0),"-").concat(c.getFullYear()," ").concat(c.getHours().toString().padStart(2,0),":").concat(c.getMinutes().toString().padStart(2,0))},Le=function(e,t,a,n){if(!e)return null;var r;if(Object(pe.isNumber)(e))r=new Date(e);else{var i=e.split(" "),c=i[0].split("-"),l="".concat(c[2],"-").concat(c[1],"-").concat(c[0]," ").concat(i[1]);r=Date.parse(l)}switch(a){case"d":if("add"===n)return He(r+24*t*60*60*1e3);if("sub"===n)return He(r-24*t*60*60*1e3);break;case"h":if("add"===n)return He(r+60*t*60*1e3);if("sub"===n)return He(r-60*t*60*1e3);break;case"m":if("add"===n)return He(r+60*t*1e3);if("sub"===n)return He(r-60*t*1e3);break;default:return He(r)}},qe=function(e){var t;if(Object(pe.isNumber)(e))t=new Date(e);else{var a=e.split(" "),n=a[0].split("-"),r="".concat(n[2],"-").concat(n[1],"-").concat(n[0]," ").concat(a[1]||"00",":").concat("00"|a[2]);t=Date.parse(r)}return t},_e=function(e){var t=new Date(e.valueOf()),a=(e.getDay()+6)%7;t.setDate(t.getDate()-a+3);var n=t.valueOf();return t.setMonth(0,1),4!==t.getDay()&&t.setMonth(0,1+(4-t.getDay()+7)%7),1+Math.ceil((n-t)/6048e5)},Be=function(e,t){var a=new Date(Date.UTC(t,0,1+7*(e-1))),n=a.getDay(),r=a;return n<=4?r.setDate(a.getDate()-a.getDay()+1):r.setDate(a.getDate()+8-a.getDay()),r},Ke=function(e){return new Proxy(["January","February","March","April","May","June","July","August","September","October","November","December"],{get:function(e,t){return isNaN(t)||(t=parseInt(t,10))<0&&(t+=e.length),e[t]}})[e]},ze=function(e){e||(e=4);var t=(new Date).getMonth();return Object(V.a)(new Array(e)).map((function(e,a){return{key:a,text:Ke(t-a),value:t-a<0?12+t-a:t-a}}))},Ue=function(e){e||(e=4);for(var t=new Date,a=t.getMonth(),n=t.getFullYear(),r=_e(new Date(n-1,11,28)),i=_e(new Date(n,a-e,1)),c=[],l=_e(t);l!==i-1;){var o={key:l,text:l,value:l};c.push(o),0===(l-=1)&&(l=r)}return c},Ve=function(e,t){var a,n=new Date;if("week"===e){var r=_e(n);if(t>r&&(a=n.getFullYear()-1),t<=r)a=new Date((new Date).setDate(n.getDate()-n.getDay()+1)).getFullYear();return a}return a="month"===e&&t>n.getMonth()?n.getFullYear()-1:n.getFullYear()},Ye=function(e){var t;if(e)return e.name||(t=Object(n.a)(Object(n.a)({},t),{},{name:"Staff name is required"})),t=Object(n.a)(Object(n.a)({},t),Je(e.startTime,e.endTime))},Je=function(e,t,a){var r;return e||(r=Object(n.a)(Object(n.a)({},r),{},{startTime:"Start time is required"})),t||(r=Object(n.a)(Object(n.a)({},r),{},{endTime:"End time is required"})),e.match(/^(0[1-9]|[12][0-9]|3[01])-(0[1-9]|1[0-2])-\d\d\d\d (0[0-9]|1[0-9]|2[0-3]):([0-9]|[0-5][0-9])$/)||(r=Object(n.a)(Object(n.a)({},r),{},{startTime:"Start time should be on format DD-MM-YYYY HH:MM"})),t.match(/^(0[1-9]|[12][0-9]|3[01])-(0[1-9]|1[0-2])-\d\d\d\d (0[0-9]|1[0-9]|2[0-3]):([0-9]|[0-5][0-9])$/)||(r=Object(n.a)(Object(n.a)({},r),{},{endTime:"End time should be on format DD-MM-YYYY HH:MM"})),!a&&qe(e)+864e5<=Date.now()&&(r=Object(n.a)(Object(n.a)({},r),{},{startTime:"Start time should be within last 24 hours"})),a&&new Date(a).getDate()!==new Date(qe(e)).getDate()&&(r=Object(n.a)(Object(n.a)({},r),{},{startTime:"Start time should be on ".concat(He(new Date(a)).split(" ")[0])})),qe(e)>=qe(t)&&(r=Object(n.a)(Object(n.a)({},r),{},{startTime:"Start time cannot be later than endtime"})),qe(e)>Date.now()&&(r=Object(n.a)(Object(n.a)({},r),{},{startTime:"Start time cannot be on future"})),qe(t)>Date.now()&&(r=Object(n.a)(Object(n.a)({},r),{},{endTime:"End time cannot be on future"})),r},Qe=function(e){var t=null;return"DEFERRED"===e.status&&(e.action&&"NOTES_ADDED"!==e.action||(t=Object(n.a)(Object(n.a)({},t),{},{action:"Action was requested on this task. Please perform a action. "}))),e.status||e.action||(t=Object(n.a)(Object(n.a)({},t),{},{action:"Task must have one of the following status"})),e.description&&""!==e.description.trim()||(t=Object(n.a)(Object(n.a)({},t),{},{description:"Please add task description"})),t},Ge=function(e){return e?e.match(/^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/)?void 0:"Incorrect email format":"Email is required"},We=function(e){return e&&""!==e.trim?e.length<4?"Name must be at least 4 character long":void 0:"Full name is required"},Ze=function(e){var t=e.name,a=e.pointing;return i.a.createElement(Te.a,{name:t},(function(e){var n=e.form,r=Object(Te.d)(n.errors,t);return Object(Te.d)(n.touched,t)&&r&&"string"===typeof r?i.a.createElement(de.a,{pointing:a,style:{height:"fit-content"},color:"red",basic:!0},r):null}))};function Xe(){var e=Object(C.a)(["\n mutation requestClarification($id: String!, $clearify: String){\n  requestClarification(\n     id: $id,\n     clearify:$clearify,    \n   ){\n    id\n    remarks{\n      by\n      date\n      edit\n      text\n      title\n    }\n   }\n }\n"]);return Xe=function(){return e},e}function et(){var e=Object(C.a)(["\n mutation deleteTimeSheet($id: String!){\n   deleteTimeSheet(\n     id: $id,    \n   ){\n     status\n     message\n   }\n }\n"]);return et=function(){return e},e}function tt(){var e=Object(C.a)(["\n mutation approveTimeSheet($id: String!, $status: String!){\n   approveTimeSheet(\n     id: $id,\n     status: $status\n   ){\n     id \n     status \n     remarks{\n      by\n      date\n      edit\n      text\n      title\n    }\n   }\n }\n"]);return tt=function(){return e},e}function at(){var e=Object(C.a)(["\n mutation updateTimeSheet($id: String, $startTime: String , $endTime: String, $station: String, $shift : String, $break: Int, $staff: String, $remarks: [RemarkInput], $handover: String){\n  addToTimeSheet(\n      id: $id\n      startTime: $startTime , \n      endTime: $endTime,\n      station: $station, \n      shift: $shift,  \n      staff: $staff\n      break: $break,\n      remarks:$remarks,\n      handover:$handover,\n  )\n    {\n      id\n      startTime\n      status\n      date\n      endTime\n      break\n      remarks{\n        by\n        date\n        edit\n        text\n        title\n      }\n      staff{\n        id\n        name\n        reqHours\n      }\n      shiftReport {\n        shift\n        id\n        station {\n          id\n          location\n        }\n      }\n\n      shift\n      station{\n        id\n        location\n      }\n\n  } \n  \n\n }\n"]);return at=function(){return e},e}function nt(){var e=Object(C.a)(["\n  mutation signOff($startTime: String!, $break:Int, $endTime:String!, $username: String, $password:String, $idCardCode: String, $additionalAction: String, $id:String, $email: String, $name: String ){\n    signOffTimeSheet(\n      startTime: $startTime, \n      endTime:$endTime, \n      break: $break,\n      username: $username, \n      password: $password , \n      additionalAction: $additionalAction,\n      email: $email,\n      name: $name,\n      idCardCode: $idCardCode\n      id: $id\n      ) {\n        name,\n        value,\n        break,\n        startTime,\n        endTime,\n        id\n      }\n  }"]);return nt=function(){return e},e}var rt=Object(p.gql)(nt()),it=Object(p.gql)(at()),ct=Object(p.gql)(tt()),lt=Object(p.gql)(et()),ot=Object(p.gql)(Xe()),st=function(e){var t=e.setOpen,a=e.open,c=e.fieldName,l=e.removeClick,o=e.removeStaff,s=e.setRemoveStaff,m=Object(Te.f)(),O=m.getFieldMeta,y=m.setFieldValue,C=Object(p.useMutation)(rt),j=Object(f.a)(C,2),w=j[0],k=j[1],T=k.loading,I=k.error,A=k.data,D=O("".concat(c,".startTime")).value,R=O("".concat(c,".endTime")).value,F=O("".concat(c,".break")).value,$=Object(r.useState)(""),N=Object(f.a)($,2),P=N[0],x=N[1],M=Object(r.useState)(""),H=Object(f.a)(M,2),L=H[0],q=H[1],_=Object(r.useState)(""),B=Object(f.a)(_,2),K=B[0],z=B[1],U=Object(r.useState)(D),V=Object(f.a)(U,2),J=V[0],Q=V[1],G=Object(r.useState)(R),W=Object(f.a)(G,2),Z=W[0],X=W[1],ee=Object(r.useState)(F),te=Object(f.a)(ee,2),ae=te[0],ne=te[1];Object(r.useEffect)((function(){Q(D),X(R)}),[R,D]),Object(r.useEffect)((function(){I&&x({type:"error",message:"Sorry, ".concat(I.message)}),A&&null!=A.signOffTimeSheet&&(o?(l(),s(!1),t(!1)):(y("".concat(c,".startTime"),A.signOffTimeSheet.startTime),y("".concat(c,".endTime"),A.signOffTimeSheet.endTime),y("".concat(c,".signOffKey"),A.signOffTimeSheet.value),t(!1)))}),[I,A]);var re=function(){var e=Object(d.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={startTime:t.startTime,endTime:t.endTime,break:t.breakt,username:L,password:K,additionalAction:o?"remove":"update",id:O("".concat(c)).value.id},e.next=3,w({variables:a});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return T?i.a.createElement(Ie.a,{active:!0,inverted:!0},i.a.createElement(le.a,{active:!0,inverted:!0},"Verifying")):i.a.createElement(ge.a,{closeIcon:!0,closeOnEscape:!1,closeOnDimmerClick:!1,open:a,onClose:function(){x(!1),t(!1)},onOpen:function(){return t(!0)}},i.a.createElement(ge.a.Header,null,O("".concat(c,".name")).value," "),i.a.createElement(ge.a.Content,null,P&&(P?i.a.createElement(Y.a,{success:"success"===P.type,error:"error"===P.type,onDismiss:function(){return x("")}}," ",P.message):null),i.a.createElement(Te.c,{enableReinitialize:!0,initialValues:{startTime:J,endTime:Z,breakt:ae,username:"",password:"",email:"",fullname:"",resetEmail:""},validate:function(e){var t={};return t=Object(n.a)(Object(n.a)({},t),Je(e.startTime,e.endTime))},onSubmit:function(e){re(e)}},(function(e){var t=e.handleSubmit;return i.a.createElement(E.a,{size:"large",onSubmit:t},i.a.createElement(E.a.Group,null,i.a.createElement($e,{label:"Start Time",dateTimeFormat:"DD-MM-YYYY HH:mm",name:"startTime",maxDate:Le(Date.now(),30,"m","sub"),minDate:Le(Date.now(),20,"h","sub"),onChange:function(e,t){var a=t.value;Q(a)}}),i.a.createElement($e,{label:"End Time",dateTimeFormat:"DD-MM-YYYY HH:mm",name:"endTime",maxDate:He(Date.now()),minDate:Le(J,20,"m","add"),onChange:function(e,t){var a=t.value;X(a)}}),i.a.createElement(Pe,{inputlabel:"Break",label:"Minutes ",labelPosition:"right corner",name:"breakt",type:"number",min:"0",onChange:function(e,t){var a=t.value;ne(a)}})),i.a.createElement(h.a,{as:"h3",color:"red",textAlign:"center"},o?"Enter credentials to confirm remove.":"Enter credential to save changes"),i.a.createElement(i.a.Fragment,null,i.a.createElement(v.a,null,i.a.createElement(b.a,{columns:2,stackable:!0},i.a.createElement(S.a,{vertical:!0},"Or"),i.a.createElement(b.a.Row,{verticalAlign:"middle"},i.a.createElement(b.a.Column,null,i.a.createElement(b.a.Row,{style:{textAlign:"center"}},i.a.createElement(h.a,{as:"h5",icon:!0},i.a.createElement(fe.a,{name:"sign in alternate"}),"Use Credentials")),i.a.createElement(b.a.Row,null,i.a.createElement(E.a.Group,null,i.a.createElement(E.a.Input,{label:"Username",onChange:function(e,t){var a=t.value;return q(a)}}),i.a.createElement(E.a.Input,{label:"Password",type:"password",onChange:function(e,t){var a=t.value;return z(a)}})),i.a.createElement(E.a.Field,{style:{textAlign:"center"}},i.a.createElement(g.a,{type:"submit",primary:!0}," Sign ")))),i.a.createElement(b.a.Column,{textAlign:"center"},i.a.createElement(b.a.Row,null,i.a.createElement(h.a,{icon:!0},i.a.createElement(fe.a,{name:"barcode",size:"massive"}),"Use IdCard")),i.a.createElement(b.a.Row,null,i.a.createElement(g.a,{primary:!0},"Scan"))))))))}))))},mt=function(e){var t=e.staff,a=e.fieldName,n=e.values,c=e.index,l=e.remove,o=Object(r.useState)(!1),s=Object(f.a)(o,2),m=s[0],u=s[1],d=Object(r.useState)(!1),p=Object(f.a)(d,2),b=p[0],h=p[1];return t?i.a.createElement(v.a,null,t.signOffKey&&i.a.createElement(de.a,{attached:"top left",size:"mini",basic:!0,color:"grey"},"Signed Off "),i.a.createElement(E.a.Group,null,i.a.createElement(Pe,{width:4,readOnly:t.signOffKey,name:"".concat(a,".name")}),i.a.createElement($e,{readOnly:t.signOffKey&&!t.changing,maxDate:Le(Date.now(),30,"m","sub"),minDate:Le(Date.now(),20,"h","sub"),name:"".concat(a,".startTime")}),i.a.createElement($e,{readOnly:t.signOffKey&&!t.changing,maxDate:He(Date.now()),minDate:Le(n.startTime,20,"m","add"),name:"".concat(a,".endTime")}),i.a.createElement(Te.a,{type:"hidden",value:"",name:"".concat(a,".signOffKey")}),i.a.createElement(Te.a,{type:"hidden",value:"",name:"".concat(a,".break")}),i.a.createElement(g.a,{style:{height:"fit-content"},type:"button",circular:!0,icon:"cancel",basic:!0,onClick:function(){h(!0),u(!0)}}),i.a.createElement(i.a.Fragment,null,i.a.createElement(g.a,{style:{height:"fit-content"},type:"button",inverted:!0,color:"red",size:"small",onClick:function(){u(!0)}}," Change"))),i.a.createElement(st,{setOpen:u,open:m,startTime:n.staffs[c].startTime,endTime:n.staffs[c].endTime,breakt:n.staffs[c].break,fieldName:a,removeStaff:b,setRemoveStaff:h,removeClick:function(){return l(c)}})):null},ut=function(e){var t=e.values,a=e.addStaffOpen;return i.a.createElement(i.a.Fragment,null,i.a.createElement(Te.b,{name:"staffs"},(function(e){var n=e.remove;e.push,e.replace;return i.a.createElement(r.Fragment,null,i.a.createElement(h.a,{as:"h3"},"Staffs"),i.a.createElement(v.a.Group,null,t.staffs.length>0&&t.staffs.map((function(e,a){return i.a.createElement(mt,{key:a,index:a,staff:e,fieldName:"staffs.".concat(a),values:t,remove:n})}))),i.a.createElement(g.a,{type:"button",icon:!0,primary:!0,onClick:function(){return a(!0)}},i.a.createElement(fe.a,{name:"plus circle"})," Add "),"  ",i.a.createElement(Ze,{name:"staffs",pointing:"left"}))})))},dt=function(e){var t=e.label,a=e.onRemove,n=e.disabled,c=(e.children,e.name),l=e.task,o=Object(Te.f)(),s=o.setFieldValue,m=o.getFieldProps,u=o.setFieldTouched,d=o.getFieldMeta,p=Object(r.useState)(!1),b=Object(f.a)(p,2),h=b[0],O=b[1],v=Object(r.useState)(!1),y=Object(f.a)(v,2),C=y[0],j=y[1],w=m("".concat(c,".action")).value,k=m("".concat(c,".status")).value,T=m("".concat(c,".newNote")).value,I=function(e,t){e.preventDefault(),s("".concat(c,".action"),t),C&&!T&&A()},A=function(){if(C){var e=T.trim();j(!1),s("".concat(c,".newNote"),e)}else j(!0)},D=function(){var e=i.a.createElement(de.a,{size:"mini",basic:!0},"Task from previous shifts "),t=T&&T.trim()?i.a.createElement(de.a,{size:"mini",basic:!0,color:"blue",as:"a",onClick:function(){w&&"NOTES_ADDED"!==w&&A()}},"Notes Added "):"";return i.a.createElement("div",{style:{padding:"0.3125em 1.5em"}},e,t,n&&"DEFERRED"===k&&!w&&i.a.createElement(de.a,{size:"mini",basic:!0,color:"red"},"Action Required "),w&&i.a.createElement(i.a.Fragment,null,i.a.createElement(de.a,{size:"mini",basic:!0,color:"green"},w," "),i.a.createElement(de.a,{as:"a",size:"mini",basic:!0,color:"yellow",onClick:function(e){return s("".concat(c,".action"),""),void(T&&j(!0))}}," ",i.a.createElement(fe.a,{name:"undo"})," Undo Action")))};return i.a.createElement(i.a.Fragment,null,i.a.createElement(S.a,null),n&&i.a.createElement(D,null),i.a.createElement(E.a.Group,{style:{marginBottom:"0px"}},i.a.createElement("label",{style:{display:"inline-block",padding:"0.9375em 0px 0px 0.3125em",width:"1.5625em"}},t+1),i.a.createElement(Me,{name:"".concat(c,".description"),readOnly:n,rows:"1",width:"16"}),i.a.createElement(g.a,{type:"button",circular:!0,icon:"cancel",style:{visibility:n?"hidden":"",height:"fit-content"},basic:!0,onClick:function(e){return function(e){e.preventDefault(),a()}(e)}})),!n&&i.a.createElement("div",{style:{padding:"0.5em 1.5em"}},i.a.createElement(Ze,{name:"".concat(c,".action"),pointing:"below"}),i.a.createElement(E.a.Group,null,i.a.createElement(E.a.Checkbox,{checked:"CLOSED"===w,label:"closed",onChange:function(e,t){return function(e,t){u("".concat(c,".description"),!0),d("".concat(c,".description")).error?u("".concat(c,".description")):s("".concat(c,".action"),t?"CLOSED":"")}(0,t.checked)}}),i.a.createElement(E.a.Checkbox,{checked:"DEFERRED"===w||"OPEN"===w,label:"Is Open Task",onChange:function(e,t){return function(e,t){u("".concat(c,".description"),!0),d("".concat(c,".description")).error?u("".concat(c,".description")):s("".concat(c,".action"),t?"OPEN":"")}(0,t.checked)}}),i.a.createElement(E.a.Checkbox,{label:"Action Required",checked:"DEFERRED"===w,onChange:function(e,t){return function(e,t){u("".concat(c,".description"),!0),d("".concat(c,".description")).error?u("".concat(c,".description")):s("".concat(c,".action"),t?"DEFERRED":"OPEN")}(0,t.checked)}}))),n&&"CLOSED"!==w&&"DEFERRED"!==w&&i.a.createElement("div",{style:{margin:"0px 3.125em 0.625em 1.5em"}},i.a.createElement(de.a,{style:{backgroundColor:"transparent",color:"#2185d0"},as:"a",size:"medium",onClick:function(){O(!0)}}," View Action History   ",i.a.createElement(fe.a,{link:!0,name:"history"})," "),h&&i.a.createElement(be,{open:h,setOpen:O,task:l}," "),i.a.createElement(Ze,{name:"".concat(c,".action"),pointing:"below"}),i.a.createElement("div",null,i.a.createElement(g.a,{size:"mini",type:"button",onClick:function(e){return A(e)}}," ",C?"Hide Notes":T?"Show Notes":"Add Notes"),i.a.createElement(g.a.Group,{size:"mini"},i.a.createElement(g.a,{type:"button",size:"mini",positive:!0,value:"CLOSED",onClick:function(e,t){var a=t.value;return I(e,a)}},"Close Task"),i.a.createElement(g.a.Or,{size:"mini"}),i.a.createElement(g.a,{type:"button",size:"mini",negative:!0,value:"DEFERRED",onClick:function(e,t){var a=t.value;return I(e,a)}}," Defer Task to next Shift")))),i.a.createElement(Me,{rows:"1",readOnly:!(!w||"NOTES_ADDED"===w),hidden:!C,style:{paddingBotton:"0.3125em",margin:"0px 3.125em 0.625em 1.5em"},name:"".concat(c,".newNote"),width:"14",onChange:function(e,t){var a=t.value;""!==a.trim()?(s("".concat(c,".newNote"),a),w||s("".concat(c,".action"),"NOTES_ADDED")):(s("".concat(c,".newNote"),""),"NOTES_ADDED"===w&&s("".concat(c,".action"),""))}}))},ft=function(e){var t=e.tasksIdentifier,a=e.tasks,n=e.taskCategory,r=e.onRemove,c=e.aircraftId;return i.a.createElement(Te.b,{name:"tasks.".concat(t)},(function(e){var l=e.push,o=e.remove;return i.a.createElement(i.a.Fragment,null,a&&a.map((function(e,a){return i.a.createElement(dt,{key:a,label:a,task:e,name:"tasks.".concat(t,".").concat(a),disabled:e.id&&("DEFERRED"===e.status||"OPEN"===e.status),onRemove:function(){r&&r(),o(a)}})})),i.a.createElement(g.a,{type:"button",icon:!0,style:{marginLeft:"10px"},primary:!0,onClick:function(e){return l(function(){var e={description:"",status:"",action:"",taskCategory:t};return n&&"AIRCRAFT"===n&&(e.aircraft=c,e.taskCategory=n),e}())}},i.a.createElement(fe.a,{name:"plus circle"})," Add"))}))},pt=function(e){var t=e.costumers,a=e.setCheckedAircrafts,c=e.checkedAircrafts,l=e.values,o=Object(Te.f)().setFieldValue,s=Object(r.useState)({open:!1,aircraft:"",event:""}),m=Object(f.a)(s,2),u=m[0],d=m[1];return i.a.createElement(i.a.Fragment,null,t&&t.map((function(e){return i.a.createElement(r.Fragment,{key:e.name},i.a.createElement(h.a,{as:"h3"},"Work Performed for ",e.name),e.aircrafts.map((function(e){return i.a.createElement(r.Fragment,{key:e.id},i.a.createElement(xe,{label:e.registration,checked:c[e.registration]&&c[e.registration].checked,disabled:c[e.registration]&&c[e.registration].disbleCheck,onChange:function(t,r){var i=r.checked;t.preventDefault(),!i||l.tasks[e.registration]&&0!==l.tasks[e.registration].length||(a(Object(n.a)(Object(n.a)({},c),{},Object(ke.a)({},e.registration,{checked:i}))),o("tasks.".concat(e.registration),[{description:"",status:"",action:"",taskCategory:"AIRCRAFT",aircraft:e.id}])),i||l.tasks[e.registration].length>0&&d({open:!0,aircraft:e.registration})}},i.a.createElement(oe.a,{open:u.open,header:"Uncheck Aircraft ".concat(u.aircraft),content:"Are you sure you want to uncheck this aircraft? Doing so will remove all the entered tasks for this Aircraft",onCancel:function(){d({open:!1})},onConfirm:function(){o("tasks.".concat(u.aircraft),null),a(Object(n.a)(Object(n.a)({},c),{},Object(ke.a)({},u.aircraft,{checked:!1}))),d({open:!1})}}),c[e.registration]&&c[e.registration].checked&&i.a.createElement(ft,{tasksIdentifier:e.registration,tasks:l.tasks[e.registration],taskCategory:"AIRCRAFT",aircraftId:e.id,onRemove:function(){1===l.tasks[e.registration].length&&a(Object(n.a)(Object(n.a)({},c),{},Object(ke.a)({},e.registration,{checked:!1})))}})))})))})))},Et=a(223),gt=a(39),bt=function(e){var t=e.setOpen,a=e.open,c=(e.e,Object(Te.f)()),l=c.getFieldMeta,o=c.setFieldValue,s=Object(p.useMutation)(rt),m=Object(f.a)(s,2),O=m[0],y=m[1],C=y.loading,j=y.error,w=y.data,k=l("startTime").value,T=l("endTime").value,I=Object(r.useState)(""),A=Object(f.a)(I,2),D=A[0],R=A[1],F=Object(r.useState)(""),$=Object(f.a)(F,2),N=$[0],P=$[1],x=Object(r.useState)(""),M=Object(f.a)(x,2),H=M[0],L=M[1],q=Object(r.useState)(k),_=Object(f.a)(q,2),B=_[0],K=_[1],z=Object(r.useState)(T),U=Object(f.a)(z,2),J=U[0],Q=U[1],G=Object(r.useState)("30"),W=Object(f.a)(G,2),Z=W[0],X=W[1],ee=Object(r.useState)(!1),te=Object(f.a)(ee,2),ae=te[0],ne=te[1],re=Object(r.useState)(!1),ie=Object(f.a)(re,2),ce=ie[0],oe=ie[1];Object(r.useEffect)((function(){K(k),Q(T)}),[T,k]),Object(r.useEffect)((function(){if(j&&(ae&&R({type:"error",message:"Failed to register user. ".concat(j.message)}),R(ce?{type:"error",message:"Failed to reset password. ".concat(j.message)}:{type:"error",message:"Failed to add user. ".concat(j.message)})),w&&null!=w.signOffTimeSheet){var e=l("staffs").value;if(Ee.a.find(e,{id:w.signOffTimeSheet.id}))R({type:"error",message:"".concat(w.signOffTimeSheet.name," is already exist on report")});else{var t=[].concat(Object(V.a)(e),[{name:w.signOffTimeSheet.name,startTime:w.signOffTimeSheet.startTime,endTime:w.signOffTimeSheet.endTime,signOffKey:w.signOffTimeSheet.value,id:w.signOffTimeSheet.id,break:w.signOffTimeSheet.break}]);o("staffs",t),ae&&(R({type:"success",message:"".concat(w.signOffTimeSheet.name," is added to report.<br/> Further registration instruction sent to email. Please complete registration within 48 hours")}),ne(!1)),ce?(R({type:"success",message:"".concat(w.signOffTimeSheet.name," is added to report <br/> Password reset link sent to email.")}),oe(!1)):R({type:"success",message:"".concat(w.signOffTimeSheet.name," is added to report")})}}}),[j,w]);var se=function(){var e=Object(d.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=ae?{startTime:t.startTime,endTime:t.endTime,break:parseInt(Z),email:t.email,name:t.fullname,additionalAction:"register"}:ce?{startTime:t.startTime,endTime:t.endTime,break:parseInt(Z),email:t.resetEmail,additionalAction:"reset"}:{startTime:t.startTime,endTime:t.endTime,break:parseInt(Z),username:N,password:H},e.next=3,O({variables:a});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return C?i.a.createElement(Ie.a,{active:!0,inverted:!0},i.a.createElement(le.a,{active:!0,inverted:!0},"Veryfing User")):i.a.createElement(ge.a,{closeIcon:!0,closeOnEscape:!1,closeOnDimmerClick:!1,open:a,onClose:function(){oe(!1),ne(!1),R(!1),t(!1)},onOpen:function(){return t(!0)}},i.a.createElement(ge.a.Header,null,"Add User to Shift "),i.a.createElement(ge.a.Content,null,D&&(D?i.a.createElement(Y.a,{success:"success"===D.type,error:"error"===D.type,onDismiss:function(){return R("")}}," ",D.message):null),i.a.createElement(Te.c,{enableReinitialize:!0,initialValues:{startTime:B,endTime:J,breakt:Z,username:"",password:"",email:"",fullname:"",resetEmail:""},validate:function(e){var t={};if(t=Object(n.a)(Object(n.a)({},t),Je(e.startTime,e.endTime)),ce){var a=Ge(e.resetEmail);a&&(t.resetEmail=a)}if(ae){var r=Ge(e.email);r&&(t.email=r);var i=We(e.fullname);i&&(t.fullname=i)}return t},onSubmit:function(e){se(e)}},(function(e){e.values;var t=e.handleSubmit;e.errors,e.touched;return i.a.createElement(E.a,{size:"large",onSubmit:t},i.a.createElement(E.a.Group,null,i.a.createElement($e,{label:"Start Time",dateTimeFormat:"DD-MM-YYYY HH:mm",name:"startTime",maxDate:Le(Date.now(),30,"m","sub"),minDate:Le(Date.now(),20,"h","sub"),onChange:function(e,t){var a=t.value;K(a)}}),i.a.createElement($e,{label:"End Time",dateTimeFormat:"DD-MM-YYYY HH:mm",name:"endTime",maxDate:He(Date.now()),minDate:Le(B,20,"m","add"),onChange:function(e,t){var a=t.value;Q(a)}}),i.a.createElement(Pe,{inputlabel:"Break",label:"Minutes ",labelPosition:"right corner",name:"breakt",type:"number",min:"0",onChange:function(e,t){var a=t.value;X(a)}})),i.a.createElement(h.a,{as:"h5",color:"blue",textAlign:"center"}),!ae&&!ce&&i.a.createElement(i.a.Fragment,null,i.a.createElement(v.a,null,i.a.createElement(b.a,{columns:2,stackable:!0},i.a.createElement(S.a,{vertical:!0},"Or"),i.a.createElement(b.a.Row,{verticalAlign:"middle"},i.a.createElement(b.a.Column,null,i.a.createElement(b.a.Row,{style:{textAlign:"center"}},i.a.createElement(h.a,{as:"h5",icon:!0},i.a.createElement(fe.a,{name:"sign in alternate"}),"Use Credentials")),i.a.createElement(b.a.Row,null,i.a.createElement(E.a.Group,null,i.a.createElement(E.a.Input,{label:"Username",onChange:function(e,t){var a=t.value;return P(a)}}),i.a.createElement(E.a.Input,{label:"Password",type:"password",onChange:function(e,t){var a=t.value;return L(a)}})),i.a.createElement(E.a.Field,{style:{textAlign:"center"}},i.a.createElement(g.a,{type:"submit",primary:!0}," Sign ")),i.a.createElement(E.a.Field,{style:{textAlign:"center"}},i.a.createElement(g.a,{size:"tiny",onClick:function(){return oe(!0)}},"Forgot Password")))),i.a.createElement(b.a.Column,{textAlign:"center"},i.a.createElement(b.a.Row,null,i.a.createElement(h.a,{icon:!0},i.a.createElement(fe.a,{name:"barcode",size:"massive"}),"Use IdCard")),i.a.createElement(b.a.Row,null,i.a.createElement(g.a,{primary:!0},"Scan")))))),i.a.createElement(gt.a,{style:{textAlign:"center"}},i.a.createElement("label",null," If you do not have a account yet, contact your supervisor or click below."),i.a.createElement(g.a,{type:"button",onClick:function(){return ne(!0)}}," New User "))),ae&&i.a.createElement(v.a,{basic:!0},i.a.createElement(Y.a,{positive:!0},i.a.createElement(Y.a.Header,null,"Register info"),"Please enter following information to add yourself to shift . Registraion instruction will be forwarded to you on the provided email. It is important that you register as soon as possible."),i.a.createElement(Y.a,{warning:!0,visible:!0},i.a.createElement(Y.a.Header,null,"Attention!!"),"Your info will be added to report automatically after this step, make sure you enter your name and work time correctly"),i.a.createElement(E.a.Group,null,i.a.createElement(Pe,{width:"12",name:"fullname",label:"Full Name"}),i.a.createElement(Pe,{width:"12",name:"email",label:"Email Address"})),i.a.createElement(Et.a,null,i.a.createElement(g.a,{positive:!0},"Register"),i.a.createElement(g.a,{type:"button",negative:!0,onClick:function(){return ne(!1)}},"Cancel"))),ce&&i.a.createElement(v.a,{basic:!0},i.a.createElement(Y.a,{warning:!0,visible:!0},i.a.createElement(Y.a.Header,null,"Reset Password"),"Please enter your email address used while creating account."),i.a.createElement(Y.a,{warning:!0,visible:!0},i.a.createElement(Y.a.Header,null,"Attention!!"),"Your info will be added to report automatically after this step, make sure you ",i.a.createElement("strong",null,"Enter your work time correctly")),i.a.createElement(Pe,{width:"12",name:"resetEmail",label:"Email Address"}),i.a.createElement(Et.a,null,i.a.createElement(g.a,{primary:!0},"Reset"),i.a.createElement(g.a,{negative:!0,onClick:function(){return oe(!1)}},"Cancel"))))}))))};function ht(){var e=Object(C.a)(["\n  mutation submitReport($station: String!, $shift:String! , $startTime: String! ,$endTime: String!, $tasks: [ShiftReportTask]! , $staffs: [ShiftReportStaffs!]! ) { \n  submitShiftReport(\n    station:$station\n    shift:$shift\n    startTime: $startTime\n    endTime: $endTime\n    tasks:$tasks\n    staffs: $staffs\n  ){\n    endTime\n    id\n    shift\n    staffAndTime {\n      id\n      staff {\n        name\n      }\n      endTime\n      startTime\n    }\n    startTime\n    station {\n      location\n      id\n    }\n    tasks {\n      aircraft {\n        registration\n        id\n        costumer {\n          name\n        }\n      }\n      taskCategory\n      description\n      id\n      status\n      updates {\n        action\n        handoverId {\n          id\n          shift\n        }\n        note\n      }\n      \n    }\n  } \n}\n"]);return ht=function(){return e},e}var Ot=Object(p.gql)(ht()),vt=function(e){var t=e.setActiveItem,a=Object(r.useContext)(je),c=Object(r.useContext)(G),l=Object(f.a)(c,2)[1],o=a.state.station,s=a.state.lastShiftReport,m=Object(r.useState)(!1),u=Object(f.a)(m,2),d=u[0],b=u[1],O=Object(r.useState)(o.costumers),y=Object(f.a)(O,2),S=y[0],C=y[1],j=Object(r.useState)({}),w=Object(f.a)(j,2),k=w[0],T=w[1],I=Object(r.useState)({startTime:"",endTime:"",staffs:[],tasks:{}}),A=Object(f.a)(I,2),D=A[0],R=A[1],F=Object(p.useMutation)(Ot,{update:function(e,t){var a={getShiftReport:t.data.submitShiftReport};e.writeQuery({query:re,variables:{station:o.id,flag:"MOST_RECENTLY_COMPLETED"},data:a})},onCompleted:function(){t("lastShiftReport")},onError:function(e){l({type:"ADD_NOTIFICATION",payload:{content:e.message,type:"ERROR"}})}}),$=Object(f.a)(F,2),N=$[0],P=$[1].loading,x=function(e){var t=new Date(qe(e));return o.shifts.reduce((function(e,a){var n=a.startTime.split(":"),r=new Date(t);r.setHours(n[0]),r.setMinutes(n[1]);var i=(t-r)/36e5;return i>e.diff&&e.diff<0||i>0&&i<e.diff?{name:a.name,diff:i}:e}),{name:"",diff:-24}).name};Object(r.useEffect)((function(){var e={},t={},a=[];s&&s.tasks&&s.tasks.map((function(r){if("DEFERRED"===r.status||"OPEN"===r.status){var i={id:r.id,aircraft:r.aircraft,description:r.description,status:r.status,updates:r.updates,action:"",newNote:"",taskCategory:r.taskCategory};r.aircraft&&(e[r.aircraft.registration]={checked:!0,disbleCheck:!0}),r.aircraft&&t[r.aircraft.registration]?t[r.aircraft.registration].push(Object(n.a)({},i)):r.aircraft?t[r.aircraft.registration]=[Object(n.a)({},i)]:t[r.taskCategory]?t[r.taskCategory].push(i):t[r.taskCategory]=[i],r.aircraft&&(Ee.a.find(o.costumers,Ee.a.matchesProperty("name",r.aircraft.costumer.name))||(Ee.a.find(a,Ee.a.matchesProperty("name",r.aircraft.costumer.name))?a.aircrafts.push({registration:r.aircraft.registration,id:r.aircraft.id}):a.push({name:r.aircraft.costumer.name,aircrafts:[{registration:r.aircraft.registration,id:r.aircraft.id}]})))}})),C([].concat(Object(V.a)(S),a)),R(Object(n.a)(Object(n.a)({},D),{},{tasks:t})),T(e)}),[]);return P?i.a.createElement(v.a,{style:{height:"10rem"},basic:!0,size:"huge"},i.a.createElement(Ie.a,{active:!0,inverted:!0},i.a.createElement(le.a,{inverted:!0},"Submitting Data"))):i.a.createElement(i.a.Fragment,null,i.a.createElement(Te.c,{enableReinitialize:!0,initialValues:D,validate:function(e){var t={};t=Object(n.a)(Object(n.a)({},t),Je(e.startTime,e.endTime));var a=function(e){var t;return e&&e.length?(e&&e.length&&(t=Ee.a.mapValues(e,(function(e){var t=Ye(e);return Ee.a.isEmpty(t)?(e.signOffKey||(t=Object(n.a)(Object(n.a)({},t),{},{signOffKey:"Each staff must sign off"})),t):t=Object(n.a)(Object(n.a)({},t),{},{signOffKey:"Please fix staff inputs"})}))),Ee.a.mapKeys(t,(function(e,a){Ee.a.isEmpty(e)&&delete t[a]})),t):t="Report must have staff information, please add staff"}(e.staffs),r=function(e){if(!e)return null;var t=Ee.a.mapValues(e,(function(e){var t=Ee.a.mapValues(e,(function(e){return Qe(e)}));return Ee.a.pickBy(t,Ee.a.identity)}));return Ee.a.mapKeys(t,(function(e,a){Ee.a.isEmpty(e)&&delete t[a]})),t}(e.tasks);return Ee.a.isEmpty(r)||(t.tasks=r),Ee.a.isEmpty(a)||(t.staffs=a),t},onSubmit:function(e){var t=function(e){var t={station:o.id,staffs:e.staffs,startTime:e.startTime,endTime:e.endTime,tasks:{}},a=Ee.a.reduce(e.tasks,(function(e,t,a){var r=Ee.a.map(t,(function(e,t){var r;if(D.tasks[a]&&D.tasks[a][t]){r=D.tasks[a]&&D.tasks[a][t];var i=Object.keys(r).filter((function(t){return r[t]!==e[t]}));if(!i)return null;var c=i.reduce((function(t,a){return t[a]=Object(n.a)(Object(n.a)({},t),{},Object(ke.a)({},a,e[a]))}),{});e=Object(n.a)({id:e.id},c)}return e}));return r=r.filter((function(e){return null!==e})),[].concat(Object(V.a)(e),Object(V.a)(r))}),[]),r=e.staffs.map((function(e){return{signOffKey:e.signOffKey,name:e.name}}));return t=Object(n.a)(Object(n.a)({},t),{},{tasks:a,staffs:r,shift:x(e.startTime)})}(e);N({variables:t})}},(function(e){var t=e.values,a=e.handleSubmit,n=e.errors,r=e.touched,c=e.submitCount;return i.a.createElement(i.a.Fragment,null,i.a.createElement(E.a,{onSubmit:a},i.a.createElement(E.a.Group,null,i.a.createElement($e,{label:"Shift Start Time",name:"startTime",maxDate:Le(Date.now(),30,"m","sub"),minDate:Le(Date.now(),20,"h","sub")}),i.a.createElement($e,{label:"Shift End Time",name:"endTime",maxDate:He(Date.now()),minDate:Le(t.startTime,20,"m","add")})),i.a.createElement(ut,{values:t,touched:r,errors:n,addStaffOpen:b}),i.a.createElement(pt,{costumers:S,checkedAircrafts:k,setCheckedAircrafts:T,values:t}),i.a.createElement(h.a,{as:"h3"},"Other Tasks"),i.a.createElement(ft,{tasksIdentifier:"OTHER",tasks:t.tasks.OTHER}," "),i.a.createElement(h.a,{as:"h3"},"Logistics Task"),i.a.createElement(ft,{tasksIdentifier:"LOGISTICS",tasks:t.tasks.LOGISTICS}," "),i.a.createElement(Y.a,{error:!0,content:i.a.createElement(h.a,{as:"h5"},"There are some errors on the report ",i.a.createElement(h.a.Subheader,null,"Please fix the errors before trying again")),visible:!0===(!Ee.a.isEmpty(n)&&c>0)}),i.a.createElement(Y.a,{success:!0,content:i.a.createElement(h.a,{as:"h5"},"Great! Everything seems to be fixed ",i.a.createElement(h.a.Subheader,null,"Please, proceed to submit whenever ready")),visible:!0===(Ee.a.isEmpty(n)&&c>0)}),i.a.createElement(v.a,{disabled:!Ee.a.isEmpty(n)&&c>0,color:"blue",inverted:!0,tertiary:!0,clearing:!0},i.a.createElement(g.a,{floated:"right",type:"submit",primary:!0}," Submit Report ")," ")),i.a.createElement(bt,{setOpen:b,open:d,shiftStartTime:t.startTime,shiftEndTime:t.endTime}))})))},yt=a(660),St=a(170),Ct=a(171),jt=a(613),wt=a(235);function kt(){var e=Object(C.a)(["\nmutation deleteCostumer( $costumer: String){\n  deleteCostumer(\n    costumer: $costumer\n    ){\n      status\n      message\n    }\n}"]);return kt=function(){return e},e}function Tt(){var e=Object(C.a)(["\nmutation removeStationCostumer( $station: String! , $costumer: String){\n  removeCostumerStation(\n    station: $station\n    costumer: $costumer\n    ){\n      status\n      message\n    }\n}"]);return Tt=function(){return e},e}function It(){var e=Object(C.a)(["\nmutation removeContactCostumer( $id: String! , $costumer: String){\n  removeContact(\n    id: $id\n    costumer: $costumer\n    ){\n      status\n      message\n    }\n}"]);return It=function(){return e},e}function At(){var e=Object(C.a)(["\nmutation removeAircraft( $id: String!){\n  removeAircraft(\n    id: $id\n    ){\n      status\n      message\n    }\n}"]);return At=function(){return e},e}function Dt(){var e=Object(C.a)(["\nmutation addStationCostumer( $stations: [String!]! , $costumer: String){\n  addStationsToCostumer(\n    stations: $stations\n    costumer: $costumer\n    ){\n      id\n      stations{\n        id\n        location\n      }\n    }\n}"]);return Dt=function(){return e},e}function Rt(){var e=Object(C.a)(["\nmutation addContactCostumer( $keyContacts: [ContactInput!]! , $costumer: String!){\n  addContact(\n    keyContacts: $keyContacts\n    costumer: $costumer\n    ){      \n        id\n        description\n        email\n        phone   \n    }\n}"]);return Rt=function(){return e},e}function Ft(){var e=Object(C.a)(["\nmutation addAircrafttoCostumer( $registration: [String!]! $costumer: String!){\n  addAircrafts(\n    registration: $registration\n    costumer: $costumer\n    ){\n      id\n      registration\n    }\n}"]);return Ft=function(){return e},e}function $t(){var e=Object(C.a)(["\nmutation addnewCostumer( $name: String! $stations: [String], $keyContacts: [ContactInput], $contract: String! ,$aircrafts: [String]){\n  addCostumer(\n    name: $name\n    stations: $stations\n    keyContacts: $keyContacts\n    aircrafts: $aircrafts\n    contract: $contract){\n      name\n      id\n      contract\n      aircrafts{\n        id\n        registration\n      }\n      stations{\n        id\n      }\n    }\n}"]);return $t=function(){return e},e}var Nt=Object(p.gql)($t()),Pt=Object(p.gql)(Ft()),xt=Object(p.gql)(Rt()),Mt=Object(p.gql)(Dt()),Ht=Object(p.gql)(At()),Lt=Object(p.gql)(It()),qt=Object(p.gql)(Tt()),_t=Object(p.gql)(kt());function Bt(){var e=Object(C.a)([" \nquery getCostumerId ($id:String){\n  getCostumer(\n    id:$id\n  ){\n    name\n    id \n    stations{\n      id\n      location\n      address{\n        street\n        postcode\n        city\n        country\n      }\n    }\n    aircrafts{\n      id\n      registration\n    }\n    contract\n    keyContacts{\n      id\n      phone\n      description\n      email\n    }\n\n\n  }\n}\n\n"]);return Bt=function(){return e},e}function Kt(){var e=Object(C.a)(["\nquery verifyReg ($registrations:String!){\n  verifyAircraftRegistration(registrations: $registrations)\n}\n"]);return Kt=function(){return e},e}function zt(){var e=Object(C.a)(["\nquery fetchAllCostumers ($detailed: Boolean = false) {\n    allCostumers {\n      name\n      id\n      stations  @include(if: $detailed) {\n        id\n        location\n      }\n      contract @include(if: $detailed)\n      aircrafts @include(if: $detailed) {\n        id\n        registration\n      }\n    }\n  }\n"]);return zt=function(){return e},e}var Ut=Object(p.gql)(zt()),Vt=Object(p.gql)(Kt()),Yt=Object(p.gql)(Bt()),Jt=function(e){var t=e.confirm,a=e.setOpen,n=e.open;return i.a.createElement(ge.a,{open:n,closeOnEscape:!1,closeOnDimmerClick:!1},i.a.createElement(ge.a.Header,null,"Confirm"),i.a.createElement(ge.a.Content,null,t.title),i.a.createElement(ge.a.Actions,null,i.a.createElement(g.a,{positive:!0,onClick:function(){t.fn(),a(!1)}},"Confirm "),i.a.createElement(g.a,{negative:!0,onClick:function(){return a(!1)}},"Cancel ")))};function Qt(){var e=Object(C.a)(["\n                fragment NewAircraft on Aircraft {\n                  id\n                  registration\n                }\n              "]);return Qt=function(){return e},e}var Gt=function(e){var t=e.open,a=e.setOpen,n=e.costumer,c=Object(r.useContext)(G),l=Object(f.a)(c,2)[1],o=Object(p.useLazyQuery)(Vt),s=Object(f.a)(o,2),m=s[0],u=s[1],d=u.loading,b=u.data,h=Object(r.useState)([]),O=Object(f.a)(h,2),v=O[0],y=O[1];Object(r.useEffect)((function(){b&&y(b.verifyAircraftRegistration)}),[b]);var S=Object(p.useMutation)(Pt,{update:function(e,t){var a=t.data.addAircrafts;e.modify({id:"Costumer:".concat(n.id),fields:{aircrafts:function(t,n){var r=n.readField,i=[];return Object(pe.forEach)(a,(function(n,c){t.some((function(e){return r("id",e)!==n.id}))&&i.push(e.writeFragment({data:a[c],fragment:Object(p.gql)(Qt())}))})),[].concat(Object(V.a)(t),i)}}})},onCompleted:function(e){var t=e.addAircrafts;l({type:"ADD_NOTIFICATION",payload:{content:"Success, aircrafts ".concat(t.reduce((function(e,t){return e+t.registration+", "}),""),"  added"),type:"SUCCESS"}}),a(!1)},onerror:function(e){l({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to add aircrafts",i.a.createElement("br",null)," ",e.message),type:"ERROR"}}),a(!1)}}),C=Object(f.a)(S,1)[0];return i.a.createElement(Te.c,{initialValues:{aircrafts:[]},validate:function(e){var t={};if(e.aircrafts.length){e.aircrafts.match(/^[a-zA-Z, ]+$/)||(t.aircrafts="Invalid character detected, check again");var a=[];Object(pe.forEach)(e.aircrafts.split(","),(function(e){e.trim().length<3&&a.push(e.trim().toUpperCase())})),a.length&&(t.aircrafts="".concat(a.toString()," invalid Aircraft Registration, should at least 3 characters")),t.aircrafts||(m({variables:{registrations:e.aircrafts}}),v.length&&(t.aircrafts="Registration ".concat(v.toString()," already exists.")))}else t.aircrafts="Enter at least one Aircraft";return t},onSubmit:function(e){var t=e.aircrafts.toUpperCase().split(",");C({variables:{registration:t,costumer:n.id}})}},(function(e){var n=e.handleSubmit;return i.a.createElement(ge.a,{open:t,closeOnEscape:!1,closeOnDimmerClick:!1},i.a.createElement(ge.a.Header,null,"Select Stations to Add"),i.a.createElement(ge.a.Content,null,i.a.createElement(E.a,null,i.a.createElement(Pe,{name:"aircrafts",label:"Aircrafts",type:"text",width:"8",placeholder:'Aircrfat Registrations separeted by comma ","'}))),i.a.createElement(ge.a.Actions,null,i.a.createElement(g.a,{type:"submit",loading:d,disabled:d,positive:!0,onClick:function(e){e.preventDefault(),n()}}," Add "),i.a.createElement(g.a,{type:"button",negative:!0,onClick:function(){return a(!1)}}," Cancel ")))}))};function Wt(){var e=Object(C.a)(["\n                fragment NewContact on Contact {\n                  id\n                  email\n                  phone\n                  description\n                }\n              "]);return Wt=function(){return e},e}var Zt=function(e){var t=e.open,a=e.setOpen,c=e.costumer,l=Object(r.useContext)(G),o=Object(f.a)(l,2)[1],s=Object(p.useMutation)(xt,{update:function(e,t){var a=t.data.addContact;e.modify({id:"Costumer:".concat(c.id),fields:{keyContacts:function(t,n){var r=n.readField,i=[];return Object(pe.forEach)(a,(function(a){t.some((function(e){return r("id",e)!==a.id}))&&i.push(e.writeFragment({data:a,fragment:Object(p.gql)(Wt())}))})),[].concat(Object(V.a)(t),i)}}})},onCompleted:function(e){e.addContact;o({type:"ADD_NOTIFICATION",payload:{content:"Success, contacts added",type:"SUCCESS"}}),a(!1)},onerror:function(e){o({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to add contacts",i.a.createElement("br",null)," ",e.message),type:"ERROR"}}),a(!1)}}),m=Object(f.a)(s,1)[0];return i.a.createElement(Te.c,{initialValues:{keyContacts:[{description:"",phone:"",email:""}]},validate:function(e){var t={};return e.keyContacts.length&&Object(pe.forEach)(e.keyContacts,(function(e,a){e.description||(t.keyContacts||(t.keyContacts=[]),t.keyContacts[a]||(t.keyContacts[a]={}),t.keyContacts[a].description="Please provide contact description"),e.phone||e.email||(t.keyContacts||(t.keyContacts=[]),t.keyContacts[a]||(t.keyContacts[a]={}),t.keyContacts[a].phone="At least a phone or a email is required",t.keyContacts[a].email="At least a phone or a email is required"),e.email&&Ge(e.email)&&(t.keyContacts||(t.keyContacts=[]),t.keyContacts[a]||(t.keyContacts[a]={}),t.keyContacts[a].email="Invalid Email")})),t},onSubmit:function(e){m({variables:Object(n.a)(Object(n.a)({},e),{},{costumer:c.id})})}},(function(e){var n=e.handleSubmit,c=e.values;return i.a.createElement(ge.a,{open:t,closeOnEscape:!1,closeOnDimmerClick:!1},i.a.createElement(ge.a.Header,null,"Select Stations to Add"),i.a.createElement(ge.a.Content,null,i.a.createElement(E.a,null,i.a.createElement(Te.b,{name:"keyContacts"},(function(e){var t=e.push,a=e.remove;return i.a.createElement(i.a.Fragment,null,c.keyContacts.length>0&&c.keyContacts.map((function(e,t){return i.a.createElement(r.Fragment,{key:t},i.a.createElement(E.a.Group,{style:{margin:0},widths:"13"},i.a.createElement(Pe,{name:"keyContacts[".concat(t,"].description"),label:"Description"}),i.a.createElement(Pe,{name:"keyContacts[".concat(t,"].phone"),label:"Phone"}),i.a.createElement(Pe,{name:"keyContacts[".concat(t,"].email"),label:"Email"}),0!==t&&i.a.createElement(fe.a,{link:!0,name:"cancel",color:"red",onClick:function(){return a(t)}})))})),i.a.createElement(g.a,{style:{marginTop:"1rem"},type:"button",circular:!0,icon:!0,size:"mini",primary:!0,onClick:function(){return t({description:"",phone:"",email:""})}},i.a.createElement(fe.a,{name:"plus"})))})))),i.a.createElement(ge.a.Actions,null,i.a.createElement(g.a,{type:"submit",positive:!0,onClick:function(e){e.preventDefault(),n()}}," Add "),i.a.createElement(g.a,{type:"button",negative:!0,onClick:function(){return a(!1)}}," Cancel ")))}))},Xt=a(662),ea=a(136),ta=function(e){var t=Object.assign({},e),a=Object(Te.e)(t),n=Object(f.a)(a,2),r=n[0],c=n[1];return i.a.createElement(E.a.Field,null,i.a.createElement("label",null,t.inputlabel),i.a.createElement(Re.a,Object.assign({},r,t,{error:c.touched&&c.error})))},aa=function(e){var t=e.name,a=Object(Te.f)().getFieldProps,n=a("".concat(t,".title")).value,r=a("".concat(t,".date")).value,c=a("".concat(t,".by")).value,l=a("".concat(t,".text")).value,o=a("".concat(t,".edit")).value;return n&&"Add Clearification"!==n?i.a.createElement(v.a,null,i.a.createElement(h.a,{as:"h5"},n,i.a.createElement(h.a.Subheader,null,"by ",c," on ",r)),n&&i.a.createElement("p",null,l),o&&i.a.createElement(Xt.a,null,Ee.a.map(o,(function(e,t){return i.a.createElement(Xt.a.Item,{key:t},t[0].toUpperCase()+t.substring(1).replace(/([a-z])([A-Z])/g,"$1 $2"),":",i.a.createElement("span",{style:{color:"red",fontStyle:"italic",textDecoration:"line-through"}}," ",e.split("to")[0]," "),"to",i.a.createElement("span",{style:{color:"green"}}," ",e.split("to")[1]," "))})))):i.a.createElement(v.a,{basic:!0},n&&i.a.createElement(h.a,{as:"h5"},"Add Clearification"===n&&"Clearification Added",i.a.createElement(h.a.Subheader,null,"by ",c," on ",r)),i.a.createElement(Me,{name:"".concat(t,".text")}))},na=function(e){var t=e.label,a=Object(Ae.a)(e,["label"]),n=Object(Te.f)().setFieldValue,r=Object(Te.e)(a),c=Object(f.a)(r,2),l=c[0],o=c[1];return i.a.createElement(E.a.Field,{error:!(!o.touched||!o.error)},!a.labeled&&i.a.createElement("label",null,t),i.a.createElement(Re.a,{label:!!a.labeled&&t,input:i.a.createElement(ea.a,Object.assign({},l,a,{style:a.labeled?{margin:0,borderTopLeftRadius:0,borderBottomLeftRadius:0}:{},onChange:a.onChange?a.onChange:function(e,t){var r=t.value;n(a.name,r)}}))}),o.touched&&o.error&&i.a.createElement(de.a,{pointing:!0,prompt:!0},o.error))},ra=function(e){var t=e.open,a=e.setOpen,c=e.costumer,l=Object(r.useContext)(G),o=Object(f.a)(l,2)[1],s=Object(r.useState)([]),m=Object(f.a)(s,2),u=m[0],d=m[1],b=Object(p.useLazyQuery)(k),h=Object(f.a)(b,2),O=h[0],v=h[1],y=v.loading,S=v.data;Object(r.useEffect)((function(){if(S&&S.allStations){var e=c.stations.map((function(e){return e.id})),t=[];S.allStations.reduce((function(a,n,r){return n.id&&!e.includes(n.id)&&t.push({key:r,value:n.id,text:n.location}),t}),[]),d(t)}}),[c.stations,S]);var C=Object(p.useMutation)(Mt,{update:function(e,t){var a=t.data.addStationsToCostumer;Object(pe.forEach)(a.stations,(function(t){e.modify({id:"Station:".concat(t.id),fields:{costumers:function(e,t){var n=t.readField;return e.some((function(e){return n("id",e)===a.id}))?e:[].concat(Object(V.a)(e),[{__ref:"Costumer:".concat(a.id)}])}}})}))},onCompleted:function(e){e.addStationsToCostumer;o({type:"ADD_NOTIFICATION",payload:{content:"Success, stations added",type:"SUCCESS"}}),a(!1)},onerror:function(e){o({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to add stations",i.a.createElement("br",null)," ",e.message),type:"ERROR"}}),a(!1)}}),j=Object(f.a)(C,1)[0];return i.a.createElement(Te.c,{initialValues:{stations:[]},validate:function(e){var t={};return e.stations.length||(t.stations="Please select at least one station"),t},onSubmit:function(e){j({variables:Object(n.a)(Object(n.a)({},e),{},{costumer:c.id})})}},(function(e){var n=e.handleSubmit,r=e.setFieldValue;e.dirty;return i.a.createElement(ge.a,{open:t,closeOnEscape:!1,closeOnDimmerClick:!1},i.a.createElement(ge.a.Header,null,"Select Stations to Add"),i.a.createElement(ge.a.Content,null,i.a.createElement(E.a,null,i.a.createElement(na,{name:"stations",labeled:!0,label:"Station",placeholder:"Select Stations",search:!0,loading:y,selection:!0,multiple:!0,width:"8",options:u,onFocus:function(){return O()},onChange:function(e,t){var a=t.value;r("stations",a)}}))),i.a.createElement(ge.a.Actions,null,i.a.createElement(g.a,{type:"submit",positive:!0,onClick:function(e){e.preventDefault(),n()}}," Add "),i.a.createElement(g.a,{type:"button",negative:!0,onClick:function(){return a(!1)}}," Cancel ")))}))},ia=function(e){var t=e.costumerData,a=e.costumerId,n=JSON.parse(sessionStorage.getItem("staffKey")),c=Object(r.useContext)(G),l=Object(f.a)(c,2)[1],o=Object(r.useState)(""),m=Object(f.a)(o,2),u=m[0],d=m[1],E=Object(r.useState)(!1),O=Object(f.a)(E,2),y=O[0],S=O[1],C=Object(r.useState)(!1),j=Object(f.a)(C,2),w=j[0],k=j[1],T=Object(r.useState)(!1),I=Object(f.a)(T,2),A=I[0],D=I[1],R=Object(s.i)(),F=Object(s.g)(),$=Object(p.useQuery)(Yt,{variables:{id:R.costumerId||a},skip:t}),N=$.loading,P=$.error,x=$.data,M=Object(p.useMutation)(qt),H=Object(f.a)(M,1)[0],L=Object(p.useMutation)(_t,{update:function(e){e.evict({id:"Costumer:".concat(u.id)})},onCompleted:function(){F.goBack(),l({type:"ADD_NOTIFICATION",payload:{content:"Success, costumer ".concat(u.name," deleted"),type:"SUCCESS"}})},onerror:function(e){l({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to delete  costumer ".concat(u.name),i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}}),q=Object(f.a)(L,1)[0],_=Object(p.useMutation)(Lt),B=Object(f.a)(_,1)[0],K=Object(p.useMutation)(Ht),z=Object(f.a)(K,1)[0],U=function(e){var t=e.variables,a=e.location;H({variables:t,update:function(e){e.modify({id:"Station:".concat(t.station),fields:{costumers:function(e,t){var a=t.readField;return e.filter((function(e){return u.id!==a("id",e)}))}}}),e.modify({id:"Costumer:".concat(u.id),fields:{stations:function(e,a){var n=a.readField;return e.filter((function(e){return t.station!==n("id",e)}))}}})}}).then((function(e){l({type:"ADD_NOTIFICATION",payload:{content:"Success, Station ".concat(a||""," deassigned for costumer ").concat(u.name),type:"SUCCESS"}}),F.goBack()}),(function(e){return l({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, Cannot deassign costumer ".concat(u.name," ").concat(a?"and "+a:""),i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}))},V=Object(r.useState)({title:"",fn:function(){}}),Y=Object(f.a)(V,2),J=Y[0],Q=Y[1],W=Object(r.useState)(!1),Z=Object(f.a)(W,2),X=Z[0],ee=Z[1];return Object(r.useEffect)((function(){t&&d(t),x&&d(x.getCostumer)}),[t,x,d]),u?N?i.a.createElement(v.a,{basic:!0},i.a.createElement(le.a,{active:!0}," Adding New Costumer")):P?i.a.createElement(h.a,{as:"h4"},"Something went wrong"):i.a.createElement(i.a.Fragment,null,i.a.createElement(h.a,{as:"h3"},u.name),i.a.createElement(b.a,{padded:!0},i.a.createElement(b.a.Row,{columns:"3"},i.a.createElement(b.a.Column,null,i.a.createElement(h.a,{as:"h5"}," Aircrafts "),i.a.createElement(v.a,null,u.aircrafts&&u.aircrafts.map((function(e,t){return i.a.createElement(v.a,{key:t,compact:!0,style:{display:"inline-flex",margin:"0.1rem",width:"4.3rem"}},n&&n.permission.admin&&i.a.createElement(de.a,{floating:!0,size:"tiny",style:{backgroundColor:"transparent"}},i.a.createElement(fe.a,{link:!0,name:"cancel",onClick:function(){Q({title:"Are you sure you want to  deassign Aircraft ".concat(e.registration," from this Costumer ?"),fn:function(){!function(e){var t=e.id,a=e.registration;z({variables:{id:t},update:function(e){e.evict({id:"Aircraft:".concat(t)})}}).then((function(e){return l({type:"ADD_NOTIFICATION",payload:{content:"Success, Aircraft ".concat(a," removed"),type:"SUCCESS"}})}),(function(e){return l({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, Cannot remove Aircrfat ".concat(a),i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}))}({id:e.id,registration:e.registration})}}),ee(!0)}})),e.registration)})),n&&n.permission.admin&&i.a.createElement(g.a,{style:{marginTop:"1rem",display:"block"},circular:!0,icon:!0,primary:!0,size:"small",onClick:function(){return k(!0)}},i.a.createElement(fe.a,{name:"add"})))),i.a.createElement(b.a.Column,null,i.a.createElement(h.a,{as:"h5"}," Key Contacts "),i.a.createElement(ye.a,null,i.a.createElement(ye.a.Header,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.HeaderCell,null," Description "),i.a.createElement(ye.a.HeaderCell,null," Phone "),i.a.createElement(ye.a.HeaderCell,null," Email "),i.a.createElement(ye.a.HeaderCell,null," "))),i.a.createElement(ye.a.Body,null,u.keyContacts&&u.keyContacts.length>0&&u.keyContacts.map((function(e,t){return i.a.createElement(ye.a.Row,{key:t},i.a.createElement(ye.a.Cell,null,e.description),i.a.createElement(ye.a.Cell,null,e.phone),i.a.createElement(ye.a.Cell,null,e.email),n&&(n.permission.admin||n.permission.station.edit.includes(R.stationId))&&i.a.createElement(ye.a.Cell,null,i.a.createElement(fe.a,{link:!0,name:"cancel",onClick:function(){Q({title:"Are you sure you want to  remove contact ".concat(e.description," from this Costumer ?"),fn:function(){!function(e){var t=e.id,a=e.description;B({variables:{id:t,costumer:u.id},update:function(e){e.evict({id:"Contact:".concat(t)})}}).then((function(e){return l({type:"ADD_NOTIFICATION",payload:{content:"Success, Contact ".concat(a," removed"),type:"SUCCESS"}})}),(function(e){return l({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, Cannot remove Contact ".concat(a),i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}))}({id:e.id,description:e.description})}}),ee(!0)}})))}))),n&&(n.permission.admin||n.permission.station.edit.includes(R.stationId))&&i.a.createElement(ye.a.Footer,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.Cell,null,i.a.createElement(g.a,{circular:!0,icon:!0,primary:!0,size:"small",onClick:function(){return D(!0)}},i.a.createElement(fe.a,{name:"add"}))))))),i.a.createElement(b.a.Column,null,i.a.createElement(h.a,{as:"h5"}," Stations "),i.a.createElement(ye.a,{padded:!0},i.a.createElement(ye.a.Header,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.HeaderCell,null," Station "),i.a.createElement(ye.a.HeaderCell,null),i.a.createElement(ye.a.HeaderCell,null))),i.a.createElement(ye.a.Body,null,u.stations&&u.stations.length>0&&u.stations.map((function(e,t){return i.a.createElement(ye.a.Row,{key:t},i.a.createElement(ye.a.Cell,null,e.location),i.a.createElement(ye.a.Cell,null,"".concat(e.address.city," , ").concat(e.address.country)," ",i.a.createElement(jt.a,{name:e.address.country&&e.address.country.toLowerCase()})),n&&(n.permission.admin||n.permission.station.edit.includes(R.stationId))&&i.a.createElement(ye.a.Cell,null,R.stationId!==e.id&&i.a.createElement(fe.a,{link:!0,name:"cancel",onClick:function(){Q({title:"Are you sure you want to  remove station ".concat(e.location," from this Costumer ?"),fn:function(){U({variables:{station:e.id,costumer:u.id},location:e.location})}}),ee(!0)}})))}))),n&&(n.permission.admin||n.permission.station.edit.includes(R.stationId))&&i.a.createElement(ye.a.Footer,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.Cell,null,i.a.createElement(g.a,{circular:!0,icon:!0,primary:!0,size:"small",onClick:function(){return S(!0)}},i.a.createElement(fe.a,{name:"add"})))))))),i.a.createElement(b.a.Row,null,R.stationId&&n&&(n.permission.admin||n.permission.station.edit.map((function(e){return e._id})).includes(R.stationId))&&i.a.createElement(g.a,{negative:!0,onClick:function(){Q({title:"Are you sure you want to  remove costumer ".concat(u.name," from this station ?"),fn:function(){U({variables:{station:R.stationId,costumer:u.id}})}}),ee(!0)}}," Remove from Station "),!R.stationId&&n&&n.permission.admin&&i.a.createElement(g.a,{icon:!0,negative:!0,onClick:function(){Q({title:"Are you sure you want to  delete costumer ".concat(u.name," ?"),fn:function(){q({variables:{costumer:u.id}})}}),ee(!0)}}," ",i.a.createElement(fe.a,{name:"trash"})," Delete Costumer "))),X&&i.a.createElement(Jt,{open:X,confirm:J,setOpen:ee}),y&&i.a.createElement(ra,{open:y,setOpen:S,costumer:u}),w&&i.a.createElement(Gt,{open:w,setOpen:k,costumer:u}),A&&i.a.createElement(Zt,{open:A,setOpen:D,costumer:u})):null},ca=function(e){var t=e.open,a=e.setOpen,c=e.station,l=Object(r.useContext)(G),o=Object(f.a)(l,2)[1],s=Object(r.useState)([]),m=Object(f.a)(s,2),u=m[0],d=m[1],b=Object(p.useLazyQuery)(Ut),h=Object(f.a)(b,2),O=h[0],v=h[1],y=v.loading,S=v.data;Object(r.useEffect)((function(){if(S&&S.allCostumers){var e=c.costumers.map((function(e){return e.id})),t=S.allCostumers.map((function(e,t){return{key:t,value:e.id,text:e.name}}));d(t.filter((function(t){return!e.includes(t.value)})))}}),[S,c.costumers]);var C=Object(p.useMutation)(U,{update:function(e,t){var a=t.data.assignCostumers;Object(pe.forEach)(a.costumers,(function(t){e.modify({id:"Costumer:".concat(t.id),fields:{stations:function(e,t){var a=t.readField;return e.some((function(e){return a("id",e)===c.id}))?e:[].concat(Object(V.a)(e),[{__ref:"Sation:".concat(c.id)}])}}})}))},onCompleted:function(e){o({type:"ADD_NOTIFICATION",payload:{content:"Success, costumers assigned to station",type:"SUCCESS"}}),a(!1)},onerror:function(e){o({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to assign costumers",i.a.createElement("br",null)," ",e.message),type:"ERROR"}}),a(!1)}}),j=Object(f.a)(C,1)[0];return i.a.createElement(Te.c,{initialValues:{costumers:[]},validate:function(e){var t={};return e.costumers.length||(t.costumers="Please select at least one costumer"),t},onSubmit:function(e){j({variables:Object(n.a)(Object(n.a)({},e),{},{stationId:c.id})})}},(function(e){var n=e.handleSubmit,r=e.setFieldValue;return i.a.createElement(ge.a,{open:t,closeOnEscape:!1,closeOnDimmerClick:!1},i.a.createElement(ge.a.Header,null,"Select costumers to Assign"),i.a.createElement(ge.a.Content,null,i.a.createElement(E.a,null,i.a.createElement(na,{name:"costumers",labeled:!0,label:"Costumers",placeholder:"Select Costumers",search:!0,loading:y,selection:!0,multiple:!0,width:"8",options:u,onFocus:function(){return O()},onChange:function(e,t){var a=t.value;r("costumers",a)}}))),i.a.createElement(ge.a.Actions,null,i.a.createElement(g.a,{type:"submit",positive:!0,onClick:function(e){e.preventDefault(),n()}}," Add "),i.a.createElement(g.a,{type:"button",negative:!0,onClick:function(){return a(!1)}}," Cancel ")))}))},la=function(e){var t=e.open,a=e.setOpen,n=e.station,c=Object(r.useContext)(G),l=Object(f.a)(c,2)[1],o=Object(r.useState)([]),s=Object(f.a)(o,2),m=s[0],u=s[1],d=Object(p.useMutation)(L,{update:function(e){e.modify({id:"Station:".concat(n.id),fields:{mailingList:function(e){var t=[];return Object(pe.forEach)(m,(function(a){e.some((function(e){return e===a}))||t.push(a)})),[].concat(Object(V.a)(e),t)}}})},onCompleted:function(e){e.addAircrafts;l({type:"ADD_NOTIFICATION",payload:{content:"Success, emails ".concat(m.toString(),"  added"),type:"SUCCESS"}}),a(!1)},onerror:function(e){l({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to add emails",i.a.createElement("br",null)," ",e.message),type:"ERROR"}}),a(!1)}}),b=Object(f.a)(d,1)[0];return i.a.createElement(Te.c,{initialValues:{emails:""},validate:function(e){var t={};if(e.emails.length){var a=[];Object(pe.forEach)(e.emails.split(","),(function(e){Ge(e.trim())&&a.push(e)})),a.length&&(t.emails="".concat(a.toString()," Invalid emails"))}else t.emails="Enter at least one Email";return t},onSubmit:function(e){u(e.emails.split(",")),b({variables:{emails:e.emails.split(","),stationId:n.id}})}},(function(e){var n=e.handleSubmit;return i.a.createElement(ge.a,{open:t,closeOnEscape:!1,closeOnDimmerClick:!1},i.a.createElement(ge.a.Header,null,"Select Stations to Add"),i.a.createElement(ge.a.Content,null,i.a.createElement(E.a,null,i.a.createElement(Pe,{name:"emails",label:"Emails",type:"text",width:"8",placeholder:'Emails separeted by comma ","'}))),i.a.createElement(ge.a.Actions,null,i.a.createElement(g.a,{type:"submit",positive:!0,onClick:function(e){e.preventDefault(),n()}}," Add "),i.a.createElement(g.a,{type:"button",negative:!0,onClick:function(){return a(!1)}}," Cancel ")))}))};function oa(){var e=Object(C.a)(["\n                fragment NewShift on ShiftInfo {\n                  id\n                  name\n                  startTime\n                }\n              "]);return oa=function(){return e},e}var sa=function(e){var t=e.open,a=e.setOpen,c=e.station,l=Object(r.useContext)(G),o=Object(f.a)(l,2)[1],s=Object(p.useMutation)(_,{update:function(e,t){var a=t.data.addShifts;e.modify({id:"Station:".concat(c.id),fields:{shifts:function(t,n){var r=n.readField,i=[];return Object(pe.forEach)(a,(function(a){t.some((function(e){return r("id",e)===a.id}))||i.push(e.writeFragment({data:a,fragment:Object(p.gql)(oa())}))})),[].concat(Object(V.a)(t),i)}}})},onCompleted:function(){o({type:"ADD_NOTIFICATION",payload:{content:"Success, shifts added",type:"SUCCESS"}}),a(!1)},onerror:function(e){o({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to add shifts",i.a.createElement("br",null)," ",e.message),type:"ERROR"}}),a(!1)}}),m=Object(f.a)(s,1)[0];return i.a.createElement(Te.c,{initialValues:{shifts:[{name:"",startTime:""}]},validate:function(e){var t={};return e.shifts.length&&Object(pe.forEach)(e.shifts,(function(e,a){e.name||(t.shifts||(t.shifts=[]),t.shifts[a]||(t.shifts[a]={}),t.shifts[a].name="Please provide shift name"),e.startTime||(t.shifts||(t.shifts=[]),t.shifts[a]||(t.shifts[a]={}),t.shifts[a].startTime="Shift start time is required"),e.startTime&&(e.startTime.match(/^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/)||(t.shifts||(t.shifts=[]),t.shifts[a]||(t.shifts[a]={}),t.shifts[a].startTime="Shift start should be on format HH:mm"))})),t},onSubmit:function(e){m({variables:Object(n.a)(Object(n.a)({},e),{},{stationId:c.id})})}},(function(e){var n=e.handleSubmit,c=e.values;return i.a.createElement(ge.a,{open:t,closeOnEscape:!1,closeOnDimmerClick:!1},i.a.createElement(ge.a.Header,null,"Select Stations to Add"),i.a.createElement(ge.a.Content,null,i.a.createElement(E.a,null,i.a.createElement(Te.b,{name:"shifts"},(function(e){var t=e.push,a=e.remove;return i.a.createElement(i.a.Fragment,null,c.shifts.length>0&&c.shifts.map((function(e,t){return i.a.createElement(r.Fragment,{key:t},i.a.createElement(E.a.Group,{style:{margin:0},widths:"13"},i.a.createElement(Pe,{name:"shifts[".concat(t,"].name"),placeholder:"Shift Name"}),i.a.createElement(Ne,{name:"shifts[".concat(t,"].startTime"),label:!0,placeholder:"Start Time"}),0!==t&&i.a.createElement(fe.a,{link:!0,name:"cancel",color:"red",onClick:function(){return a(t)}})))})),i.a.createElement(g.a,{style:{marginTop:"1rem"},type:"button",circular:!0,icon:!0,size:"mini",primary:!0,onClick:function(){return t({name:"",startTime:""})}},i.a.createElement(fe.a,{name:"plus"})))})))),i.a.createElement(ge.a.Actions,null,i.a.createElement(g.a,{type:"submit",positive:!0,onClick:function(e){e.preventDefault(),n()}}," Add "),i.a.createElement(g.a,{type:"button",negative:!0,onClick:function(){return a(!1)}}," Cancel ")))}))},ma=a(164),ua=a(165),da=function(e){var t=Object(r.useContext)(G),a=Object(f.a)(t,2)[1],n=Object(p.useMutation)(K,{onCompleted:function(){a({type:"ADD_NOTIFICATION",payload:{content:"Success, key reset ",type:"SUCCESS"}}),e.setOpen(!1)},onError:function(t){a({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to change key",i.a.createElement("br",null)," ",t.message),type:"ERROR"}}),e.setOpen(!1)}}),c=Object(f.a)(n,2),l=c[0],o=c[1].loading;return i.a.createElement(ge.a,{closeIcon:!0,closeOnEscape:!1,closeOnDimmerClick:!1,open:e.open,onClose:function(){return e.setOpen(!1)},onOpen:function(){return e.setOpen(!0)}},i.a.createElement(ma.a,null,"StationKey Reset"),i.a.createElement(ua.a,null,o&&i.a.createElement(Ie.a,{active:!0},"Updating key",i.a.createElement(le.a,null)),i.a.createElement(Te.c,{initialValues:{newKey:"",confirmKey:""},validate:function(e){var t={};return e.newKey||(t.newKey="New key cannot be empty"),e.newKey!==e.confirmKey&&(t.confirmKey="New key and confirm key must match"),t},onSubmit:function(t){l({variables:{stationId:e.station.id,stationKey:t.newKey}})}},(function(e){var t=e.handleSubmit,a=e.dirty,n=e.errors;return i.a.createElement(E.a,{style:{marginBottom:"5rem"},onSubmit:t},i.a.createElement(b.a,null,i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"newKey",label:"New key",type:"password"})),i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"confirmKey",label:"Confirm key",type:"password"}))),a&&Ee.a.isEmpty(n)&&i.a.createElement(g.a,{type:"submit",style:{marginTop:"1rem"},positive:!0},"Change key"))}))))},fa=function(e){var t=JSON.parse(sessionStorage.getItem("staffKey")),a=Object(r.useContext)(G),n=Object(f.a)(a,2)[1],c=Object(r.useState)(!1),l=Object(f.a)(c,2),o=l[0],m=l[1],u=Object(r.useState)(!1),d=Object(f.a)(u,2),O=d[0],y=d[1],S=Object(r.useState)(!1),C=Object(f.a)(S,2),j=C[0],w=C[1],k=Object(r.useState)(!1),I=Object(f.a)(k,2),A=I[0],D=I[1],R=Object(r.useState)({title:"",fn:function(){}}),F=Object(f.a)(R,2),$=F[0],N=F[1],P=Object(r.useState)(e.data),x=Object(f.a)(P,2),M=x[0],H=x[1],L=Object(s.g)(),_=Object(s.i)().stationId,K=Object(p.useQuery)(T,{variables:{id:_},onerror:function(e){n({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, could not retrive Station",i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}}).data;Object(r.useEffect)((function(){K&&K.getStation&&H(K.getStation)}),[K]);var U=Object(p.useMutation)(z,{variables:{stationId:_},update:function(e){e.evict({id:"Station:".concat(_)})},onCompleted:function(e){e.addContact;n({type:"ADD_NOTIFICATION",payload:{content:"Station Deleted",type:"SUCCESS"}}),L.push("/Manage/AllStations")},onerror:function(e){n({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to delete Station",i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}}),Y=Object(f.a)(U,1)[0],J=Object(p.useMutation)(q),Q=Object(f.a)(J,1)[0],W=Object(p.useMutation)(B),Z=Object(f.a)(W,1)[0];return i.a.createElement(i.a.Fragment,null,i.a.createElement(b.a,{padded:!0},i.a.createElement(b.a.Row,null,i.a.createElement(v.a,{basic:!0,attached:!0},i.a.createElement(h.a,{as:"h5"},"Mailing List",i.a.createElement(h.a.Subheader,null,"Below emails will receive the shift reports on submit.")),i.a.createElement(ye.a,{attached:!0,compact:!0,collapsing:!0,padded:!0},i.a.createElement(ye.a.Body,null,M&&M.mailingList.map((function(e,t){return i.a.createElement(ye.a.Row,{key:t},i.a.createElement(ye.a.Cell,null,e),i.a.createElement(ye.a.Cell,null,i.a.createElement(fe.a,{link:!0,name:"trash",onClick:function(){m(!0),N({title:" Are you sure you want to delete this email",fn:function(){return function(e){Q({variables:{email:e,stationId:_},update:function(t){t.modify({id:"Station:".concat(_),fields:{mailingList:function(t){return Object(V.a)(t.filter((function(t){return t!==e})))}}})}}).then((function(t){return n({type:"ADD_NOTIFICATION",payload:{content:"Success, ".concat(e," removed from mailing list "),type:"SUCCESS"}})}),(function(e){return n({type:"ADD_NOTIFICATION",payload:{content:"Error, coluld not remove email",type:"ERROR"}})}))}(e)}})}})))})))),i.a.createElement(E.a.Button,{style:{marginTop:"0.5rem"},primary:!0,size:"tiny",onClick:function(){return w(!0)}}," Add More ")),i.a.createElement(v.a,{basic:!0,attached:!0},i.a.createElement(h.a,{as:"h5"},"Shifts",i.a.createElement(h.a.Subheader,null,"Below are the working shifts for this station. ")),i.a.createElement(ye.a,{attached:!0,compact:!0,collapsing:!0,padded:!0},i.a.createElement(ye.a.Body,null,M&&M.shifts.map((function(e,t){return i.a.createElement(ye.a.Row,{key:t},i.a.createElement(ye.a.Cell,null,e.name," ",i.a.createElement("strong",null,"starts at")," ",e.startTime),i.a.createElement(ye.a.Cell,null,i.a.createElement(fe.a,{link:!0,name:"trash",onClick:function(){m(!0),N({title:" Are you sure you want to remove this shift",fn:function(){return t=e.id,a=e.name,void Z({variables:{id:t,stationId:_},update:function(e){e.evict({id:"ShiftInfo:".concat(t)})}}).then((function(e){return n({type:"ADD_NOTIFICATION",payload:{content:"Success, ".concat(a," shift removed from station "),type:"SUCCESS"}})}),(function(e){return n({type:"ADD_NOTIFICATION",payload:{content:"Error, coluld not remove shift",type:"ERROR"}})}));var t,a}})}})))})))),i.a.createElement(E.a.Button,{style:{marginTop:"0.5rem"},primary:!0,size:"tiny",onClick:function(){return y(!0)}}," Add More ")),i.a.createElement(v.a,{attached:!0},i.a.createElement(h.a,{as:"h5"},"Staff signing mehtods",i.a.createElement(h.a.Subheader,null,"Staff can sign and report working hours using following Methods ")),i.a.createElement("p",null,"This feature is not Implmented yet. By default, user should sign with his credentials.")),i.a.createElement(v.a,{attached:!0},i.a.createElement(g.a,{primary:!0,onClick:function(){D(!0)}}," Reset station key ")))),t.permission.admin&&i.a.createElement(g.a,{negative:!0,onClick:function(){m(!0),N({title:" Are you sure you want to delete this station",fn:function(){return Y()}})}}," DELETE STATION "),o&&i.a.createElement(Jt,{open:o,confirm:$,setOpen:m}),O&&i.a.createElement(sa,{station:M,open:O,setOpen:y}),j&&i.a.createElement(la,{station:M,open:j,setOpen:w}),A&&i.a.createElement(da,{station:M,open:A,setOpen:D}))},pa=function(e){var t=e.station,a=e.activeItem,n=e.setActiveItem,r=e.setActiveCostumer,c=Object(s.g)(),l=JSON.parse(sessionStorage.getItem("staffKey")),o=Object(s.h)(),m=function(e,t){var i=t.name;n(i),r(""),a!==i&&l&&c.push(function(e){var t=o.pathname.split("/").filter((function(e){return""!==e}));return t.reduce((function(e,n,r){return n===a||t.length-1===r?(t.splice(1),e):e+"/"+n}),"")+"/"+e}(i))};return i.a.createElement(se.a,{pointing:!0,secondary:!0},i.a.createElement(se.a.Item,{header:!0},t.location),i.a.createElement(se.a.Item,{position:"right",name:"BasicInfo",active:"BasicInfo"===a,onClick:m}),i.a.createElement(se.a.Item,{name:"Procedures",active:"Procedures"===a,onClick:m}),i.a.createElement(se.a.Item,{name:"Costumers",active:"Costumers"===a,onClick:m}),l&&(l.permission.admin||l.permission.station.edit.map((function(e){return e._id})).includes(t.id))&&i.a.createElement(se.a.Item,{name:"Settings",active:"Settings"===a,onClick:m}))},Ea=function(e){var t=Object(r.useState)(""),a=Object(f.a)(t,2),n=a[0],c=a[1],l=Object(r.useState)("BasicInfo"),m=Object(f.a)(l,2),u=m[0],d=m[1],E=Object(r.useState)(""),O=Object(f.a)(E,2),y=O[0],S=O[1],C=Object(r.useState)(!1),j=Object(f.a)(C,2),w=j[0],k=j[1],I=Object(s.g)(),A=Object(s.h)(),D=A.pathname&&A.pathname.split("/").filter((function(e){return e})),R=Object(s.i)();Object(r.useEffect)((function(){R.page&&d(R.page)}),[R]);var F=Object(s.i)().stationId;e.stationId&&(F=e.stationId);var $=JSON.parse(sessionStorage.getItem("staffKey")),N=Object(p.useQuery)(T,{variables:{id:F},skip:!F}),P=N.loading,x=N.data;Object(r.useEffect)((function(){x&&c(x.getStation)}),[x]);var M=function(e){var t=Object(V.a)(D);return t.reduce((function(a,n,r){return r>e?(t.splice(1),a):a+"/"+n}),"")};return F&&n&&!P?i.a.createElement(i.a.Fragment,null,$&&i.a.createElement(yt.a,null,D.map((function(e,t){return 0===t?"":i.a.createElement(r.Fragment,{key:t},i.a.createElement(St.a,{active:t===D.length-1,as:t<D.length-1?o.b:"",to:M(t)},2===t&&n.location,4===t&&"costumers"===D[t-1].toLowerCase()&&n.costumers.filter((function(t){return t.id===e}))[0]&&n.costumers.filter((function(t){return t.id===e}))[0].name,2!==t&&4!==t&&e),t<D.length-1&&i.a.createElement(Ct.a,null))}))),i.a.createElement(pa,{station:n,activeItem:u,setActiveItem:d,setActiveCostumer:S}," "),"BasicInfo"===u&&i.a.createElement(b.a,{padded:!0},i.a.createElement(b.a.Row,{columns:"4"},i.a.createElement(b.a.Column,null,i.a.createElement(h.a,{as:"h4"},"Address:",i.a.createElement(h.a.Subheader,null,n.address.street,i.a.createElement("br",null),n.address.postcode,n.address.city,i.a.createElement("br",null),n.address.country," ",i.a.createElement(jt.a,{name:n.address.country.toLowerCase()})))),i.a.createElement(b.a.Column,null,i.a.createElement(h.a,{as:"h4"},"Contact:",i.a.createElement(h.a.Subheader,null,i.a.createElement("strong",null,"Email: ")," ",n.email,i.a.createElement("br",null),i.a.createElement("strong",null,"Phone: "),n.phone.reduce((function(e,t){return e+" / "+t}))))),i.a.createElement(b.a.Column,null,i.a.createElement(h.a,{as:"h4"},"Shifts:",n.shifts.map((function(e,t){return i.a.createElement(h.a.Subheader,{key:t}," ",e.name," ",i.a.createElement("strong",null," Starts at: ")," ",e.startTime,i.a.createElement("br",null))}))))),i.a.createElement(b.a.Row,null,i.a.createElement(b.a.Column,null,i.a.createElement(h.a,{as:"h4"},"Current Staffs:"),i.a.createElement(ye.a,{collapsing:!0},i.a.createElement(ye.a.Header,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.HeaderCell,null," Name "),i.a.createElement(ye.a.HeaderCell,null," Last Active At:  "))),i.a.createElement(ye.a.Body,null,n.staffList.length>0&&n.staffList.map((function(e,t){return i.a.createElement(ye.a.Row,{key:t},i.a.createElement(ye.a.Cell,null,$&&$.permission.staff.view?i.a.createElement(o.b,{to:"/Manage/AllStaffs/".concat(e.id,"/Profile")},e.name):e.name),i.a.createElement(ye.a.Cell,null,He(e.lastActive.activeAt)))}))))))),"Procedures"===u&&i.a.createElement(h.a,{as:"h5"}," This Station Procedure feature is not Implemented yet, will be implemanted soon ...",i.a.createElement(h.a.Subheader,null,"After this implemetation, one will be able to add/ view / search all the station related procedure such as 'Garbage Disposal , Hanger Booking , Supplies Delivery ...' on this section")),"Costumers"===u&&!(R.costumerId||y)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(wt.a.Group,null,n.costumers&&n.costumers.map((function(e){return i.a.createElement(wt.a,{key:e.id,link:!0,raised:!0,onClick:function(){$?I.push("".concat(A.pathname,"/").concat(e.id)):S(e.id)}},i.a.createElement(wt.a.Content,{textAlign:"center",header:e.name}),i.a.createElement(wt.a.Content,{textAlign:"center"},e.contract?e.contract+" Contract":""),i.a.createElement(wt.a.Content,{textAlign:"center",extra:!0},i.a.createElement(h.a,{as:"h5"}," ",i.a.createElement(fe.a,{name:"plane"})," Total Aircrafts: ",e.aircrafts.length)))}))),$&&($.permission.admin||$.permission.station.edit.map((function(e){return e._id})).includes(F))&&i.a.createElement(v.a,{basic:!0,compact:!0},i.a.createElement(g.a,{primary:!0,icon:!0,onClick:function(){return k(!0)}},i.a.createElement(fe.a,{name:"add circle"})," Add More"),w&&i.a.createElement(ca,{open:w,setOpen:k,station:n}))),"Costumers"===u&&(R.costumerId||y)&&i.a.createElement(ia,{costumerId:y}),"Settings"===u&&i.a.createElement(fa,{data:n})):i.a.createElement(v.a,{basic:!0},i.a.createElement(le.a,{active:!0},"Loading Station"))},ga=function(e){var t=e.setFilter,a=new Date,n=JSON.parse(sessionStorage.getItem("staffKey")),c=JSON.parse(sessionStorage.getItem("stationKey")),l=Object(r.useState)("week"),o=Object(f.a)(l,2),s=o[0],m=o[1],u=Object(r.useState)(_e(a)),d=Object(f.a)(u,2),g=d[0],b=d[1],h=Object(r.useState)(c?[c.id]:[]),O=Object(f.a)(h,2),v=O[0],y=O[1],S=Object(r.useState)(n&&n.permission.station.edit.map((function(e,t){return{key:t,value:e._id,text:e.location}}))),C=Object(f.a)(S,2),j=C[0],w=C[1],T=Object(p.useQuery)(k,{skip:!(n&&n.permission.admin)}),I=T.loading,A=T.data;return Object(r.useEffect)((function(){if(A&&A.allStations){var e=A.allStations.map((function(e,t){return{key:t,value:e.id,text:e.location}}));w(e)}}),[A]),Object(r.useEffect)((function(){t({stations:v,filterBy:s,number:g})}),[s,g,v]),i.a.createElement(E.a,null,i.a.createElement(E.a.Group,null,n&&(n.permission.station.edit.length||n.permission.admin)&&i.a.createElement(E.a.Field,null,i.a.createElement(ea.a,{loading:I,selection:!0,multiple:!0,options:j,onChange:function(e,t){var a=t.value;y(a)},placeholder:"Select Station",value:v})),i.a.createElement(E.a.Field,null,i.a.createElement(ea.a,{selection:!0,options:[{key:1,text:"Month",value:"month"},{key:2,text:"Week",value:"week"}],onChange:function(e,t){var n=t.value;m(n),b("month"===n?a.getMonth():_e(a))},value:s})),i.a.createElement(E.a.Field,null,i.a.createElement(ea.a,{compact:"month"!==s,selection:!0,options:"month"===s?ze(4):Ue(4),onChange:function(e,t){var a=t.value;b(a)},value:g}))))},ba=function(e){var t=e.openReport,a=e.setOpenReport,r=Object(p.useLazyQuery)(re),c=Object(f.a)(r,2),l=c[0],o=c[1],s=o.error,m=o.loading,u=o.data;return i.a.createElement(ge.a,{onClose:function(){return a({id:"",open:!1})},onMount:function(){t.id?l({variables:{id:t.id}}):a(Object(n.a)(Object(n.a)({},t),{},{id:"",open:!1}))},open:t.open},s&&i.a.createElement(i.a.Fragment,null,i.a.createElement(ge.a.Content,null," ",i.a.createElement(h.a,{as:"h5"},"Oouch...Something Went Wrong, Please try again")," ")),m&&i.a.createElement(le.a,{active:!0},"Retriving Report"),u&&u.getShiftReport&&i.a.createElement(i.a.Fragment,null,i.a.createElement(ge.a.Header,null,"Shift Report: ",u.getShiftReport.startTime.split(" ")[0]," ",u.getShiftReport.station.location," ",u.getShiftReport.shift," shift"),i.a.createElement(ge.a.Content,null,i.a.createElement(Ce,{reportData:u.getShiftReport}," "))))},ha=function(e){var t=e.filter,a=Object(r.useState)(),c=Object(f.a)(a,2),l=c[0],o=c[1],s=Object(r.useState)({id:"",open:!1}),m=Object(f.a)(s,2),u=m[0],d=m[1],E=Object(n.a)({},t);E.year=Ve(t.filterBy,t.number);var g=Object(p.useQuery)(ie,{variables:E,skip:!(E.stations.length&&E.year&&!isNaN(E.number))}),b=g.error,O=g.data,v=g.loading;return Object(r.useEffect)((function(){var e;O&&(e=Object(n.a)({},O.getReportList),e=Ee.a.groupBy(e,(function(e){return e.startTime.split(" ")[0]})),e=Ee.a.mapValues(e,(function(e){return Ee.a.groupBy(e,(function(e){return e.station.location}))})),o(e))}),[O]),b?i.a.createElement(Y.a,{error:!0},i.a.createElement(h.a,{as:"h5"},"Something Went Wrong, Please try again")):v?i.a.createElement(le.a,{active:!0},"Fetching Reports"):O&&!O.getReportList.length?i.a.createElement(h.a,{as:"h5"}," No reports found"):E.stations.length?i.a.createElement(i.a.Fragment,null,l&&i.a.createElement(ye.a,{compact:!0,celled:!0,striped:!0,structured:!0},i.a.createElement(ye.a.Header,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.HeaderCell,null," Date "),i.a.createElement(ye.a.HeaderCell,{textAlign:"center"}," Station "),i.a.createElement(ye.a.HeaderCell,null," Shift "))),i.a.createElement(ye.a.Body,null,l&&Ee.a.map(l,(function(e,t){return i.a.createElement(r.Fragment,{key:t},Object.entries(e).map((function(e,a){var n=Object(f.a)(e,2),r=n[0],c=n[1];return i.a.createElement(ye.a.Row,{key:r},0===a&&i.a.createElement(ye.a.Cell,{collapsing:!0,rowSpan:Object.keys(l[t]).length},t),i.a.createElement(ye.a.Cell,{textAlign:"center"},r),i.a.createElement(ye.a.Cell,null,i.a.createElement(Xt.a,{horizontal:!0},Ee.a.map(c,(function(e){return i.a.createElement(Xt.a.Item,{as:"a",key:e.id,onClick:function(){d({id:e.id,open:!0})}},e.shift)})))))})))})))),i.a.createElement(ba,{setOpenReport:d,openReport:u})):i.a.createElement(Y.a,null,i.a.createElement(h.a,{textAlign:"center",as:"h5"}," No station selected. Please select a station"))},Oa=function(){var e=Object(r.useState)({slectBy:"",number:"",stations:[]}),t=Object(f.a)(e,2),a=t[0],n=t[1];return i.a.createElement(i.a.Fragment,null,i.a.createElement(ga,{setFilter:n}),i.a.createElement(ha,{filter:a}))},va=function(){var e=Object(s.g)(),t=Object(r.useContext)(je),a=Object(r.useReducer)(we,t),n=Object(f.a)(a,2),c=n[0],l=n[1],o=Object(r.useContext)(G),m=Object(f.a)(o,2)[1];JSON.parse(sessionStorage.getItem("stationKey"))||e.push("/");var u,d=Object(s.i)(),E=d.id,g=d.station,b=Object(r.useState)("lastShiftReport"),y=Object(f.a)(b,2),S=y[0],C=y[1];g&&E&&(u={station:E,flag:"MOST_RECENTLY_COMPLETED"});var j=[Object(p.useQuery)(re,{variables:u,skip:"lastShiftReport"!==S,onError:function(){return m({type:"ADD_NOTIFICATION",payload:{content:A.message,type:"ERROR"}})}}),Object(p.useQuery)(T,{variables:{id:E}})],w=Object(f.a)(j,2),k=w[0],I=k.loading,A=k.error,D=k.data,R=w[1].data;return Object(r.useEffect)((function(){R&&l({type:"INIT_STATION",payload:R.getStation})}),[R]),Object(r.useEffect)((function(){D&&l({type:"ADD_LASTSHIFTREPORT",payload:D.getShiftReport})}),[D]),I?i.a.createElement(le.a,{active:!0},"Fetching Data"):i.a.createElement(i.a.Fragment,null,i.a.createElement(je.Provider,{value:{state:c,dispatch:l}},i.a.createElement(v.a,{basic:!0},i.a.createElement(h.a,{textAlign:"right",color:"blue",floated:"right"},"Shift Reporting System ",i.a.createElement("br",null),i.a.createElement("span",null,i.a.createElement("h5",null," Station: ",R&&R.getStation.location," "))),i.a.createElement(O.a,{src:"\\LogoBig.png",size:"medium"})),i.a.createElement(me,{activeItem:S,setActiveItem:C}),"lastShiftReport"===S&&i.a.createElement(Ce,{reportData:D&&D.getShiftReport}),"browseAllReports"===S&&i.a.createElement(Oa,null),"startNewReport"===S&&i.a.createElement(vt,{setActiveItem:C}),"stationInfo"===S&&i.a.createElement(Ea,{stationId:E})))};function ya(){var e=Object(C.a)(["\n  mutation registerStaff( $registerCode:String!, $username: String!, $password: String!){\n    registerStaff(\n      registerCode: $registerCode\n      username: $username,\n      password:$password,\n    ){\n      status,\n      message\n    }\n  }"]);return ya=function(){return e},e}function Sa(){var e=Object(C.a)(["\n  mutation deleteStaff( $id: String!){\n    staffDelete(\n      id: $id,\n    ){\n      status\n      message\n    }\n  }\n"]);return Sa=function(){return e},e}function Ca(){var e=Object(C.a)(["\n  mutation toggleleStaffStatus( $id: String!, $disabled: Boolean! ){\n    setStaffStatus(\n      id: $id,\n      disabled: $disabled\n      )\n      {\n      status\n      message\n    }\n  }\n"]);return Ca=function(){return e},e}function ja(){var e=Object(C.a)(["\n  mutation addStaff( $name: String!, $email: String!, $contractType: String! , $ contractHours: Int!, $position: String, $idCardCode: String){\n    addStaff(\n      name: $name,\n      email:$email,\n      contractType: $contractType,\n      contractHours: $contractHours,\n      position: $position\n      idCardCode: $idCardCode\n    ){\n      id,\n      name,\n      email,\n      phone\n    }\n  }\n"]);return ja=function(){return e},e}function wa(){var e=Object(C.a)(["\nmutation staffEdit($id:String! $email:String, $phone: String , $contractType: String , $reqHours: Float , $position :String){\n  staffEdit(\n    id: $id,\n    email:$email,\n    phone:$phone,\n    contractType: $contractType,\n    reqHours: $reqHours,\n    position: $position\n  ){\n    id\n    email\n    phone\n    contractType\n    reqHours\n    position\n  }\n}"]);return wa=function(){return e},e}function ka(){var e=Object(C.a)(["\nmutation changePassword ( $id: String!, $password: String!, $newPassword: String! ){\n  changePassword ( \n    id: $id,\n    password: $password,\n    newPassword: $newPassword\n    ){\n      status\n      message\n    }\n}"]);return ka=function(){return e},e}function Ta(){var e=Object(C.a)(["\nmutation resetPasswordReq ($id: String!){\n  resetPasswordReq(\n    id: $id,\n  ){\n    status\n    message\n  }\n}"]);return Ta=function(){return e},e}function Ia(){var e=Object(C.a)(["\nmutation resetRegisterCode ($id: String!){\n  resetRegisterCode(\n    id: $id,\n  ){\n    status\n    message\n  }\n}"]);return Ia=function(){return e},e}function Aa(){var e=Object(C.a)(["\nmutation resetPassword ($resetCode: String!, $password: String!){\n  resetPassword(\n    password: $password,\n    resetCode: $resetCode\n  ){\n    status\n    message\n  }\n}"]);return Aa=function(){return e},e}function Da(){var e=Object(C.a)(["\n  mutation staffLogin($username: String!, $password:String!){\n    staffLogin(username: $username, password: $password) \n  }\n"]);return Da=function(){return e},e}var Ra=Object(p.gql)(Da()),Fa=Object(p.gql)(Aa()),$a=Object(p.gql)(Ia()),Na=Object(p.gql)(Ta()),Pa=Object(p.gql)(ka()),xa=Object(p.gql)(wa()),Ma=Object(p.gql)(ja()),Ha=Object(p.gql)(Ca()),La=Object(p.gql)(Sa()),qa=Object(p.gql)(ya()),_a=function(){var e=Object(r.useContext)(G),t=Object(f.a)(e,2)[1],a=Object(s.g)(),n=Object(r.useState)(""),c=Object(f.a)(n,2),l=c[0],o=c[1],m=Object(r.useState)(""),y=Object(f.a)(m,2),C=y[0],j=y[1],w=Object(p.useMutation)(Ra,{onError:function(e){t({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, Cannot Login",i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}}),k=Object(f.a)(w,2),T=k[0],I=k[1].data;Object(r.useEffect)((function(){if(I){var e=I.staffLogin;sessionStorage.setItem("staffKey",JSON.stringify(e)),a.push("/staff/".concat(e.id))}}),[I]);var A=function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),T({variables:{username:l,password:C}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=JSON.parse(sessionStorage.getItem("staffKey"));return D&&a.push("/staff/".concat(D.id)),i.a.createElement(b.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle"},i.a.createElement(b.a.Column,{style:{maxWidth:450}},i.a.createElement(h.a,{as:"h2",color:"blue",textAlign:"center"},i.a.createElement(O.a,{src:"/LogoMin.png"}),"  Log-in to your account"),i.a.createElement(E.a,{size:"large",style:{textAlign:"left"},onSubmit:A},i.a.createElement(v.a,{stacked:!0},i.a.createElement(E.a.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"username",onChange:function(e,t){var a=t.value;return o(a)}}),i.a.createElement(E.a.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password",type:"password",onChange:function(e,t){var a=t.value;return j(a)}}),i.a.createElement(g.a,{type:"submit",color:"blue",fluid:!0,size:"large"},"Login"))),i.a.createElement(S.a,{horizontal:!0},"Or"),i.a.createElement(v.a,{stacked:!0},i.a.createElement(g.a,{type:"button",content:"Log in to station",size:"large",color:"teal",fluid:!0,onClick:function(){return a.push("/stationLogin")}}))))},Ba=a(114),Ka=a(97),za=a(232),Ua=a(168),Va=a(91),Ya=a(664);function Ja(){var e=Object(C.a)(["\nquery getAllTimeSheets(\n  $staffId: String, $staff: [String] ,$period: String, $from: String , $to: String, $number: Int, $groupBy: String , $year: Int, $stations: [String], $filterStatus: String\n){\n  getAllTimeSheets(\n    staff:$staff,\n    period:$period,\n    from: $from,\n    to:$to ,\n    number:$number ,\n    groupBy:$groupBy,\n    year:$year ,\n    stations:$stations\n    filterStatus: $filterStatus\n    )\n  getStaffName(\n      id: $staffId\n      )\n   \n}"]);return Ja=function(){return e},e}function Qa(){var e=Object(C.a)(["query getTimesheetByUser($staff: String!, $filterDuration: String! ,$number: Int!, $year: Int!){\n  getTimeSheetByUser(\n    staff: $staff,\n     filterDuration: $filterDuration, \n     number: $number, \n     year: $year\n    ) {\n      id\n      startTime\n      status\n      date\n      endTime\n      break\n      remarks{\n        by\n        date\n        edit\n        text\n        title\n      }\n      staff{\n        id\n        name\n        reqHours\n        contractType\n      }\n      shiftReport {\n        shift\n        id\n        station {\n          id\n          location\n        }\n      }\n\n      shift\n      station{\n        id\n        location\n      }\n\n  },\n\n  getStaffName(\n    id: $staff\n    )\n\n}"]);return Qa=function(){return e},e}var Ga=Object(p.gql)(Qa()),Wa=Object(p.gql)(Ja()),Za=function(e){var t=Object(r.useContext)(G),a=Object(f.a)(t,2)[1],c=Object(s.i)(),l=JSON.parse(sessionStorage.getItem("staffKey")),o=Object(p.useQuery)(k,{skip:!1===e.add}),m=o.loading,b=o.data,O=Object(p.useLazyQuery)(ce),y=Object(f.a)(O,2),S=y[0],C=y[1],j=C.loading,w=C.data,T=Object(p.useMutation)(it,{onError:function(t){a({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, Failed to ".concat(e.add?"Add":"Update"," timesheet record "),i.a.createElement("br",null),t.message),type:"ERROR"}}),K()}}),I=Object(f.a)(T,2),A=I[0],D=I[1].loading,R=Object(r.useState)([]),F=Object(f.a)(R,2),$=F[0],N=F[1],P=Object(r.useState)(!1),x=Object(f.a)(P,2),M=x[0],H=x[1],L=function(t){return!(!l.permission.admin&&!l.permission.timesheet.sign.map((function(e){return e._id})).includes(t&&t.id)&&l.id!==e.staffId)};Object(r.useEffect)((function(){if(b&&b.allStations){var e=b.allStations.filter((function(e){return L(e)})).map((function(e,t){return{key:t,value:e.id,text:e.location}}));N(e)}}),[b]);var q=function(e){if(b){var t=b.allStations.filter((function(t){return t.id===e}));if(t&&t[0].shifts)return t[0].shifts.map((function(e,t){return{key:t,value:e.name,text:e.name}}))}},_=function(e,t,a){var n=new Date(qe(e)),r=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())).toISOString();S({variables:{date:r,shift:t,station:a}})},B=function(){var t=Object(d.a)(u.a.mark((function t(r){var l;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l=Object(n.a)(Object(n.a)({},r),{},{break:parseInt(r.break)}),w&&w.getShiftReportByShift&&w.getShiftReportByShift.id&&(l.handover=w.getShiftReportByShift.id),e.add||(l.id=e.id),r.remarks.length>=e.remarks.length&&l.remarks.splice(0,e.remarks.length),A({variables:l,update:function(t,r){e.add&&t.modify({fields:{getTimeSheetByUser:function(e,t){var a=t.readField,n=r.data.addToTimeSheet;return e.some((function(e){return a("id",e)===n.id}))?e:[].concat(Object(V.a)(e),[n])},getAllTimeSheets:function(e){var t=c.period;if(!t)return e;var a=r.data.addToTimeSheet,i=Ee.a.cloneDeep(e),l=((qe(a.endTime)-qe(a.startTime))/36e5-(a.break||0)/60).toFixed(1);if(i[t]||(i[t]={}),!i[t][a.staff.name])return i[t][a.staff.name]={},i[t][a.staff.name].station=Object(ke.a)({},a.station.location,1),i[t][a.staff.name].itemsPending=1,i[t][a.staff.name].totHours=l,i;var o=i[t][a.staff.name].station;return i[t][a.staff.name]=Object(n.a)(Object(n.a)({},i[t][a.staff.name]),{},{itemsPending:i[t][a.staff.name].itemsPending+1,totHours:(parseFloat(i[t][a.staff.name].totHours)+parseFloat(l)).toFixed(1),station:Object(n.a)(Object(n.a)({},o),{},Object(ke.a)({},a.station.location,o[a.station.location]+1))}),i}},broadcast:!1}),a({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Success, ".concat(e.add?"Added":"Updated"," timesheet record for ").concat(l.startTime.split(" ")[0])),type:"SUCCESS"}}),K()}});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),K=function(){e.setOpen(!1),H(!1)},z=e.add?"Adding Work Time Record to Date ".concat(He(Date.parse(e.date)).split(" ")[0]):"Editing Work Time Record to Date ".concat(He(Date.parse(e.date)).split(" ")[0]);return i.a.createElement(ge.a,{closeIcon:!0,closeOnEscape:!1,closeOnDimmerClick:!1,open:e.open,onClose:function(){return K()},onOpen:function(){return e.setOpen(!0)}},i.a.createElement(ge.a.Header,null,z," "),i.a.createElement(ge.a.Content,null,D&&i.a.createElement(Ie.a,{active:!0},i.a.createElement(le.a,null)),i.a.createElement(Te.c,{initialValues:function(){var t={startTime:e.startTime,endTime:e.endTime,break:e.break||30,remarks:e.remarks||[]};return e.add&&(t.staff=e.staffId,t.startTime=He(new Date(e.date).setHours(0)),t.endTime=new Date(e.date).setHours(8)>Date.now()?He(qe(Date.now())):He(new Date(e.date).setHours(8)),t.station="",t.shift="",t.remarks=[{title:"Manually Entered to TimeSheet",date:He(Date.now()),by:l.name}]),t}(),validate:function(t){var a={};return a=Object(n.a)(Object(n.a)({},a),Je(t.startTime,t.endTime,e.date)),Ee.a.isEmpty(a)&&function(t){if(!e.add){var a=0===e.remarks.length?0:e.remarks.length,n=Object(V.a)(t.remarks);t.startTime===e.startTime&&t.endTime===e.endTime||((!n[a]||n[a]&&"Edited"!==n[a].title)&&n.splice(a,0,{title:"Edited",date:He(Date.now()),by:l.name,edit:{}}),t.startTime!==e.startTime&&(n[a].edit.startTime="".concat(e.startTime," to  ").concat(t.startTime)),t.endTime!==e.endTime&&(n[a].edit.endTime="".concat(e.endTime," to  ").concat(t.endTime)),t.remarks=n),t.startTime===e.startTime&&n[a]&&t.remarks[a].edit&&delete n[a].edit.startTime,t.endTime===e.endTime&&n[a]&&t.remarks[a].edit&&delete n[a].edit.endTime,n[a]&&n[a].edit&&Ee.a.isEmpty(n[a].edit)&&n.splice(a,1),t.remarks=n}}(t),a},onSubmit:function(e){if(e.remarks.length&&!e.remarks[e.remarks.length-1].title&&!e.remarks[e.remarks.length-1].text){var t=Object(V.a)(e.remarks);t.splice(e.remarks.length-1,1),e.remarks=t}e.remarks.length&&!e.remarks[e.remarks.length-1].title&&e.remarks[e.remarks.length-1].text&&(e.remarks[e.remarks.length-1].title="Remark Added"),B(e)}},(function(t){var a=t.values,n=t.handleSubmit,r=t.setFieldValue,c=t.dirty;return i.a.createElement(E.a,{size:"large",style:{marginBottom:"5rem"},onSubmit:n},i.a.createElement(E.a.Group,null,i.a.createElement($e,{label:"Start Time",readOnly:!e.add&&("APPROVED"===e.status||!L(e.station)),dateTimeFormat:"DD-MM-YYYY HH:mm",name:"startTime",maxDate:Le(Date.now(),30,"m","sub"),minDate:He(Date.parse(e.date))}),i.a.createElement($e,{label:"End Time",readOnly:!e.add&&!("APPROVED"===e.status||!L(e.station)),dateTimeFormat:"DD-MM-YYYY HH:mm",name:"endTime",maxDate:Date.now()<qe(a.endTime)?He(Date.now()):Le(a.startTime,20,"h","add"),minDate:Le(a.startTime,20,"m","add")}),i.a.createElement(ta,{inputlabel:"Break",readOnly:!e.add&&("APPROVED"===e.status||!L(e.station)),label:"Minutes ",labelPosition:"right corner",name:"break",type:"number",min:"0"})),e.add&&i.a.createElement(E.a.Group,null,i.a.createElement(na,{label:" Select Station",loading:m,name:"station",placholder:"Select Station",search:!0,selection:!0,options:$,onChange:function(e,t){var n=t.value;r("station",n);var i=function(e,t){if(b){var a=b.allStations.filter((function(e){return e.id===t}));if(a&&a[0].shifts){var n=new Date(qe(e));return a[0].shifts.reduce((function(e,t){var a=t.startTime.split(":"),r=new Date(n);r.setHours(a[0]),r.setMinutes(a[1]);var i=(n-r)/36e5;return i>e.diff&&e.diff<0||i>0&&i<e.diff?{name:t.name,diff:i}:e}),{name:"",diff:-24}).name}}}(a.startTime,n);r("shift",i),_(a.startTime,i,n)}}),i.a.createElement(na,{label:" Select Shift",disabled:!a.station,name:"shift",placholder:"Select Shift",search:!0,selection:!0,options:a.station?q(a.station):[],onChange:function(e,t){var n=t.value;r("shift",n),_(a.startTime,n,a.station)}})),j&&i.a.createElement(v.a,{secondary:!0,loading:!0},"Verifying ",a.shift," Shift"),a.shift&&w&&w.getShiftReportByShift&&i.a.createElement(v.a,{clearing:!0,secondary:!0},i.a.createElement(h.a,{as:"h3"},i.a.createElement(fe.a,{name:"check circle",color:"green"})," Verified"),i.a.createElement(h.a,{floated:"left",as:"h5"},w.getShiftReportByShift.station.location," ",a.shift," Shift ",w.getShiftReportByShift.startTime.split(" ")[0],i.a.createElement(h.a.Subheader,null,i.a.createElement("strong",null," Shift Start : ")," ",w.getShiftReportByShift.startTime,i.a.createElement("strong",null," Shift End : ")," ",w.getShiftReportByShift.endTime," ")),i.a.createElement(g.a,{type:"button",floated:"right",onClick:function(){return e.openReport({id:w.getShiftReportByShift.id,open:!0})}}," View Shift Report")),a.shift&&w&&!w.getShiftReportByShift&&i.a.createElement(Y.a,{warning:!0,visible:!0,header:"Selected shift is not reported",content:"Adding to record to unreported shift will not be reflected on any shift reports thus cannot be verified. This may result on work time not being approved"}),i.a.createElement("label",null,i.a.createElement("strong",null,"Remarks")),i.a.createElement(Te.b,{name:"remarks"},(function(t){var n=t.push,r=t.remove;return i.a.createElement(i.a.Fragment,null,a.remarks&&a.remarks.length>0&&a.remarks.map((function(e,t){return i.a.createElement(aa,{key:t,name:"remarks.".concat(t),value:e})})),"APPROVED"!==e.status&&(e.add||L(e.station))&&i.a.createElement(E.a.Button,{type:"button",onClick:function(e){e.preventDefault(),M?(r(a.remarks.length-1),H(!1)):(a.remarks.length>0&&"Clearification Requested"===a.remarks[a.remarks.length-1].title?n({title:"Add Clearification",date:He(Date.now()),by:l.name,text:""}):n({title:"",date:He(Date.now()),by:l.name,text:""}),H(!0))}},!M&&a.remarks.length>0&&"Clearification Requested"===a.remarks[a.remarks.length-1].title?"Add Clearification":M?"Remove Remark":"Add Remark"))})),"APPROVED"!==e.status&&c&&L(e.station)&&i.a.createElement(g.a,{type:"submit",floated:"right",positive:!0},"Save"),i.a.createElement(g.a,{type:"button",floated:"right",negative:!0,onClick:function(){return K()}},"Cancel"))}))))},Xa=function(e){var t=e.timeSheet,a=e.rowSpan,c=e.openReport,l=e.index,o=e.date,m=e.staffId,u=JSON.parse(sessionStorage.getItem("staffKey")),d=Object(s.i)(),b=u.permission&&u.permission.timesheet,O=t.startTime,y=t.endTime,S=t.shiftReport&&t.shiftReport.station.location||t.station&&t.station.location,C=t.shiftReport&&t.shiftReport.shift||t.shift,j=t.break,w=t.total,k=t.overTime,T=t.remarks||[],I=Object(r.useState)(!1),A=Object(f.a)(I,2),D=A[0],R=A[1],F=Object(r.useState)(!1),$=Object(f.a)(F,2),N=$[0],P=$[1],x=Object(r.useState)(!1),M=Object(f.a)(x,2),H=M[0],L=M[1],q=Object(r.useState)(!1),_=Object(f.a)(q,2),B=_[0],K=_[1],z=Object(r.useState)(""),U=Object(f.a)(z,2),V=U[0],J=U[1],Q=Object(p.useMutation)(ct),G=Object(f.a)(Q,2),W=G[0],Z=G[1].loading,X=Object(p.useMutation)(lt),ee=Object(f.a)(X,2),te=ee[0],ae=ee[1].loading,ne=Object(p.useMutation)(ot),re=Object(f.a)(ne,2),ie=re[0],ce=re[1].loading;m||(m=u.id);var le=!t.id.toString().match(/^[0-9a-fA-F]{24}$/);return i.a.createElement(ye.a.Row,{key:t.id,negative:!function(){var e=new Date(o).getDay();return 0!==e&&6!==e}()},0===l&&i.a.createElement(ye.a.Cell,{collapsing:!0,rowSpan:a},o.split("T")[0]),i.a.createElement(ye.a.Cell,null," ",S," "),i.a.createElement(ye.a.Cell,{onClick:function(e){e.preventDefault(),c({id:t.shiftReport&&t.shiftReport.id,open:!0})}},t.shiftReport&&t.shiftReport.id?i.a.createElement("a",{href:""}," ",C," "):C?"".concat(C," "):"","  "),i.a.createElement(ye.a.Cell,null,O&&O.split(" ")[1]),i.a.createElement(ye.a.Cell,null," ",y&&y.split(" ")[1]," "),i.a.createElement(ye.a.Cell,null," ",j," "),i.a.createElement(ye.a.Cell,null," ",w||""," "),0===l&&i.a.createElement(ye.a.Cell,{rowSpan:a}," ",k||""," "),i.a.createElement(ye.a.Cell,null," ","PENDING_APPROVAL"===t.status?"No":"APPROVED"===t.status?"Yes":t.status," "),i.a.createElement(ye.a.Cell,null,T&&T.length>0&&i.a.createElement(i.a.Fragment,null,"".concat(T[T.length-1].title," ").concat(T[T.length-1].date.split(" ")[0]),"  ",i.a.createElement("br",null),"  ",T[T.length-1].text,"`  ",i.a.createElement("br",null),i.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),R(!0)}},"See all"))),i.a.createElement(ye.a.Cell,null,i.a.createElement(v.a,{loading:Z||ae||ce,disabled:Z||ae||ce,size:"tiny",basic:!0,style:{width:"max-content",display:"inline-block"}},le&&b&&(u.permission.admin||b.sign.length>0||u.id===m)&&i.a.createElement(g.a,{icon:"add",size:"mini",circular:!0,onClick:function(){P(!0),R(!0)}}),!le&&i.a.createElement(i.a.Fragment,null,"APPROVED"!==t.status&&(u.permission.admin||0!==b.sign.filter((function(e){return t.station&&e._id===t.station.id})).length||u.id===m)&&i.a.createElement(Ya.a,{trigger:i.a.createElement(g.a,{icon:"edit",size:"mini",circular:!0,onClick:function(){P(!1),R(!0)}}),content:"Edit Timesheet",position:"bottom center"}),(u.permission.admin||0!==b.sign.filter((function(e){return t.station&&e._id===t.station.id})).length)&&u.id!==m&&i.a.createElement(i.a.Fragment,null,i.a.createElement(Ya.a,{trigger:i.a.createElement(g.a,{color:"APPROVED"===t.status?"green":"grey",icon:"check",size:"mini",circular:!0,onClick:function(){W({variables:{id:t.id,status:"APPROVED"===t.status?"":"APPROVED"},update:function(e,a){e.modify({fields:{getAllTimeSheets:function(e,n){n.readField;var r=d.period;if(!r)return e;var i=a.data.approveTimeSheet.status,c=Ee.a.cloneDeep(e);return c[r][t.staff.id].itemsPending="APPROVED"===i?c[r][t.staff.id].itemsPending-1:c[r][t.staff.id].itemsPending+1,c}}})}})}}),content:"APPROVED"===t.status?"Undo Approve":"Approve",position:"bottom center"}),"APPROVED"!==t.status&&i.a.createElement(Ya.a,{size:"huge",wide:"very",style:{width:"100%"},trigger:i.a.createElement(g.a,{color:"blue",icon:"talk",size:"mini",circular:!0}),onOpen:function(){return K(!0)},onClose:function(){return K(!1)},open:B,content:i.a.createElement(E.a,{onSubmit:function(){!function(){var e={id:t.id,clearify:V};ie({variables:e})}(),K(!1)}},i.a.createElement(h.a,{as:"h5"},"Request Clearification "),i.a.createElement(E.a.TextArea,{value:V,onChange:function(e,t){var a=t.value;return J(a)}}),i.a.createElement(E.a.Button,{floated:"right",type:"submit",primary:!0}," Send")),on:"click",position:"bottom right"})),"APPROVED"!==t.status&&(u.permission.admin||0!==b.sign.filter((function(e){return t.station&&e._id===t.station.id})).length||u.id===m)&&i.a.createElement(Ya.a,{as:Y.a,warning:!0,trigger:i.a.createElement(g.a,{color:"red",icon:"trash",size:"mini",circular:!0}),content:i.a.createElement(i.a.Fragment,null,i.a.createElement(Y.a.Header,null,"Are you sure, you want to remove this record?"),i.a.createElement("p",null," Action is non reversible and will remove all the instances of this record from the system."),i.a.createElement(g.a,{fluid:!0,color:"red",icon:"trash",content:"Confirm",onClick:function(){t.id,te({variables:{id:t.id},update:function(e,a){a.data.deleteTimeSheet&&"SUCCESS"===a.data.deleteTimeSheet.status&&(e.evict({id:"TimeSheet:".concat(t.id)}),e.modify({fields:{getAllTimeSheets:function(e,a){a.readField;var r=d.period;if(!r)return e;var i=Ee.a.cloneDeep(e),c=i[r][t.staff.name].totHours-w;if(0===c)return delete i[r],i;var l=i[r][t.staff.name].station;return i[r][t.staff.name]=Object(n.a)(Object(n.a)({},i[r][t.staff.name]),{},{itemsPending:i[r][t.staff.name].itemsPending-1,totHours:c,station:Object(n.a)(Object(n.a)({},l),{},Object(ke.a)({},t.station.location,l[t.station.location]-1))}),i}}}))}}),L(!1)}})),on:"click",onOpen:function(){return L(!0)},onClose:function(){return L(!1)},open:H,position:"bottom center"})))),D&&i.a.createElement(Za,{staffId:m,id:t.id,openReport:c,date:o,open:D,station:t.station,status:t.status,setOpen:R,startTime:O,endTime:y,break:j,add:N,remarks:T}))},en=function(e){var t,a=e.startDate,c=e.endDate,l=e.data,o=e.staffId,s=e.title,m=Object(r.useState)({id:"",open:!1}),u=Object(f.a)(m,2),d=u[0],p=u[1],E=Object(V.a)(new Array(Math.ceil((c-a)/864e5)+1)).map((function(e,t){var n=t;return new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()+n)).toISOString()})),g=Ee.a.zipObject(E,E.map((function(e,t){return[{id:t}]}))),b=0,O=0;if(l){var v=(t=Ee.a.groupBy(l.getTimeSheetByUser,"date"))&&Ee.a.mapValues(t,(function(e,t){var a=0,r=0;return(e=e.map((function(e,t){var i=60*e.break*1e3,c=((qe(e.endTime)-qe(e.startTime)-i)/36e5).toFixed(1);return e=Object(n.a)(Object(n.a)({},e),{},{total:parseFloat(c)}),a+=parseFloat(c),r=(a-e.staff.reqHours).toFixed(1),e})))[0]=Object(n.a)(Object(n.a)({},e[0]),{},{overTime:r}),O+=parseFloat(r),b+=a,e}));t=Object(n.a)(Object(n.a)({},g),v)}var y={position:"sticky",top:"0",zIndex:1};return i.a.createElement(i.a.Fragment,null,s&&i.a.createElement(h.a,{as:"h5",floated:"right"},s),i.a.createElement(ye.a,{celled:!0,striped:!0,structured:!0,textAlign:"center"},i.a.createElement(ye.a.Header,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.HeaderCell,{style:y}," Date "),i.a.createElement(ye.a.HeaderCell,{style:y}," Station "),i.a.createElement(ye.a.HeaderCell,{style:y}," Shift "),i.a.createElement(ye.a.HeaderCell,{style:y}," Start Time "),i.a.createElement(ye.a.HeaderCell,{style:y}," End Time "),i.a.createElement(ye.a.HeaderCell,{style:y}," Break (Mins) "),i.a.createElement(ye.a.HeaderCell,{style:y}," Total (Hrs) "),i.a.createElement(ye.a.HeaderCell,{style:y}," OverTime "),i.a.createElement(ye.a.HeaderCell,{style:y}," Approved "),i.a.createElement(ye.a.HeaderCell,{style:y}," Remarks "),i.a.createElement(ye.a.HeaderCell,{style:y}," Actions"))),i.a.createElement(ye.a.Body,null,t&&Ee.a.map(t,(function(e,t){return i.a.createElement(r.Fragment,{key:t},e.map((function(a,n){return i.a.createElement(Xa,{staffId:o,date:t,index:n,key:a.id,openReport:p,timeSheet:a,rowSpan:e.length})})))}))),i.a.createElement(ye.a.Footer,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.HeaderCell,{colSpan:"6"},"Total"),i.a.createElement(ye.a.HeaderCell,null," ",b.toFixed(1)," "),i.a.createElement(ye.a.HeaderCell,null," ",O.toFixed(1)," "),i.a.createElement(ye.a.HeaderCell,{colSpan:"3"})))),i.a.createElement(ba,{setOpenReport:p,openReport:d}))},tn=function(e){var t=e.staffId,a=e.setStaffName,n=e.period,c=e.selected,l=(e.selectedYear,e.timesheetOnly),o=JSON.parse(sessionStorage.getItem("staffKey")),s=Object(r.useState)(n||"week"),m=Object(f.a)(s,2),u=m[0],d=m[1],b=new Date,O=Object(r.useState)(c||_e(b)),y=Object(f.a)(O,2),S=y[0],C=y[1],j={staff:t||o.id,filterDuration:u,number:S,year:Ve(u,S)},w=Object(p.useQuery)(Ga,{variables:j}),k=w.error,T=w.loading,I=w.data;Object(r.useEffect)((function(){I&&a(I.getStaffName)}),[I]);var A=function(){var e,t=Ve(u,S);return e="month"===u?new Date(t,S,1):Be(S,t),e=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))}(),D=function(){var e,t=Ve(u,S);if("month"===u)e=new Date(t,S+1,0);else{var a=Be(S,t);e=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()+6))}return e>=b&&(e=new Date(Date.UTC(b.getFullYear(),b.getMonth(),b.getDate()))),e}();if(T)return i.a.createElement(le.a,{active:!0},"Fetching timesheets");if(k)return i.a.createElement(h.a,{as:"h5"},"Something Went Wrong, Please try again");var R=function(){var e=!1;return I&&I.getTimeSheetByUser&&I.getTimeSheetByUser.length>0&&(e=!I.getTimeSheetByUser.some((function(e){return"APPROVED"!==e.status}))),e};return i.a.createElement(i.a.Fragment,null,i.a.createElement(v.a,{basic:!0,style:{marginBottom:"20em"}},i.a.createElement(E.a,null,!l&&i.a.createElement(i.a.Fragment,null,i.a.createElement("label",null," Select by: "),i.a.createElement(E.a.Group,null,i.a.createElement(E.a.Field,null,i.a.createElement(ea.a,{selection:!0,options:[{key:1,text:"Month",value:"month"},{key:2,text:"Week",value:"week"}],onChange:function(e,t){var a=t.value;d(a),C("month"===a?b.getMonth():_e(b))},value:u})),i.a.createElement(E.a.Field,null,i.a.createElement(ea.a,{compact:"month"!==u,selection:!0,options:"month"===u?ze(4):Ue(4),onChange:function(e,t){var a=t.value;C(a)},value:S})))),i.a.createElement(en,{staffId:t,startDate:A,endDate:D,data:I,title:"Timesheet ".concat("month"===u?Ke(S):"Week ".concat(S,",")," ").concat(Ve(u,S)," ")}),t===o.id&&i.a.createElement(v.a,{basic:!0,clearing:!0},i.a.createElement(Ya.a,{trigger:i.a.createElement("span",{floated:"right"},i.a.createElement(g.a,{floated:"right",disabled:!R(),type:"button",color:"blue"}," Submit to Payroll")),disabled:R(),content:" All records should be approved for submission"})))))};function an(){var e=Object(C.a)(["\n  query verifyUsername( $username: String!){\n    verifyUsername(   \n      username: $username,\n    ){\n      status,\n      message\n    }\n  }"]);return an=function(){return e},e}function nn(){var e=Object(C.a)(["\n  query{ allStaff {\n    id\n    name\n    email\n    phone\n    disabled\n    lastActive{\n      station{\n        location\n      }\n      activeAt\n    }\n  }}\n"]);return nn=function(){return e},e}function rn(){var e=Object(C.a)(["\n  query allStaffMinimal ($minimal: Boolean = true) { \n    allStaff (minimal :$minimal){\n    id\n    name   \n  }}\n"]);return rn=function(){return e},e}function cn(){var e=Object(C.a)(["\nquery fetchStaff($registerCode:String,){\n    getStaff(\n      registerCode: $registerCode\n      ){ \n    name\n    }\n  }\n"]);return cn=function(){return e},e}function ln(){var e=Object(C.a)(["\nquery fetchStaff($id:String, $registerCode:String, $withPermission: Boolean!){\n    getStaff(\n      id: $id\n      registerCode: $registerCode\n      ){ \n    id     \n    name\n    idCardCode\n    currentStation{\n      location\n    }\n    email\n    position\n    contractType\n    lastActive{\n      station{\n        location\n      }\n      activeAt\n    }\n    username\n    resetCode\n    phone\n    reqHours\n    registerCode\n    permission  @include(if: $withPermission ) {\n      id\n      station\n      timesheet\n      staff\n      admin\n    }\n    }\n  }\n"]);return ln=function(){return e},e}var on=Object(p.gql)(ln()),sn=Object(p.gql)(cn()),mn=Object(p.gql)(rn()),un=Object(p.gql)(nn()),dn=Object(p.gql)(an()),fn=function(e){var t=e.setFilter,a=JSON.parse(sessionStorage.getItem("staffKey")),n=Object(s.i)(),c=new Date,l=Object(r.useState)([]),o=Object(f.a)(l,2),m=o[0],u=o[1],d=Object(r.useState)("date"),g=Object(f.a)(d,2),b=g[0],h=g[1],O=Object(r.useState)([]),y=Object(f.a)(O,2),S=y[0],C=y[1],j=Object(r.useState)("week"),w=Object(f.a)(j,2),T=w[0],I=w[1],A=Object(r.useState)(He(new Date(c.getFullYear(),c.getMonth()-3,1)).split(" ")[0]),D=Object(f.a)(A,2),R=D[0],F=D[1],$=Object(r.useState)(He(c).split(" ")[0]),N=Object(f.a)($,2),P=N[0],x=N[1],M=Object(r.useState)(_e(c)),H=Object(f.a)(M,2),L=H[0],q=H[1],_=Object(s.h)().pathname.split("/")[2],B=Object(r.useState)(""),K=Object(f.a)(B,2),z=K[0],U=K[1],V=Object(r.useState)([]),Y=Object(f.a)(V,2),J=Y[0],Q=Y[1],G=Object(r.useState)(a.permission.timesheet.view.map((function(e,t){return{key:t,value:e._id,text:e.location}}))),W=Object(f.a)(G,2),Z=W[0],X=W[1],ee=Object(p.useLazyQuery)(k),te=Object(f.a)(ee,2),ae=te[0],ne=te[1],re=ne.loading,ie=ne.data;Object(r.useEffect)((function(){if(ie&&ie.allStations){var e=ie.allStations.map((function(e,t){return{key:t,value:e.id,text:e.location}}));X(e)}}),[ie]);var ce=Object(p.useLazyQuery)(mn),le=Object(f.a)(ce,2),oe=le[0],se=le[1],me=se.loading,ue=se.data;return Object(r.useEffect)((function(){if(ue){var e=ue.allStaff.map((function(e,t){return{key:t,value:e.id,text:e.name}}));Q(e)}}),[ue]),Object(r.useEffect)((function(){t({staff:m,period:b,stations:S,groupBy:T,from:R,to:P,number:L,filterStatus:z})}),[m,b,S,T,R,P,L,z,t]),Object(r.useEffect)((function(){n.staffId?u([n.staffId]):u([]),"mypage"===_.toLowerCase()&&u([a.id])}),[_,a.id,n]),i.a.createElement(i.a.Fragment,null,i.a.createElement(v.a,{size:"tiny",clearing:!0},i.a.createElement(de.a,{size:"mini",attached:"top left"},"Filters"),i.a.createElement(E.a,{size:"mini"},i.a.createElement(Et.a,{widths:"equal"},!n.staffId&&"mypage"!==_.toLowerCase()&&i.a.createElement(E.a.Dropdown,{label:"Staff",value:m,loading:me,options:J,selection:!0,multiple:!0,clearable:!0,placeholder:"All",onFocus:function(){return oe()},onChange:function(e,t){var a=t.value;return u(a)}}),i.a.createElement(E.a.Dropdown,{label:"Period",value:b,options:[{key:1,value:"date",text:"Date"},{key:2,value:"week",text:"Week"},{key:3,value:"month",text:"Month"}],placeholder:"All",selection:!0,clearable:!0,compact:!0,onChange:function(e,t){var a=t.value;"week"===a&&q(_e(c)),"month"===a&&q(c.getMonth()),h(a)}}),"date"===b&&i.a.createElement(i.a.Fragment,null,i.a.createElement(De.DateInput,{value:R,label:"From",dateFormat:"DD-MM-YYYY",onChange:function(e,t){var a=t.value;F(a)}}),i.a.createElement(De.DateInput,{value:P,label:"To",dateFormat:"DD-MM-YYYY",onChange:function(e,t){var a=t.value;x(a)}})),("week"===b||"month"===b)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(E.a.Dropdown,{value:L,label:"Select ".concat(b),options:"week"===b?Ue():ze(),selection:!0,compact:!0,onChange:function(e,t){var a=t.value;q(a)}})),i.a.createElement(E.a.Dropdown,{label:"Group By",value:T,options:[{key:1,value:"week",text:"Week"},{key:2,value:"month",text:"Month"}],onChange:function(e,t){var a=t.value;return I(a)},selection:!0,compact:!0}),i.a.createElement(E.a.Dropdown,{label:"Station",loading:re,options:Z,value:S,selection:!0,multiple:!0,clearable:!0,placeholder:"All",onFocus:function(){a.permission.admin&&ae()},onChange:function(e,t){var a=t.value;return C(a)}}),i.a.createElement(E.a.Dropdown,{label:"Status",value:z,options:[{key:1,value:"approved",text:"Approved"},{key:2,value:"pending",text:"Pending"}],onChange:function(e,t){var a=t.value;return U(a)},placeholder:"All",clearable:!0,selection:!0,compact:!0})))))},pn=function(e){var t=e.setStaffName,a=new Date,c=Object(s.i)(),l=Object(s.h)(),m=l.pathname.split("/")[2],u=Object(r.useState)({staff:[],period:"date",from:He(new Date(a.getFullYear(),a.getMonth()-3,1)).split(" ")[0],to:He(a).split(" ")[0],number:_e(a),groupBy:"week",stations:[],filterStatus:""}),d=Object(f.a)(u,2),E=d[0],g=d[1],b=Object(n.a)({},E);1===E.staff.length&&(b.staffId=E.staff[0]),b.year=Ve(E.period,E.number);var h,O=Object(p.useQuery)(Wa,{variables:b,skip:c.period}),v=O.loading,y=O.data;if(Object(r.useEffect)((function(){y&&t(y.getStaffName)}),[y,t]),c.period){var S,C,j,w=c.period.split(" ");return"Week"===w[0]?(S="week",C=w[1],j=w[2]):(S="month",h=w[0],C=["january","february","march","april","may","june","july","august","september","october","november","december"].findIndex((function(e){return e===h.toLowerCase()})),j=w[1]),i.a.createElement(tn,{period:S,selected:parseInt(C),selectedYear:parseInt(j),staffId:c.staffId,setStaffName:t,timesheetOnly:!0})}return i.a.createElement(i.a.Fragment,null,i.a.createElement(fn,{setFilter:g}),i.a.createElement(le.a,{active:v}," Loading TimeSheet Overview"),i.a.createElement(ye.a,null,i.a.createElement(Ba.a,null,i.a.createElement(Ka.a,null,!c.staffId&&"mypage"!==m.toLowerCase()&&i.a.createElement(za.a,null,"Staff Name"),i.a.createElement(za.a,null,"Period"),i.a.createElement(za.a,null," Stations"),i.a.createElement(za.a,null," Total Hours"),i.a.createElement(za.a,null," Status"))),i.a.createElement(Ua.a,null,y&&y.getAllTimeSheets&&Ee.a.map(y.getAllTimeSheets,(function(e,t){return Ee.a.map(e,(function(e,a){return i.a.createElement(Ka.a,{key:a,positive:!e.itemsPending,negative:!!e.itemsPending},!c.staffId&&"mypage"!==m.toLowerCase()&&i.a.createElement(Va.a,null,i.a.createElement(o.b,{to:"/Manage/ManageTimesheets/".concat(a),onClick:function(){}}," ",e.name)),i.a.createElement(Va.a,null,t),i.a.createElement(Va.a,null,Ee.a.reduce(e.station,(function(e,t,a){return 0!==t?(e?e+"/":"")+a:e}),"")),i.a.createElement(Va.a,null,e.totHours),i.a.createElement(Va.a,null,i.a.createElement(o.b,{to:"".concat(l.pathname,"/").concat(c.staffId?"":"".concat(a,"/")).concat(t),onClick:function(){}},e.itemsPending?"".concat(e.itemsPending,"  Items Pending"):"All Approved"," ")))}))})))))},En=function(e){var t=e.setName,a=Object(s.i)(),n=Object(r.useState)(""),c=Object(f.a)(n,2),l=c[0],m=c[1];return i.a.createElement(i.a.Fragment,null,!(a.page&&"timesheetsoverview"===a.page.toLowerCase())&&i.a.createElement(i.a.Fragment,null,i.a.createElement(yt.a,null,a.staffId&&i.a.createElement(i.a.Fragment,null,i.a.createElement(yt.a.Section,{link:!0,as:o.b,to:"/Manage/ManageTimesheets"}," Manage Timesheets "),i.a.createElement(yt.a.Divider,null),i.a.createElement(yt.a.Section,{active:!a.period,as:a.period?o.b:"",to:"/Manage/ManageTimesheets/".concat(a.staffId)}," ",l," ")),a.period&&i.a.createElement(i.a.Fragment,null,i.a.createElement(yt.a.Divider,{icon:"right chevron"}),i.a.createElement(yt.a.Section,{active:!0},a.period.replace("_"," "))))),i.a.createElement(pn,{setStaffName:t||m}))},gn=function(){var e=Object(r.useContext)(G),t=Object(f.a)(e,2)[1],a=Object(s.i)(),n=Object(s.g)();sessionStorage.removeItem("staffKey");var c=Object(p.useMutation)(Fa,{onCompleted:function(){t({type:"ADD_NOTIFICATION",payload:{content:"Success, password reset. you can now login",type:"SUCCESS"}}),n.push("/staffLogin")},onError:function(e){t({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, password reset failed ",i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}}),l=Object(f.a)(c,2),o=l[0],m=l[1].loading;if(!a.resetCode)return i.a.createElement(h.a,null,"Reset code mising or invalid");return i.a.createElement(v.a,{basic:!0,loading:m},i.a.createElement(Te.c,{initialValues:{password:"",confirmPassword:""},validate:function(e){var t={};return e.password&&""!==e.password.trim()||(t.password="Password is required"),e.password!==e.confirmPassword&&(t.confirmPassword="New password and confirm password must match"),t},onSubmit:function(e){o({variables:{resetCode:a.resetCode,password:e.password}})}},(function(e){var t=e.handleSubmit,a=e.dirty,n=e.errors;return i.a.createElement(E.a,{style:{marginBottom:"5rem"},onSubmit:t},i.a.createElement(v.a,null,i.a.createElement(Pe,{name:"password",label:"New Password",type:"password",width:"8"}),i.a.createElement(Pe,{name:"confirmPassword",label:"Confirm Password",type:"password",width:"8"}),i.a.createElement(g.a,{disabled:!(a&&Ee.a.isEmpty(n)),type:"submit",style:{marginTop:"1rem"},positive:!0},"Reset")))})))};function bn(){var e=Object(C.a)(["\nmutation changePermission( $id: String! $staff: JsonObject, $station: JsonObject, $timesheet: JsonObject ,$admin: Boolean){\n  changePermission(\n    id: $id\n    staff: $staff\n    station: $station\n    timesheet: $timesheet\n    admin: $admin\n    ){\n      id\n      staff\n      station\n      timesheet\n      admin\n    }\n}"]);return bn=function(){return e},e}var hn=Object(p.gql)(bn()),On=function(e){var t=e.permissions,a=Object(r.useContext)(G),c=Object(f.a)(a,2)[1],l=Object(r.useState)([]),o=Object(f.a)(l,2),s=o[0],m=o[1],u=JSON.parse(sessionStorage.getItem("staffKey")),d=Object(r.useState)(t&&t.admin||!1),b=Object(f.a)(d,2),O=b[0],v=b[1],y=u.permission.admin,S=Object(p.useMutation)(hn,{onCompleted:function(){c({type:"ADD_NOTIFICATION",payload:{content:"Success, permission changed",type:"SUCCESS"}})},onError:function(e){c({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to change permission",i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}}),C=Object(f.a)(S,2),j=C[0],w=C[1].loading,T=function(e){return e&&e.map((function(e){return e?e._id:null}))},I=function(e){if(y)return!0;if("object"===typeof e){if(!Ee.a.isEmpty(e))return!0}else if(e)return!0;return!1},A=Ee.a.mapValues(t,(function(e,t){if("object"===typeof e){var a=Object(n.a)({},e);return"station"===t&&(a.edit=T(a.edit)),"timesheet"===t&&(a.view=T(a.view),a.sign=T(a.sign)),a}return e})),D=Object(p.useQuery)(k,{skip:!y}),R=D.loading,F=D.data;Object(r.useEffect)((function(){if(F){var e=F.allStations.map((function(e,t){return{key:t,value:e.id,text:e.location}}));m(e)}}),[F]);var $=function(e){if(y)return s;var t=[];switch(e){case"station.edit":return u.permission.station.edit.length&&(t=u.permission.station.edit.map((function(e,t){return{key:t,value:e._id,text:e.location}}))),t;case"timesheet.view":return u.permission.timesheet.view.length&&(t=u.permission.timesheet.view.map((function(e,t){return{key:t,value:e._id,text:e.location}}))),t;case"timesheet.sign":return u.permission.timesheet.sign.length&&(t=u.permission.timesheet.sign.map((function(e,t){return{key:t,value:e._id,text:e.location}}))),t;default:return t}},N=s.map((function(e){return e.value}));return i.a.createElement(Te.c,{enableReinitialize:!0,initialValues:Object(n.a)({},A),onSubmit:function(e){var a=Object(n.a)({},e);a.admin?j({variables:{admin:!0,id:t.id}}):(Ee.a.reduce(e,(function(e,n,r){A[r]&&Ee.a.isEqual(A[r],a[r])&&delete a[r],A[r]&&!Ee.a.isEqual(A[r],a[r])&&Ee.a.reduce(a[r],(function(e,n,i){Ee.a.isEqual(t[r][i],a[r][i])&&delete a[r][i]}),{})}),{}),j({variables:Object(n.a)(Object(n.a)({},a),{},{id:t.id})}))}},(function(e){var a=e.setFieldValue,n=e.values,c=e.handleSubmit,l=e.dirty,o=e.resetForm;return i.a.createElement(i.a.Fragment,null,i.a.createElement(h.a,{as:"h3"},"Permission"),i.a.createElement(Fe.a,{label:"Administrator (All Permissions for all stations)",disabled:!y,toggle:!0,name:"admin",checked:n.admin,onChange:function(e,t){var n=t.checked;a("admin",n),v(n),n&&(a("station.edit",N),a("station.add",!0),a("timesheet.view",N),a("timesheet.sign",N),a("staff.edit",!0),a("staff.add",!0),a("staff.view",!0))}}),l&&i.a.createElement(Y.a,{warning:!0},"Remember to save the changes for changes to take effect "),i.a.createElement(E.a,{as:"table",loading:R||w,className:"ui celled padded table",onSubmit:c},i.a.createElement(ye.a.Header,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.HeaderCell,null,"Scope"),i.a.createElement(ye.a.HeaderCell,null,"Edit"),i.a.createElement(ye.a.HeaderCell,null,"Add"),i.a.createElement(ye.a.HeaderCell,null,"View"),i.a.createElement(ye.a.HeaderCell,null,"Sign"))),i.a.createElement(Ua.a,null,Ee.a.map(t,(function(e,t){return i.a.createElement(r.Fragment,{key:t},"__typename"!==t&&"id"!==t&&"admin"!==t&&i.a.createElement(Te.b,null,(function(){return i.a.createElement(ye.a.Row,{key:t},i.a.createElement(ye.a.Cell,null,t.toUpperCase()),i.a.createElement(ye.a.Cell,null,"station"===t&&i.a.createElement(na,{multiple:!0,selection:!0,options:$("".concat(t,".edit")),placeholder:"Add Stations",disabled:R||!I(u.permission[t].edit)||O,loading:R,name:"".concat(t,".edit")}),"staff"===t?i.a.createElement(Fe.a,{disabled:!I(u.permission[t].edit)||O,toggle:!0,name:"".concat(t,".edit"),checked:n["".concat(t)].edit,onChange:function(e,n){var r=n.checked;a("".concat(t,".edit"),r),r&&a("".concat(t,".view"),r)}}):""),i.a.createElement(ye.a.Cell,null,"timesheet"!==t&&i.a.createElement(Fe.a,{toggle:!0,disabled:!I(u.permission[t].add)||O,name:"".concat(t,".add"),checked:n["".concat(t)].add,onChange:function(e,n){var r=n.checked;a("".concat(t,".add"),r),"staff"===t&&r&&a("".concat(t,".view"),!0)}})),i.a.createElement(ye.a.Cell,null,"staff"===t&&i.a.createElement(Fe.a,{disabled:!I(u.permission[t].view)||O,toggle:!0,name:"".concat(t,".view"),checked:n["".concat(t)].view,onChange:function(e,r){var i=r.checked;n.staff.edit||n.staff.add?a("".concat(t,".view"),!0):a("".concat(t,".view"),i)}}),"timesheet"===t&&i.a.createElement(na,{multiple:!0,selection:!0,options:$("".concat(t,".view")),placeholder:"Add Stations",disabled:R||!I(u.permission[t].view)||O,loading:R,name:"".concat(t,".view"),onChange:function(e,r){var i=r.value,c=Object(V.a)(new Set([].concat(Object(V.a)(n.timesheet.sign),Object(V.a)(i))));a("".concat(t,".view"),c)}})),i.a.createElement(ye.a.Cell,{disabled:"timesheet"!==t},"timesheet"===t&&i.a.createElement(na,{multiple:!0,selection:!0,name:"".concat(t,".sign"),options:$("".concat(t,".sign")),placeholder:"Add Stations",disabled:R||!I(u.permission[t].sign)||O,onChange:function(e,r){var i=r.value;a("".concat(t,".sign"),i);var c=Object(V.a)(new Set([].concat(Object(V.a)(n.timesheet.view),Object(V.a)(i))));a("".concat(t,".view"),c)},loading:R})))})))})))),l&&i.a.createElement(i.a.Fragment,null,i.a.createElement(g.a,{positive:!0,onClick:function(){return c()}}," Save Changes"),i.a.createElement(g.a,{negative:!0,onClick:function(){return o()}}," Discard Changes")))}))},vn=function(e){var t=Object(r.useContext)(G),a=Object(f.a)(t,2)[1],c=Object(p.useMutation)(xa,{onCompleted:function(){a({type:"ADD_NOTIFICATION",payload:{content:"Success, staff information saved",type:"SUCCESS"}}),e.setOpen(!1)},onError:function(t){a({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to save edited information",i.a.createElement("br",null)," ",t.message),type:"ERROR"}}),e.setOpen(!1)}}),l=Object(f.a)(c,2),o=l[0],s=l[1].loading,m={email:e.email,phone:e.phone||"",contractType:e.contractType,contractHours:e.reqHours,position:e.position||""};return i.a.createElement(ge.a,{closeIcon:!0,closeOnEscape:!1,closeOnDimmerClick:!1,open:e.open,onClose:function(){return e.setOpen(!1)},onOpen:function(){return e.setOpen(!0)}},i.a.createElement(ma.a,null,"Editing Staff ",e.name," "),i.a.createElement(ua.a,null,s&&i.a.createElement(Ie.a,{active:!0},i.a.createElement(le.a,null)),i.a.createElement(Te.c,{initialValues:m,validate:function(e){var t={};return/[a-z]/i.test(e.phone)&&(t.phone="Phone number cannot contain alphabets "),e.phone&&e.phone.length<8&&(t.phone="Phone number should be at least 8 charter long "),Ge(e.email)&&(t.email="Invalid Email"),isNaN(e.contractHours)&&(t.contractHours="Contract Hours must be number"),t},onSubmit:function(t){var a=Ee.a.omitBy(t,(function(e,t){return m[t]===e}));o({variables:Object(n.a)(Object(n.a)({},a),{},{id:e.id})})}},(function(e){e.values;var t=e.handleSubmit,a=(e.setFieldValue,e.dirty);e.errors;return i.a.createElement(E.a,{style:{marginBottom:"5rem"},onSubmit:t},i.a.createElement(b.a,null,i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"email",label:"Email",type:"email"})),i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"phone",label:"Phone",type:"tel"})),i.a.createElement(b.a.Row,null,i.a.createElement(na,{name:"contractType",labeled:!0,label:"Contract",selection:!0,options:[{key:1,value:"Contractor",text:"Contractor"},{key:2,value:"Employee",text:"Employee"}]})),i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"contractHours",label:"Required Hours per day"})),i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"position",label:"Position"}))),a&&i.a.createElement(g.a,{type:"submit",floated:"right",positive:!0},"Save"))}))))},yn=function(e){var t=Object(r.useContext)(G),a=Object(f.a)(t,2)[1],n=Object(p.useMutation)(Pa,{onCompleted:function(){a({type:"ADD_NOTIFICATION",payload:{content:"Success, password cahanged",type:"SUCCESS"}}),e.setOpen(!1)},onError:function(t){a({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to change password",i.a.createElement("br",null)," ",t.message),type:"ERROR"}}),e.setOpen(!1)}}),c=Object(f.a)(n,2),l=c[0],o=c[1].loading;return i.a.createElement(ge.a,{closeIcon:!0,closeOnEscape:!1,closeOnDimmerClick:!1,open:e.open,onClose:function(){return e.setOpen(!1)},onOpen:function(){return e.setOpen(!0)}},i.a.createElement(ma.a,null,"Password Change"),i.a.createElement(ua.a,null,o&&i.a.createElement(Ie.a,{active:!0},"Updating Password",i.a.createElement(le.a,null)),i.a.createElement(Te.c,{initialValues:{password:"",newPassword:"",confirmPassword:""},validate:function(e){var t={};return e.password||(t.password="Old Password is required"),e.newPassword===e.password&&(t.newPassword="New password cannot be same as old password"),e.newPassword||(t.newPassword="New password cannot be empty"),e.newPassword!==e.confirmPassword&&(t.confirmPassword="New password and confirm password must match"),t},onSubmit:function(t){l({variables:{id:e.id,password:t.password,newPassword:t.newPassword}})}},(function(e){var t=e.handleSubmit,a=e.dirty,n=e.errors;return i.a.createElement(E.a,{style:{marginBottom:"5rem"},onSubmit:t},i.a.createElement(b.a,null,i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"password",label:"Old Password",type:"password"})),i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"newPassword",label:"New Password",type:"password"})),i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"confirmPassword",label:"Confirm Password",type:"password"}))),a&&Ee.a.isEmpty(n)&&i.a.createElement(g.a,{type:"submit",style:{marginTop:"1rem"},positive:!0},"Change Password"))}))))},Sn=function(e){var t=Object(r.useContext)(G),a=Object(f.a)(t,2)[1],n=Object(s.i)(),c=Object(r.useState)({open:!1,handleCancel:function(){},handleConfirm:function(){}}),l=Object(f.a)(c,2),o=l[0],m=l[1],u=Object(r.useState)(!1),d=Object(f.a)(u,2),E=d[0],O=d[1],v=JSON.parse(sessionStorage.getItem("staffKey")),y=v.id;y=e.id?e.id:n.staffId?n.staffId:v.id;var S=Object(p.useQuery)(on,{variables:{id:y,withPermission:e.staffCanEdit||!1}}),C=S.loading,j=S.error,w=S.data,k=Object(p.useMutation)(Na,{onCompleted:function(){a({type:"ADD_NOTIFICATION",payload:{content:"Success, password reset code sent to users email",type:"SUCCESS"}})},onError:function(e){a({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to reset",i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}}),T=Object(f.a)(k,2),I=T[0],A=T[1].loading,D=Object(p.useMutation)($a,{onCompleted:function(){a({type:"ADD_NOTIFICATION",payload:{content:"Success, new register code sent to users email",type:"SUCCESS"}})},onError:function(e){a({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to send new register code",i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}}),R=Object(f.a)(D,2),F=R[0],$=R[1].loading,N=function(){m({open:!1,handleCancel:function(){},handleConfirm:function(){}})};if(Object(r.useEffect)((function(){w&&e.setStaffName&&e.setStaffName(w.getStaff.name)}),[w,e]),C)return i.a.createElement(le.a,{active:!0},"Fetching User Profile");if(j)return i.a.createElement(h.a,{as:"h5"},"Something Went Wrong, Please try again");var P=!w||!w.getStaff.registerCode;return i.a.createElement(i.a.Fragment,null,i.a.createElement(b.a,{columns:"3",style:{marginTop:"1rem"}},i.a.createElement(b.a.Row,{centered:!0,textAlign:"center"},i.a.createElement(b.a.Column,null,i.a.createElement(h.a,{as:"h4"},"Basic Info"),i.a.createElement(ye.a,{compact:!0},i.a.createElement(Ua.a,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.Cell,{width:"8"}," ",i.a.createElement("strong",null," Id Card Saved ")," "),i.a.createElement(ye.a.Cell,{width:"7"},w.getStaff.idCardCode?i.a.createElement(fe.a,{name:"checkmark",color:"green"}):i.a.createElement(fe.a,{name:"cancel",color:"red"}))),i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.Cell,{width:"8"}," ",i.a.createElement("strong",null," Registration Complete")," "),i.a.createElement(ye.a.Cell,{width:"7"},P?i.a.createElement(fe.a,{name:"checkmark",color:"green"}):i.a.createElement(fe.a,{name:"cancel",color:"red"}))),i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.Cell,null," ",i.a.createElement("strong",null," Email ")," "),i.a.createElement(ye.a.Cell,null," ",w.getStaff.email)),i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.Cell,null," ",i.a.createElement("strong",null," Phone ")," "),i.a.createElement(ye.a.Cell,null," ",w.getStaff.phone)),P&&i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.Cell,null," ",i.a.createElement("strong",null," Username ")," "),i.a.createElement(ye.a.Cell,null," ",w.getStaff.username))),i.a.createElement(ye.a.Footer,null,(e.staffCanEdit||v.id===w.getStaff.id)&&i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.HeaderCell,null,i.a.createElement(g.a,{primary:!0,size:"small"},"Scan Id Card")),i.a.createElement(ye.a.HeaderCell,null,i.a.createElement(g.a,{loading:A||$,disabled:A||$,primary:!0,size:"small",onClick:function(e,t){switch(t.children){case"Change Password":O(!0);break;case"Reset Password":m({open:!0,handleConfirm:function(){I({variables:{id:w.getStaff.id}}),N()},handleCancel:function(){N()},content:"Confirm Reset Password",header:"Confirm"});break;case"Resend Register Link":m({open:!0,handleConfirm:function(){F({variables:{id:w.getStaff.id}}),N()},handleCancel:function(){N()},content:"Confirm Reset Registration Link",header:"Confirm"})}}},P?v.id===w.getStaff.id?"Change Password":e.staffCanEdit?"Reset Password":"":"Resend Register Link")))))),i.a.createElement(b.a.Column,null,i.a.createElement(h.a,{as:"h4"},"Contract"),i.a.createElement(ye.a,{compact:!0},i.a.createElement(Ua.a,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.Cell,null," ",i.a.createElement("strong",null," Type ")," "),i.a.createElement(ye.a.Cell,null,w&&w.getStaff.contractType)),i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.Cell,null," ",i.a.createElement("strong",null," Required Hrs/Day ")," "),i.a.createElement(ye.a.Cell,null," ",w&&w.getStaff.reqHours)),i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.Cell,null," ",i.a.createElement("strong",null," Position ")," "),i.a.createElement(ye.a.Cell,null," ",w&&w.getStaff.position))))),i.a.createElement(b.a.Column,null,i.a.createElement(h.a,{as:"h4"},"Last Active"),i.a.createElement(ye.a,{compact:!0},i.a.createElement(Ua.a,null,i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.Cell,null," ",i.a.createElement("strong",null," Station ")," "),i.a.createElement(ye.a.Cell,null,w&&w.getStaff.lastActive&&w.getStaff.lastActive.station&&w.getStaff.lastActive.station.location)),i.a.createElement(ye.a.Row,null,i.a.createElement(ye.a.Cell,null," ",i.a.createElement("strong",null," Active at ")," "),i.a.createElement(ye.a.Cell,null," ",w&&w.getStaff.lastActive&&He(w.getStaff.lastActive.activeAt))))))),e.staffCanEdit&&i.a.createElement(b.a.Row,null," ",i.a.createElement(b.a.Column,null,i.a.createElement(On,{permissions:w.getStaff.permission})," "),"  "),i.a.createElement(vn,{open:e.editModelOpen,setOpen:e.setEditModelOpen,email:w.getStaff.email,phone:w.getStaff.phone,contractType:w.getStaff.contractType,reqHours:w.getStaff.reqHours,position:w.getStaff.position,id:w.getStaff.id}),i.a.createElement(yn,{open:E,setOpen:O,id:w.getStaff.id}),i.a.createElement(oe.a,{open:o.open,content:o.content,header:o.header,onCancel:o.handleCancel,onConfirm:o.handleConfirm})))},Cn=function(e){var t=e.setName,a=Object(r.useContext)(G),n=Object(f.a)(a,2)[1],c=Object(s.i)(),l=Object(s.g)(),o=Object(p.useQuery)(sn,{variables:{registerCode:c.registerCode},skip:!c.registerCode}),m=o.loading,u=o.error,d=o.data,b=Object(p.useMutation)(qa,{onError:function(e){n({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, failed to register",i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}}),O=Object(f.a)(b,2),y=O[0],S=O[1],C=S.loading,j=S.data,w=Object(p.useLazyQuery)(dn),k=Object(f.a)(w,2),T=k[0],I=k[1],A=I.loading,D=I.data,R=Object(r.useState)({verified:!1}),F=Object(f.a)(R,2),$=F[0],N=F[1];if(Object(r.useEffect)((function(){D&&N({verified:!0,status:D.verifyUsername.status})}),[D]),!c.registerCode)return i.a.createElement(h.a,null,"Registration code mising or invalid");if(j&&"SUCCESS"===j.registerStaff.status)return l.push("/staff"),null;d&&d.getStaff&&t(d.getStaff.name);return i.a.createElement(v.a,{basic:!0,loading:m||C},i.a.createElement(Y.a,{success:d&&d.getStaff,error:!!u},i.a.createElement(Y.a.Header,null,d&&d.getStaff&&"Please complete registration by setting  your username and password",u&&u.message,d&&!d.getStaff&&"Registration code Invalid")),d&&d.getStaff&&i.a.createElement(Te.c,{initialValues:{password:"",username:"",confirmPassword:""},validate:function(e){var t={};return e.username&&""!==e.username.trim()||(t.username="Username is required"),e.username&&e.username.length<4&&(t.username="Username should be at least 4 character long"),e.password&&""!==e.password.trim()||(t.password="Password is required"),e.password!==e.confirmPassword&&(t.confirmPassword="New password and confirm password must match"),t},onSubmit:function(e){y({variables:{registerCode:c.registerCode,password:e.password,username:e.username}})}},(function(e){e.values;var t=e.handleChange,a=e.handleSubmit,n=e.dirty,r=e.errors,c=e.handleBlur,l=e.touched;return i.a.createElement(E.a,{style:{marginBottom:"5rem"},onSubmit:a},i.a.createElement(E.a.Field,{width:"8"},i.a.createElement(Re.a,{loading:A,icon:i.a.createElement(fe.a,{name:void 0===r.username&&$.verified?"SUCCESS"===$.status?"check circle":"cancel":"",color:$.verified&&"SUCCESS"===$.status?"green":"red"}),onBlur:c,name:"username",label:"Username",width:"8",onChange:function(e){t(e);var a=e.currentTarget.value;T({variables:{username:a}})}}),(r.username&&l.username||void 0===r.username&&$.verified&&"SUCCESS"!==$.status)&&i.a.createElement(de.a,{pointing:!0,prompt:!0},r.username||"Selected username already taken, please select new username")),i.a.createElement(Pe,{name:"password",label:"Password",type:"password",width:"8"}),i.a.createElement(Pe,{name:"confirmPassword",label:"Confirm Password",type:"password",width:"8"}),i.a.createElement(g.a,{disabled:!(n&&Ee.a.isEmpty(r)&&$.verified&&"SUCCESS"===$.status),type:"submit",style:{marginTop:"1rem"},positive:!0},"Register"))})))},jn=function(e){var t=e.staffName,a=e.activeItem,n=e.setActiveItem,r=JSON.parse(sessionStorage.getItem("staffKey")),c=Object(s.g)();if("register"===Object(s.h)().pathname.split("/")[1].toLowerCase())return i.a.createElement(se.a,{inverted:!0,color:"blue",stackable:!0},i.a.createElement(se.a.Item,{position:"right"},"Welcome ",t));var l=function(e,t){var a=t.name;n(a),["Profile","Timesheets","TimesheetsOverview"].includes(a)?c.push("/staff/".concat(r.id,"/").concat(a)):c.push("/".concat(a))},o=[];0===o.length&&(o.push("Timesheets"),o.push("TimesheetsOverview"),o.push("Profile"));return i.a.createElement(se.a,{inverted:!0,color:"blue",stackable:!0},o.map((function(e){return i.a.createElement(se.a.Item,{key:e,name:e,active:a===e,onClick:l})})),i.a.createElement(se.a.Menu,{position:"right"},i.a.createElement(ea.a,{item:!0,text:"Welcome ".concat(r.name)},i.a.createElement(ea.a.Menu,null,i.a.createElement(ea.a.Item,{text:"Logout",onClick:function(){return sessionStorage.removeItem("staffKey"),void c.push("/staffLogin")}})))))},wn=function(e){var t=e.activeItem,a=e.setActiveItem,n=e.staffName,c=e.staffId,l=e.staffCanEdit,o=e.setEditModelOpen,m=JSON.parse(sessionStorage.getItem("staffKey")).permission,u=Object(s.g)();return Object(r.useEffect)((function(){return a(""),function(){return a("")}}),[a]),i.a.createElement(se.a,{pointing:!0,secondary:!0},i.a.createElement(se.a.Item,{header:!0},n),i.a.createElement(se.a.Item,{position:"right",name:"Profile",active:"Profile"===t,onClick:function(){a("Profile"),u.push("/Manage/AllStaffs/".concat(c,"/Profile"))}}),!0===(m.admin||m.timesheet.view.length||m.timesheet.sign.length)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(se.a.Item,{name:"Timesheets",active:"Timesheets"===t,onClick:function(){a("Timesheets"),u.push("/Manage/AllStaffs/".concat(c,"/Timesheets"))}}),i.a.createElement(se.a.Item,{name:"TimesheetsOverview",active:"TimesheetsOverview"===t,onClick:function(){a("TimesheetsOverview"),u.push("/Manage/AllStaffs/".concat(c,"/TimesheetsOverview"))}})),l&&i.a.createElement(se.a.Item,{position:"right",name:"EditProfile",icon:"edit",onClick:function(e){e.preventDefault(),u.push("Profile"),a("Profile"),o(!0)}}))},kn=function(e){var t=e.name,a=e.id,n=Object(s.i)(),c=n&&n.staffId,l=n&&n.page,m=Object(s.h)(),u=Object(s.g)(),d=Object(r.useState)(t),p=Object(f.a)(d,2),E=p[0],g=p[1],b=Object(r.useState)(!1),h=Object(f.a)(b,2),O=h[0],v=h[1],y=Object(r.useState)(l),S=Object(f.a)(y,2),C=S[0],j=S[1],w=Object(r.useState)(l||"Profile"),k=Object(f.a)(w,2),T=k[0],I=k[1],A=JSON.parse(sessionStorage.getItem("staffKey")),D=Object(r.useState)(A&&A.name),R=Object(f.a)(D,2),F=R[0],$=R[1],N=m.pathname.split("/");if(Object(r.useEffect)((function(){j(l),I(l)}),[l]),"register"===N[1].toLowerCase())return l="register",i.a.createElement(i.a.Fragment,null,i.a.createElement(jn,{staffName:F,activeItem:C,setActiveItem:j}),i.a.createElement(Cn,{setName:$}));if("reset-password"===N[1].toLowerCase())return l="reset-password",i.a.createElement(i.a.Fragment,null,i.a.createElement(gn,null));if(!A&&"register"!==l&&"reset-password"!==l)return u.push("/staffLogin"),null;var P=A.id!==c&&void 0!==c&&(A.permission&&A.permission.staff.edit||A.permission.admin||!1),x=A.permission&&(A.permission.admin||A.permission.station.edit.length>0||A.permission.station.add||A.permission.staff.view||A.permission.staff.add||A.permission.staff.edit||A.permission.timesheet.view.length>0);c=a||(n.staffId?n.staffId:A.id);var M=N[1];A.id!==c&&"staff"===M.toLocaleLowerCase()&&u.push("/Manage/AllStaffs/".concat(c,"/").concat(C)),x&&"manage"!==M.toLowerCase()&&u.push("/Manage/MyPage/Profile");return i.a.createElement(i.a.Fragment,null,!x&&i.a.createElement(jn,{staffName:F,activeItem:C,setActiveItem:j}),i.a.createElement(i.a.Fragment,null,i.a.createElement(yt.a,null,A.id===c&&i.a.createElement(i.a.Fragment,null,i.a.createElement(St.a,null," My Page "),i.a.createElement(Ct.a,null)),A.id!==c&&i.a.createElement(i.a.Fragment,null,i.a.createElement(St.a,{link:!0,as:o.b,to:"/".concat(M,"/").concat(N[2])}," ",N[2]," "),i.a.createElement(Ct.a,null),i.a.createElement(St.a,{link:!0,as:o.b,to:"/".concat(M,"/").concat(N[2],"/").concat(N[3],"/Profile")}," ",E||c," "),i.a.createElement(Ct.a,null)),l&&"timesheetsoverview"===l.toLowerCase()&&n.period?i.a.createElement(i.a.Fragment,null,i.a.createElement(St.a,{link:!0,as:o.b,to:N.reduce((function(e,t,a){return a===N.length-1||""===t?e:e+"/"+t})),active:!0}," ",T," "),i.a.createElement(Ct.a,{icon:"right chevron"}),i.a.createElement(St.a,{active:!0},n.period.replace("_"," "))):i.a.createElement(St.a,{active:!0}," ",T," "))),c!==A.id&&i.a.createElement(wn,{activeItem:T,setActiveItem:I,staffName:E,staffId:c,staffCanEdit:P,setEditModelOpen:v}),(T&&"timesheets"===T.toLocaleLowerCase()||C&&"timesheets"===C.toLowerCase())&&i.a.createElement(i.a.Fragment,null,i.a.createElement(tn,{staffId:c,setStaffName:g})),(T&&"profile"===T.toLocaleLowerCase()||C&&"profile"===C.toLowerCase())&&i.a.createElement(i.a.Fragment,null,i.a.createElement(Sn,{id:c,staffCanEdit:P,setEditModelOpen:v,editModelOpen:O,setStaffName:g})),(T&&"timesheetsoverview"===T.toLocaleLowerCase()||C&&"timesheetsoverview"===C.toLowerCase())&&i.a.createElement(i.a.Fragment,null,i.a.createElement(En,{setName:g})))},Tn=function(e){var t=Object(r.useContext)(G),a=Object(f.a)(t,2)[1],n=Object(p.useMutation)(Ma),c=Object(f.a)(n,2),l=c[0],o=c[1].loading;return i.a.createElement(Te.c,{initialValues:{name:"",email:"",phone:"",contractType:"",contractHours:"",position:""},onSubmit:function(t){!function(t){l({variables:t,update:function(e,t){e.modify({fields:{allStaff:function(e,a){var n=a.readField,r=t.data.addStaff;return e.some((function(e){return n("id",e)===r.id}))?e:[].concat(Object(V.a)(e),[r])}}})}}).then((function(){return a({type:"ADD_NOTIFICATION",payload:{content:"Success, new staff ".concat(t.name," created"),type:"SUCCESS"}})}),(function(e){return a({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, Cannot create new staff  staff ".concat(t.name),i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}),e.setOpen(!1))}(t)},validate:function(e){var t={};return t.name=We(e.name),t.email=Ge(e.email),Ee.a.isEmpty(t.name)&&delete t.name,Ee.a.isEmpty(t.email)&&delete t.email,e.contractType||(t.contractType="Please select contract type"),e.contractHours&&parseFloat(e.contractHours)||(t.contractHours="Invalid contract hours"),t}},(function(t){var a=t.handleSubmit,n=t.setFieldValue,r=t.dirty;return i.a.createElement(ge.a,{closeIcon:!0,closeOnEscape:!1,closeOnDimmerClick:!1,open:e.open,onClose:function(){return e.setOpen(!1)},onOpen:function(){return e.setOpen(!0)}},i.a.createElement(ma.a,null,"New Staff ",e.name," "),i.a.createElement(ua.a,null,o&&i.a.createElement(Ie.a,{active:!0},i.a.createElement(le.a,null)),i.a.createElement(E.a,{style:{marginBottom:"5rem"}},i.a.createElement(b.a,null,i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"name",label:"Name",type:"text",width:"8"})),i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"email",label:"Email",type:"email",width:"8"})),i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"phone",label:"Phone",type:"tel",width:"8"})),i.a.createElement(b.a.Row,null,i.a.createElement(na,{name:"contractType",labeled:!0,label:"Contract",selection:!0,width:"8",options:[{key:1,value:"Contractor",text:"Contractor"},{key:2,value:"Employee",text:"Employee"}],onChange:function(e,t){var a=t.value;n("contractType",a)}})),i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"contractHours",label:"Required Hours per day",type:"number",width:"8"})),i.a.createElement(b.a.Row,null,i.a.createElement(Pe,{name:"position",label:"Position",width:"8"})),i.a.createElement(b.a.Row,null,i.a.createElement(E.a.Button,{icon:!0,type:"button",labelPosition:"right",primary:!0},i.a.createElement(fe.a,{size:"big",name:"barcode"}),"Link Id card"))))),i.a.createElement(ge.a.Actions,null,i.a.createElement(g.a,{negative:!0,onClick:function(){return e.setOpen(!1)}},"Cancel"),r&&i.a.createElement(g.a,{positive:!0,onClick:function(){return a()}},"Save")))}))},In=function(){var e=Object(r.useContext)(G),t=Object(f.a)(e,2)[1],a=Object(p.useQuery)(un),n=a.loading,c=a.error,l=a.data,s=Object(r.useState)([]),m=Object(f.a)(s,2),u=m[0],d=m[1],b=Object(r.useState)(!1),h=Object(f.a)(b,2),O=h[0],y=h[1],S=Object(r.useState)(!1),C=Object(f.a)(S,2),j=C[0],w=C[1],k=Object(r.useState)({title:"",fn:function(){}}),T=Object(f.a)(k,2),I=T[0],A=T[1],D=JSON.parse(sessionStorage.getItem("staffKey")),R=Object(p.useMutation)(La),F=Object(f.a)(R,1)[0],$=Object(p.useMutation)(Ha),N=Object(f.a)($,1)[0];return Object(r.useEffect)((function(){l&&l.allStaff&&d(l.allStaff)}),[l]),n?i.a.createElement(le.a,{active:!0},"Fetching Staffs"):c?i.a.createElement(v.a,null,"Something Went Wrong "):i.a.createElement(i.a.Fragment,null,!0===(D.permission.staff.add||D.permission.admin)&&i.a.createElement(g.a,{primary:!0,icon:!0,onClick:function(){return y(!0)}},"Add New Staff ",i.a.createElement(fe.a,{name:"add"}," ")),u&&i.a.createElement(Re.a,{icon:"search",placeholder:"Search...",onChange:function(e,t){var a=t.value;if(a&&""!==a.trim()){var n=u.filter((function(e){return e.name.includes(a)}));d(n)}else d(l.allStaff)}}),i.a.createElement(ye.a,null,i.a.createElement(ye.a.Header,null,i.a.createElement(Ka.a,null,i.a.createElement(za.a,null," Name "),i.a.createElement(za.a,null," Email "),i.a.createElement(za.a,null," Phone "),i.a.createElement(za.a,null," Last Active "),i.a.createElement(za.a,null," Recent Station "),i.a.createElement(za.a,null," Account Status "),i.a.createElement(za.a,null," "))),i.a.createElement(ye.a.Body,null,u&&u.map((function(e){return i.a.createElement(ye.a.Row,{key:e.id},i.a.createElement(Va.a,null,i.a.createElement(o.b,{to:"/Manage/AllStaffs/".concat(e.id,"/Profile")},e.name)),i.a.createElement(Va.a,null,e.email),i.a.createElement(Va.a,null,e.phone),i.a.createElement(Va.a,null,e.lastActive&&He(e.lastActive.activeAt)),i.a.createElement(Va.a,null,e.lastActive&&e.lastActive.station&&e.lastActive.station.location),i.a.createElement(Va.a,null,e.accountStatus,i.a.createElement(E.a.Field,null,i.a.createElement(Fe.a,{checked:!e.disabled,toggle:!0,label:e.disabled?"Disabled":"Active",disabled:e.id===D.id||!(D.permission.staff.edit||D.permission.admin),onChange:function(a,n){var r,c,l,o=n.checked;r=e.id,c=e.name,N({variables:{id:r,disabled:!(l=o)},update:function(e){e.modify({id:"Staff:".concat(r),fields:{disabled:function(){return!l}}})}}).then((function(){return t({type:"ADD_NOTIFICATION",payload:{content:"Success, staff ".concat(c," set ").concat(l?"active":"disabled"),type:"SUCCESS"}})}),(function(e){return t({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, Cannot toggle status for  staff ".concat(c),i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}))}}))),i.a.createElement(Va.a,null,e.id!==D.id&&(D.permission.staff.edit||D.permission.admin)&&i.a.createElement(g.a,{circular:!0,size:"mini",icon:"trash",negative:!0,disabled:e.id===D.id,onClick:function(){w(!0),A({title:"Are you sure, you want to delete "+e.name+"?",fn:function(){return a=e.id,n=e.name,void F({variables:{id:a},update:function(e){e.evict({id:"Staff:".concat(a)})}}).then((function(){return t({type:"ADD_NOTIFICATION",payload:{content:"Success, staff ".concat(n," deleted"),type:"SUCCESS"}})}),(function(e){return t({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, Cannot delete staff ".concat(n),i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}));var a,n}})}})))})))),i.a.createElement(Tn,{open:O,setOpen:y}),j&&i.a.createElement(Jt,{open:j,confirm:I,setOpen:w}))},An=function(e){var t=Object(r.useContext)(G),a=Object(f.a)(t,2)[1],c=Object(p.useMutation)(H),l=Object(f.a)(c,2),o=l[0],s=l[1].loading,m=Object(r.useState)([]),O=Object(f.a)(m,2),v=O[0],y=O[1],S=Object(r.useState)([]),C=Object(f.a)(S,2),j=C[0],w=C[1],k=Object(p.useQuery)(Ut,{onCompleted:function(e){if(e.allCostumers){var t=e.allCostumers.map((function(e,t){return{key:t,value:e.id,text:e.name}}));w(t)}}}).loading;Object(r.useEffect)((function(){(function(){var e=Object(d.a)(u.a.mark((function e(){var t,a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://restcountries.eu/rest/v2/?fields=name;alpha2Code;");case 2:return t=e.sent,e.next=5,t.json();case 5:a=e.sent,n=a.map((function(e,t){return["aq","bq","cw","gg","im","je","xk","bl","mf","sx","ss"].includes(e.alpha2Code.toLowerCase())?{key:t,value:e.name,text:e.name}:{key:t,value:e.name,text:e.name,flag:e.alpha2Code.toLowerCase()}})),y(n);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);return i.a.createElement(Te.c,{initialValues:{location:"",address:{street:"",postcode:"",city:"",country:""},email:"",phone:"",costumers:[],shifts:[{name:"",startTime:""}],stationKey:"",stationKeyConfirm:""},onSubmit:function(t){!function(t){o({variables:t,update:function(e,a){var r=a.data.addStation;e.modify({fields:{allStations:function(e,a){var i=a.readField,c=r;if(e.some((function(e){return i("id",e)===c.id})))return e;var l=Object(n.a)(Object(n.a)({},t),{},{id:c.id});return[].concat(Object(V.a)(e),[l])}}}),Object(pe.forEach)(t.costumers,(function(t){e.modify({id:"Costumer:".concat(t),fields:{stations:function(e,t){var a=t.readField;return e.some((function(e){return a("id",e)===r.id}))?e:[].concat(Object(V.a)(e),[{__ref:"Station:".concat(r.id)}])}}})}))}}).then((function(){return a({type:"ADD_NOTIFICATION",payload:{content:"Success, ".concat(t.location," added to station list"),type:"SUCCESS"}})}),(function(e){return a({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, ".concat(t.location," cannot be added to station list"),i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}),e.setOpen(!1))}(t)},validate:function(e){var t={};return(!e.location||e.location&&e.location.length<3)&&(t.location="Location is required and must be at least 3 charcter long"),(!e.address.street||e.address.street&&e.address.street.length<3)&&(t.address=Object(n.a)(Object(n.a)({},t.address),{},{street:"Street is required and must be at least 3 charcter long"})),e.address.city||(t.address=Object(n.a)(Object(n.a)({},t.address),{},{city:"City is required and must be at least 3 charcter long"})),e.address.country||(t.address=Object(n.a)(Object(n.a)({},t.address),{},{country:"Country is required"})),e.email&&!Ge(e.email)||(t.email="Email is required and must be valid"),e.shifts.length&&Object(pe.forEach)(e.shifts,(function(e,a){e.name||(t.shifts||(t.shifts=[]),t.shifts[a]||(t.shifts[a]={}),t.shifts[a].name="Please provide shift name"),e.startTime||(t.shifts||(t.shifts=[]),t.shifts[a]||(t.shifts[a]={}),t.shifts[a].startTime="Shift start time is required"),e.startTime&&(e.startTime.match(/^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/)||(t.shifts||(t.shifts=[]),t.shifts[a]||(t.shifts[a]={}),t.shifts[a].startTime="Shift start should be on format HH:mm"))})),(!e.stationKey||e.stationKey&&e.stationKey.length<8)&&(t.stationKey="Station key is required and should be at least 8 charter long"),e.stationKeyConfirm!==e.stationKey&&(t.stationKeyConfirm="Station key confirm mismatch"),t}},(function(t){var a=t.values,n=t.handleSubmit,r=t.setFieldValue,c=t.dirty;return i.a.createElement(ge.a,{closeIcon:!0,closeOnEscape:!1,closeOnDimmerClick:!1,open:e.open,onClose:function(){return e.setOpen(!1)},onOpen:function(){return e.setOpen(!0)}},i.a.createElement(ma.a,null,"New Station ",e.name," "),i.a.createElement(ua.a,null,s&&i.a.createElement(Ie.a,{active:!0},i.a.createElement(le.a,null)),i.a.createElement(E.a,{style:{marginBottom:"5rem"},autoComplete:"off"},i.a.createElement(b.a,{padded:!0},i.a.createElement(b.a.Row,{style:{padding:0}},i.a.createElement(Pe,{name:"location",label:"Location",type:"text",width:"8",placeholder:"Location identifier ex: Airport code"})),i.a.createElement(b.a.Row,{style:{paddingTop:3}},i.a.createElement(na,{name:"address.country",labeled:!0,label:"Country",placeholder:"Select Country",search:!0,selection:!0,width:"8",options:v,onChange:function(e,t){var a=t.value;r("address.country",a)}})),i.a.createElement(b.a.Row,null,i.a.createElement(h.a,{as:"h3"},"Address")),i.a.createElement(b.a.Row,{style:{padding:0}},i.a.createElement(Pe,{name:"address.street",label:"Street",type:"text",width:"8"})),i.a.createElement(b.a.Row,{style:{padding:0}},i.a.createElement(Pe,{name:"address.postcode",label:"postcode",type:"text",width:"8"})),i.a.createElement(b.a.Row,{style:{paddingTop:0}},i.a.createElement(Pe,{name:"address.city",label:"city",type:"text",width:"8"})),i.a.createElement(b.a.Row,null,i.a.createElement(h.a,{as:"h3"},"Contact Information")),i.a.createElement(b.a.Row,{style:{padding:0}},i.a.createElement(Pe,{name:"email",label:"Email",type:"email",width:"8"})),i.a.createElement(b.a.Row,{style:{paddingTop:0}},i.a.createElement(Pe,{name:"phone",label:"Phone",type:"tel",width:"8"})),i.a.createElement(b.a.Row,null,i.a.createElement(h.a,{as:"h3"},"Working Shift")),i.a.createElement(Te.b,{name:"shifts"},(function(e){var t=e.push,n=e.remove;return i.a.createElement(i.a.Fragment,null,a.shifts.length>0&&a.shifts.map((function(e,t){return i.a.createElement(b.a.Row,{columns:"2",key:t,style:{padding:0}},i.a.createElement(Pe,{name:"shifts[".concat(t,"].name"),label:"Name",width:"5"}),i.a.createElement(Ne,{name:"shifts[".concat(t,"].startTime"),label:!0,placeholder:"Start Time"}),0!==t&&i.a.createElement(fe.a,{link:!0,name:"cancel",color:"red",onClick:function(){return n(t)}}))})),i.a.createElement(g.a,{type:"button",icon:!0,size:"mini",primary:!0,onClick:function(){return t({name:"",startTime:""})}},i.a.createElement(fe.a,{name:"plus circle"})," Add"))})),i.a.createElement(b.a.Row,null,i.a.createElement(h.a,{as:"h3"},"Costumers")),i.a.createElement(na,{name:"costumers",placeholder:"Select Costumers",multiple:!0,search:!0,selection:!0,width:"8",loading:k,options:j,onChange:function(e,t){var a=t.value;r("costumers",a)}}),i.a.createElement(b.a.Row,null,i.a.createElement(h.a,{as:"h3"},"Station Key")),i.a.createElement(b.a.Row,{style:{padding:0}}," ",i.a.createElement(Pe,{name:"stationKey",type:"password",width:"8",placeholder:"stationKey"})," "),i.a.createElement(b.a.Row,{style:{padding:0}}," ",i.a.createElement(Pe,{name:"stationKeyConfirm",type:"password",width:"8",placeholder:"Confirm stationKey"})," ")))),i.a.createElement(ge.a.Actions,null,i.a.createElement(g.a,{negative:!0,onClick:function(){return e.setOpen(!1)}},"Cancel"),c&&i.a.createElement(g.a,{positive:!0,onClick:function(){return n()}},"Save")))}))},Dn=function(){var e=Object(p.useQuery)(k,{variables:{detailed:!0}}),t=e.loading,a=e.error,n=e.data,c=Object(r.useState)([]),l=Object(f.a)(c,2),s=l[0],m=l[1],u=Object(r.useState)(!1),d=Object(f.a)(u,2),E=d[0],b=d[1];return Object(r.useEffect)((function(){n&&n.allStations&&m(n.allStations)}),[n]),t?i.a.createElement(le.a,{active:!0},"Fetching Staffs"):a?i.a.createElement(v.a,null,"Something Went Wrong "):i.a.createElement(i.a.Fragment,null,i.a.createElement(g.a,{primary:!0,icon:!0,onClick:function(){return b(!0)}},"Add New Station ",i.a.createElement(fe.a,{name:"add"}," ")),s&&i.a.createElement(Re.a,{icon:"search",placeholder:"Country or location ...",onChange:function(e,t){var a=t.value;if(a&&""!==a.trim()){var r=s.filter((function(e){return e.location.toLowerCase().includes(a.toLowerCase())||e.address.country.toLowerCase().includes(a.toLowerCase())}));m(r)}else m(n.allStations)}}),i.a.createElement(ye.a,{textAlign:"center"},i.a.createElement(ye.a.Header,null,i.a.createElement(Ka.a,null,i.a.createElement(za.a,null," Location "),i.a.createElement(za.a,null," Staff Count (Last 24 Hrs) "),i.a.createElement(za.a,null," Address "),i.a.createElement(za.a,null," Phone No. "),i.a.createElement(za.a,null," Email "))),i.a.createElement(ye.a.Body,null,s&&s.map((function(e){return i.a.createElement(ye.a.Row,{key:e.id},i.a.createElement(Va.a,null,i.a.createElement(o.b,{to:"/Manage/AllStations/".concat(e.id)},e.location)),i.a.createElement(Va.a,null,e.activeStaffs),i.a.createElement(Va.a,null,i.a.createElement(i.a.Fragment,null," ",e.address.street," ",i.a.createElement("br",null),"   ",e.address.postcode," ",e.address.city," ",i.a.createElement("br",null),"  ",e.address.country,"    ",i.a.createElement(jt.a,{name:e.address&&e.address.country&&e.address.country.toLowerCase()})," ")),i.a.createElement(Va.a,null,e.phone&&e.phone.reduce((function(e,t){return i.a.createElement(i.a.Fragment,null,t,"  ",i.a.createElement("br",null)," ",e)}),"")," "),i.a.createElement(Va.a,null,e.email))})))),E&&i.a.createElement(An,{open:E,setOpen:b}))},Rn=function(e){var t=e.activeItem,a=e.setActiveItem,n=JSON.parse(sessionStorage.getItem("staffKey")),r=Object(s.g)(),c=function(e,t){var n=t.name;a(n),["Profile","Timesheets","TimesheetsOverview"].includes(n)?r.push("/Manage/MyPage/".concat(n)):r.push("/Manage/".concat(n))},l=[];(n.permission.admin||n.permission.station.edit.length>0||n.permission.station.add)&&l.push("AllStations"),(n.permission.admin||n.permission.staff.view||n.permission.staff.add||n.permission.staff.view||n.permission.staff.edit)&&l.push("AllStaffs"),(n.permission.admin||n.permission.timesheet.view.length>0)&&l.push("ManageTimesheets"),n.permission.admin&&l.push("Costumers"),(n.permission.admin||n.permisison.station.edit.length)&&l.push("ShiftReports");return i.a.createElement(se.a,{inverted:!0,color:"blue",stackable:!0},l.map((function(e){return i.a.createElement(se.a.Item,{key:e,name:e,active:t===e,onClick:c})})),i.a.createElement(se.a.Menu,{position:"right"},i.a.createElement(ea.a,{item:!0,text:"Welcome ".concat(n.name)},i.a.createElement(ea.a.Menu,null,l.length>0&&i.a.createElement(i.a.Fragment,null,i.a.createElement(ea.a.Item,{disabled:!0,text:"My Pages",onClick:c}),i.a.createElement(ea.a.Item,{name:"Profile",text:"Profile",onClick:c}),i.a.createElement(ea.a.Item,{name:"Timesheets",text:"Timesheets",onClick:c}),i.a.createElement(ea.a.Item,{name:"TimesheetsOverview",text:"TimesheetsOverview",onClick:c}),i.a.createElement(ea.a.Divider,null)),i.a.createElement(ea.a.Item,{text:"Logout",onClick:function(){return sessionStorage.removeItem("staffKey"),void r.push("/staffLogin")}})))))};function Fn(){var e=Object(C.a)(["\n                  fragment NewCostumer on Costumer {\n                    name\n                    id\n                    contract\n                    aircrafts{\n                      id\n                      registration\n                    }\n                    stations{\n                      id\n                    }\n\n                  }   \n                "]);return Fn=function(){return e},e}var $n=function(e){var t=Object(r.useContext)(G),a=Object(f.a)(t,2)[1],c=Object(r.useState)([]),l=Object(f.a)(c,2),o=l[0],s=l[1],m=Object(p.useMutation)(Nt),u=Object(f.a)(m,2),d=u[0],O=u[1].loading,v=Object(p.useLazyQuery)(k),y=Object(f.a)(v,2),S=y[0],C=y[1],j=C.loading,w=C.data,T=Object(p.useLazyQuery)(Vt),I=Object(f.a)(T,2),A=I[0],D=I[1],R=D.loading,F=D.data,$=Object(r.useState)([]),N=Object(f.a)($,2),P=N[0],x=N[1];Object(r.useEffect)((function(){F&&x(F.verifyAircraftRegistration)}),[F]),Object(r.useEffect)((function(){if(w&&w.allStations){var e=w.allStations.map((function(e,t){return{key:t,value:e.id,text:e.location}}));s(e)}}),[w]);return i.a.createElement(Te.c,{initialValues:{name:"",contract:"",keyContacts:[],stations:[],aircrafts:""},onSubmit:function(t){!function(t){d({variables:t,update:function(e,t){var a=t.data.addCostumer;Object(pe.forEach)(a.stations,(function(t){e.modify({id:"Station:".concat(t.id),fields:{costumers:function(e,t){var n=t.readField;return e.some((function(e){return n("id",e)===a.id}))?e:[].concat(Object(V.a)(e),[{__ref:"Station:".concat(a.id)}])}}})})),e.modify({fields:{allCostumers:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r=n.readField,i=e.writeFragment({data:a,fragment:Object(p.gql)(Fn())});return t.some((function(e){return r("id",e)===a.id}))?t:[].concat(Object(V.a)(t),[i])}}})}}).then((function(){return a({type:"ADD_NOTIFICATION",payload:{content:"Success, costumer ".concat(t.name," added"),type:"SUCCESS"}})}),(function(e){return a({type:"ADD_NOTIFICATION",payload:{content:i.a.createElement(i.a.Fragment,null,"Error, Cannot add costumer ".concat(t.name),i.a.createElement("br",null)," ",e.message),type:"ERROR"}})}),e.setOpen(!1))}(Object(n.a)(Object(n.a)({},t),{},{aircrafts:t.aircrafts?t.aircrafts.toUpperCase().split(","):[]}))},validate:function(e){var t={};if((!e.name||e.name&&e.name.length<3)&&(t.name="Costumer Name is required and must be at least 3 charcter long"),e.contract||(t.contract="Please specify contract type ex: Ad-HOC, LongTerm , Seasonal etc."),e.aircrafts.length){e.aircrafts.match(/^[a-zA-Z, ]+$/)||(t.aircrafts="Invalid character detected, check again");var a=[];Object(pe.forEach)(e.aircrafts.split(","),(function(e){e.trim().length<3&&a.push(e.trim().toUpperCase())})),a.length&&(t.aircrafts="".concat(a.toString()," invalid Aircraft Registration, should at least 3 characters")),t.aircrafts||(A({variables:{registrations:e.aircrafts}}),P.length&&(t.aircrafts="Registration ".concat(P.toString()," already exists.")))}else t.aircrafts="Enter at least one Aircraft";return e.keyContacts.length&&Object(pe.forEach)(e.keyContacts,(function(e,a){e.description||(t.keyContacts||(t.keyContacts=[]),t.keyContacts[a]||(t.keyContacts[a]={}),t.keyContacts[a].description="Please provide contact description"),e.phone||e.email||(t.keyContacts||(t.keyContacts=[]),t.keyContacts[a]||(t.keyContacts[a]={}),t.keyContacts[a].phone="At least a phone or a email is required",t.keyContacts[a].email="At least a phone or a email is required"),e.email&&Ge(e.email)&&(t.keyContacts||(t.keyContacts=[]),t.keyContacts[a]||(t.keyContacts[a]={}),t.keyContacts[a].email="Invalid Email")})),t}},(function(t){var a=t.values,n=t.handleSubmit,r=t.setFieldValue,c=t.dirty;return i.a.createElement(ge.a,{closeIcon:!0,closeOnEscape:!1,closeOnDimmerClick:!1,open:e.open,onClose:function(){return e.setOpen(!1)},onOpen:function(){return e.setOpen(!0)}},i.a.createElement(ma.a,null,"New Costumer "),i.a.createElement(ua.a,null,O&&i.a.createElement(Ie.a,{active:!0},i.a.createElement(le.a,null)),i.a.createElement(E.a,{style:{marginBottom:"5rem"},autoComplete:"off",onSubmit:function(e){e.preventDefault(),n()}},i.a.createElement(b.a,{padded:!0},i.a.createElement(b.a.Row,{style:{padding:0}},i.a.createElement(Pe,{name:"name",label:"Name",type:"text",width:"8",placeholder:"Costumer Name"})),i.a.createElement(b.a.Row,{style:{padding:0}},i.a.createElement(Pe,{name:"contract",label:"Contract",type:"text",width:"8",placeholder:"Ex: Ad-Hoc, Short-term , Long-term, Seasonal"})),i.a.createElement(b.a.Row,{style:{padding:0}},i.a.createElement(Pe,{name:"aircrafts",label:"Aircrafts",type:"text",width:"8",placeholder:'Aircrfat Registrations separeted by comma ","'})),i.a.createElement(b.a.Row,{style:{paddingTop:3}},i.a.createElement(na,{name:"stations",labeled:!0,label:"Station",placeholder:"Select Stations",search:!0,loading:j,selection:!0,multiple:!0,width:"8",options:o,onFocus:function(){return S()},onChange:function(e,t){var a=t.value;r("stations",a)}})),i.a.createElement(b.a.Row,null,i.a.createElement(h.a,{as:"h3"},"Key Contacts")),i.a.createElement(Te.b,{name:"keyContacts"},(function(e){var t=e.push,n=e.remove;return i.a.createElement(i.a.Fragment,null,a.keyContacts.length>0&&a.keyContacts.map((function(e,t){return i.a.createElement(b.a.Row,{key:t,style:{padding:0}},i.a.createElement(E.a.Group,{style:{margin:0},widths:"13"},i.a.createElement(Pe,{name:"keyContacts[".concat(t,"].description"),label:"Description"}),i.a.createElement(Pe,{name:"keyContacts[".concat(t,"].phone"),label:"Phone"}),i.a.createElement(Pe,{name:"keyContacts[".concat(t,"].email"),label:"Email"}),i.a.createElement(fe.a,{link:!0,name:"cancel",color:"red",onClick:function(){return n(t)}})))})),i.a.createElement(g.a,{style:{marginTop:"1rem"},type:"button",icon:!0,size:"mini",primary:!0,onClick:function(){return t({description:"",phone:"",email:""})}},i.a.createElement(fe.a,{name:"plus circle"})," Add"))}))))),i.a.createElement(ge.a.Actions,null,i.a.createElement(g.a,{negative:!0,onClick:function(){return e.setOpen(!1)}},"Cancel"),c&&i.a.createElement(g.a,{loading:R,disabled:R,positive:!0,onClick:function(e){e.preventDefault(),n()}},"Save")))}))},Nn=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),a=t[0],n=t[1],c=Object(p.useQuery)(Ut,{variables:{detailed:!0}}),l=c.loading,m=c.error,u=c.data,d=Object(s.h)();return u||l?l?i.a.createElement(v.a,{basic:!0},i.a.createElement(le.a,{active:!0}," Loading Costumer Data")):m?i.a.createElement(h.a,{as:"h4"},"Something went wrong"):i.a.createElement(i.a.Fragment,null,i.a.createElement(g.a,{primary:!0,icon:!0,style:{marginBottom:"1rem"},onClick:function(){return n(!0)}},i.a.createElement(fe.a,{name:"add circle"}),"Add New Costumer"),u&&u.allCostumers.length>0&&i.a.createElement(wt.a.Group,null,u.allCostumers.map((function(e){return i.a.createElement(wt.a,{key:e.id,link:!0,raised:!0,as:o.b,to:"".concat(d.pathname,"/").concat(e.id)},i.a.createElement(wt.a.Content,{textAlign:"center",header:e.name}),i.a.createElement(wt.a.Content,{textAlign:"center"},e.contract?e.contract+" Contract":""),i.a.createElement(wt.a.Content,{textAlign:"center",extra:!0},i.a.createElement(h.a,{as:"h5"}," ",i.a.createElement(fe.a,{name:"plane"})," Total Aircrafts: ",e.aircrafts&&e.aircrafts.length)))}))),!u.allCostumers&&i.a.createElement(h.a,{as:"h4"},"No Costumer Data"),a&&i.a.createElement($n,{open:a,setOpen:n})):null},Pn=function(){var e=Object(s.i)(),t=Object(s.h)(),a=t.pathname.split("/")[2],n=Object(r.useState)(a),c=Object(f.a)(n,2),l=c[0],o=c[1];return Object(r.useEffect)((function(){o(a)}),[a,t,e]),i.a.createElement(i.a.Fragment,null,i.a.createElement(Rn,{activeItem:l,setActiveItem:o}),l&&"managetimesheets"===l.toLowerCase()&&i.a.createElement(En,null),"shiftreports"===l.toLowerCase()&&i.a.createElement(i.a.Fragment,null,i.a.createElement(Oa,null)),"mypage"===l.toLowerCase()&&i.a.createElement(i.a.Fragment,null,i.a.createElement(kn,null)),"allstaffs"===l.toLowerCase()&&!e.staffId&&i.a.createElement(i.a.Fragment,null,i.a.createElement(In,null)),"allstaffs"===l.toLowerCase()&&e.staffId&&i.a.createElement(i.a.Fragment,null,i.a.createElement(kn,{id:e.staffId})),l&&"allstations"===l.toLowerCase()&&!e.stationId&&i.a.createElement(i.a.Fragment,null,i.a.createElement(Dn,null)),l&&"allstations"===l.toLowerCase()&&e.stationId&&i.a.createElement(i.a.Fragment,null,i.a.createElement(Ea,null)),l&&"costumers"===l.toLowerCase()&&!e.costumerId&&i.a.createElement(i.a.Fragment,null,i.a.createElement(Nn,null)),l&&"costumers"===l.toLowerCase()&&e.costumerId&&i.a.createElement(i.a.Fragment,null,i.a.createElement(ia,null)))},xn=function(){return i.a.createElement(o.a,null,i.a.createElement(s.d,null,i.a.createElement(s.b,{path:["/shiftReport/:station/:id","/shiftReport/:id"]},i.a.createElement(va,null)),i.a.createElement(s.b,{path:"/stationLogin"},i.a.createElement(ee,null)),i.a.createElement(s.b,{path:"/staffLogin"},i.a.createElement(_a,null)),i.a.createElement(s.b,{path:["/staff/:staffId/:page/:period","/staff/:staffId/:page"]},i.a.createElement(kn,null)),i.a.createElement(s.a,{from:"/staff/:staffId",to:"/staff/:staffId/Profile"}),i.a.createElement(s.b,{path:"/staff"},i.a.createElement(kn,null)),i.a.createElement(s.a,{from:"/Manage/MyPage/:page/:id/:period",to:"/Manage/MyPage/:page/:period"}),i.a.createElement(s.b,{path:["/Manage/AllStaffs/:staffId/:page/:period","/Manage/AllStaffs/:staffId/:page/","/Manage/MyPage/:page/:period","/Manage/MyPage/:page/"]},i.a.createElement(Pn,null)),i.a.createElement(s.a,{from:"/Manage/AllStaffs/:staffId",to:"/Manage/AllStaffs/:staffId/Profile"}),i.a.createElement(s.b,{path:"/Manage/AllStaffs"},i.a.createElement(Pn,null)),i.a.createElement(s.b,{path:["/Manage/ManageTimesheets/:staffId/:period","/Manage/ManageTimesheets/:staffId","/Manage/ManageTimesheets"]},i.a.createElement(Pn,null)),i.a.createElement(s.b,{path:["/Manage/AllStations/:stationId/:page/:costumerId","/Manage/AllStations/:stationId/:page"]},i.a.createElement(Pn,null)),i.a.createElement(s.a,{from:"/Manage/AllStations/:stationId",to:"/Manage/AllStations/:stationId/BasicInfo"}),i.a.createElement(s.b,{path:"/Manage/AllStations"},i.a.createElement(Pn,null)),i.a.createElement(s.b,{path:["/Manage/Costumers/:costumerId","/Manage/Costumers"]},i.a.createElement(Pn,null)),i.a.createElement(s.b,{path:["/Manage/ShiftReports"]},i.a.createElement(Pn,null)),i.a.createElement(s.a,{from:"/Manage",to:"/Manage/MyPage/Profile"}),i.a.createElement(s.b,{path:"/Manage"},i.a.createElement(Pn,null)),i.a.createElement(s.b,{path:"/Register/:registerCode"},i.a.createElement(kn,null)),i.a.createElement(s.b,{path:"/Reset-Password/:resetCode"},i.a.createElement(kn,null)),i.a.createElement(s.b,{path:"/"},i.a.createElement(ee,null))))},Mn=function(){return i.a.createElement(X,null,i.a.createElement(xn,null))},Hn=(a(608),a(661)),Ln=a(408),qn=Object(Ln.a)((function(e,t){var a=t.headers,r=JSON.parse(sessionStorage.getItem("staffKey"));r||(r=JSON.parse(localStorage.getItem("stationKey")))||(r=JSON.parse(sessionStorage.getItem("stationKey")));var i=r?r.value:null;return{headers:Object(n.a)(Object(n.a)({},a),{},{authorization:i?"bearer ".concat(i):null})}})),_n=new p.HttpLink({uri:window.location.href}),Bn=new p.ApolloClient({cache:new p.InMemoryCache,link:qn.concat(_n)});l.a.render(i.a.createElement(p.ApolloProvider,{client:Bn},i.a.createElement(Hn.a,null,i.a.createElement(Mn,null))),document.getElementById("root"))}},[[420,1,2]]]);
//# sourceMappingURL=main.1b61444f.chunk.js.map